{"version":3,"sources":["../node_modules/matter-js/src/core sync","server.tsx","util.ts","variables.tsx","controlpanel.tsx","functionplot.tsx","importdroptarget.tsx","maintoolbar.tsx","renderauraproj.js","utilsim.tsx","serviceWorker.ts","index.js"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","MouseMode","createBounds","p1","p2","min","x","Math","y","max","boundsOverlap","b1","b2","distanceSq","dx","dy","pointInBounds","p","b","includeEdges","pointNearBounds","r","evaluateUtilFunction","func","boundary","constants","globalVars","evalFunc","utilVar","vars","C_m","desc","defaultValue","C_c","C_u","C_d","C_i","sigma","type","N","t","lambda","delta","alpha","beta","n","Variables","props","Table","hover","striped","size","Object","utilConstants","map","v","i","key","Node","html","tagName","onChange","onUtilConstantUpdated","parseFloat","target","value","trim","utilGlobalVars","toFixed","boundaries","length","title","j","ControlPanel","popover","position","top","right","zIndex","cover","bottom","left","serverUtilValues","serverUtilFunc","utilFuncs","utilValues","forEach","evaluateServerUtilFunction","utilServer","utilFunctions","globalUtilValue","reduce","a","Tabs","Tab","eventKey","InputGroup","className","Prepend","Text","inline","expression","FormControl","placeholder","aria-label","currentTarget","onUtilFunctionUpdated","Append","Dropdown","Toggle","variant","style","borderRadius","Menu","Header","Item","onSelect","onUtilVarUpdated","Divider","Button","onClick","onChangeColorClicked","backgroundColor","color","icon","showColorPicker","colorIndex","undefined","disableAlpha","onColorUpdated","onUtilFunctionDeleted","onUtilFunctionAdded","onServerUtilFunctionUpdated","bounds","FunctionPlot","updateCurves","memoize","funcs","stepSize","state","xRange","datasets","Array","dataset","label","fill","showLine","pointRadius","pointHitRadius","borderColor","borderWidth","data","push","updatePoints","pointStyle","yRange","curves","this","concat","options","maintainAspectRatio","animation","duration","React","outerStyle","height","padding","textAlign","fontSize","lineHeight","border","display","width","middleStyle","verticalAlign","innerStyle","marginLeft","marginRight","ImportDropTarget","fileUploader","useDrop","accept","NativeTypes","FILE","drop","item","monitor","files","getItem","onFilesSelected","collect","isOver","canDrop","ref","click","input","event","MainToolbar","Navbar","bg","expand","Brand","href","src","alt","aria-controls","Collapse","Nav","Link","onImportClickedCallback","onExportClickedCallback","RenderAuraProj","defaults","controller","engine","element","canvas","mouse","frameRequestId","pixelRatio","background","wireframeBackground","gridSize","hasBounds","enabled","wireframes","showSleeping","showDebug","showBroadphase","showBounds","showVelocity","showCollisions","showSeparations","showAxes","showPositions","showAngleIndicator","showIds","showShadows","showVertexNumbers","showConvexHulls","showInternalEdges","showMousePosition","showGrid","crosshairSnap","render","Common","extend","_createCanvas","context","getContext","textures","setPixelRatio","isElement","appendChild","parentNode","log","loop","time","_requestAnimationFrame","call","window","world","_cancelAnimationFrame","_getPixelRatio","setAttribute","objects","center","isArray","Infinity","object","viewHeight","outerRatio","innerRatio","scaleX","scaleY","Mouse","setScale","setOffset","boundsWidth","boundsHeight","boundsScaleX","boundsScaleY","setTransform","translate","canvasWidth","canvasHeight","scale","xOriginOffset","yOriginOffset","xGridOffset","_mod","yGridOffset","lineWidth","setLineDash","strokeStyle","fillStyle","drawXGridLine","_roundDrawCoord","beginPath","moveTo","lineTo","stroke","fillText","drawYGridLine","xLabel","floor","yLabel","_almostEqual","save","restore","crosshairX","crosshairY","round","drawX","drawY","allBodies","Composite","allConstraints","bodies","constraints","timestamp","timing","Events","trigger","currentBackground","_applyBackground","globalCompositeOperation","fillRect","drawGrid","body","Bounds","overlaps","constraint","bodyA","bodyB","pointAWorld","pointA","pointBWorld","pointB","Vector","add","contains","startViewTransform","enableSleeping","bodyConvexHulls","bodyWireframes","bodyBounds","bodyAxes","bodyPositions","bodyVelocity","bodyIds","separations","pairs","list","collisions","vertexNumbers","mousePosition","broadphase","Grid","grid","debug","endViewTransform","showCrosshair","drawCrosshair","c","metrics","debugTimestamp","text","fps","extended","correction","buckets","broadEff","midEff","narrowEff","debugString","font","split","visible","start","end","arc","PI","closePath","offset","sub","normal","perp","normalise","coils","ceil","clamp","anchors","circleRadius","vertices","distanceX","distanceY","distance","abs","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","part","k","parts","sprite","texture","_getTexture","rotate","angle","drawImage","xOffset","xScale","yOffset","yScale","isInternal","isSleeping","_colorLuminance","globalAlpha","rect","axes","axis","positionPrev","pair","collision","isActive","activeContacts","vertex","normalPosX","normalPosY","supports","isStatic","penetration","bucketKeys","bucketId","region","parseInt","bucketWidth","bucketHeight","inspector","selected","point","selectStart","selectBounds","document","createElement","oncontextmenu","onselectstart","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","imagePath","image","Image","cssBackground","test","backgroundSize","hex","lum","String","replace","rgb","substr","toString","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","now","cancelAnimationFrame","mozCancelAnimationFrame","webkitCancelAnimationFrame","msCancelAnimationFrame","ResizeMode","Server","matterEngine","matterMouse","matterMouseConstraint","matterRender","matterRunner","matterWorld","componentDidMount","canvasRef","current","ctx","offsetWidth","offsetHeight","Matter","World","create","gravity","Engine","MouseConstraint","stiffness","Bodies","circle","restitution","Runner","isFixed","on","onBodyDragStart","onBodyDragEnd","onBeforeUpdate","onEngineBeforeUpdate","onEngineAfterUpdate","onBeforeRender","onBeforeObjects","run","console","mouseMode","OBJECT","collisionFilter","mask","snapToGrid","source","mousePos","getMousePos","mousePosUnsnapped","topLeft","worldToCanvas","bottomRight","extents","mouseInBounds","isClickedBoundary","clickedBoundary","BOUNDARY_EDIT","resizeMode","NONE","mouseDownPos","resizeBoundaries","SNOOKER","snookerBody","bodyPos","setState","draggingBody","checkResizeMode","bUnder","bNear","CROSS_SPLIT","HORIZONTAL_SPLIT","VERTICAL_SPLIT","mousePosCanvas","boundsCanvas","leftDist","rightDist","topDist","bottomDist","TOP_LEFT_CORNER","TOP_RIGHT_CORNER","BOTTOM_RIGHT_CORNER","BOTTOM_LEFT_CORNER","LEFT_EDGE","RIGHT_EDGE","TOP_EDGE","BOTTOM_EDGE","updateCanvasCursorStyle","cursor","onMouseDown","mouseButton","button","mouseDownPosCanvas","bodyAtPosition","boundaryUnderMouse","boundariesNearMouse","clickedOldBounds","assign","onMouseUp","onObjectAdded","onObjectDeleted","remove","force","mult","mass","Body","applyForce","onBoundaryDeleted","onBoundaryAdded","resizingMultiple","onMouseMove","onBoundariesUpdated","resizeInfo","newBounds","minIndex","dist","dists","newBounds1","newBounds2","mouseDelta","onMouseOver","onMouseOut","onWheel","zoomFactor","deltaY","spawnRandomObjects","count","random","clearAllObjects","clear","showAllObjects","lookAt","resetView","halfExtent","neg","find","filter","bHalfWidth","bHalfHeight","bCenter","pow","circleOverlapBounds","MOUSE_BOUNDS_THRESHOLD","Query","forceUnsnapped","dragStartPos","dragLastPos","whyDidYouRender","colors","UtilSim","serverRef","lastFrameTime","frameTimeHistory","performance","shift","avgFrameTime","slice","totalObjects","numObjects","numNearBoundary","numActive","splice","timeSinceBoundaryMoved","lastBoundaryMoveTime","validateResize","notBeingUpdated","some","every","info","checkList","validateBoundary","boundaryToIgnore","index","findIndex","validate","oldBounds","evaluatex","E","pi","cloneDeep","onRandomClicked","onClearClicked","onHomeClicked","onShowAllObjectsClicked","onImportClicked","showImportModal","onImportModalClosed","onExportClicked","saveObj","simState","inverseMass","speed","velocity","saveAs","Blob","JSON","stringify","fileList","file","reader","FileReader","readAsBinaryString","onloadend","newState","parse","result","bodyData","setVelocity","defaultConstantValues","localStorageState","get","Modal","show","onHide","closeButton","Title","DndProvider","backend","Backend","Footer","Container","fluid","Row","Col","ButtonToolbar","ButtonGroup","active","Boolean","location","hostname","match","library","faBorderAll","faBowlingBall","faChartLine","faCube","faDice","faEye","faHome","faMagnet","faPlus","faPalette","faRadiation","faTh","faThLarge","faTrash","faVectorSquare","ReactDOM","Context","asciimath2jax","useMathMLspacing","preview","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.64ea675f.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 376;","///<reference path=\"./types/types.d.ts\" />\n\nimport * as React from 'react'\nimport Matter from 'matter-js'\nimport { circleOverlapBounds, createBounds, distanceSq, pointInBounds } from './util'\nimport { random } from 'lodash'\n\n// Custom renderer\nimport { RenderAuraProj } from './renderauraproj'\n\nexport enum MouseMode {\n\tOBJECT,\n\tBOUNDARY_EDIT,\n\tSNOOKER\n}\n\nconst MOUSE_BOUNDS_THRESHOLD = 10\n\nenum ResizeMode {\n\tNONE,\n\tLEFT_EDGE,\n\tRIGHT_EDGE,\n\tTOP_EDGE,\n\tBOTTOM_EDGE,\n\tTOP_LEFT_CORNER,\n\tTOP_RIGHT_CORNER,\n\tBOTTOM_RIGHT_CORNER,\n\tBOTTOM_LEFT_CORNER,\n\tHORIZONTAL_SPLIT,\n\tVERTICAL_SPLIT,\n\tCROSS_SPLIT\n}\n\ninterface ServerProps {\n\tboundaries: Array<Boundary>,\n\tmouseMode: MouseMode,\n\tsnapToGrid: boolean,\n\tgridSize: number,\n\n\tonEngineBeforeUpdate?: (event: Matter.IEventTimestamped<Matter.Engine>) => void,\n\tonEngineAfterUpdate?: (event: Matter.IEventTimestamped<Matter.Engine>) => void,\n\n\tonObjectAdded?: ObjectAddedCallback,\n\tonObjectDeleted?: ObjectDeletedCallback,\n\n\tonBoundaryAdded?: BoundaryAddedCallback,\n\tonBoundariesUpdated?: BoundariesUpdatedCallback,\n\tonBoundaryDeleted?: BoundaryDeletedCallback\n}\n\ninterface ServerState {\n\tcanvasRef: React.RefObject<HTMLCanvasElement>,\n\tshowCrosshair: boolean,\n\tdraggingBody: boolean,\n\tmouseButton?: number,\n\tmouseDownPos?: Point,\n\tmouseDownPosCanvas?: Point,\n\tdragStartPos?: Point,\n\tdragLastPos?: Point,\n\tsnookerBody?: Matter.Body,\n\tclickedBoundary?: Boundary,\n\tclickedOldBounds?: Bounds,\n\tresizeBoundaries?: Array<Boundary>,\n\tresizeMode: ResizeMode,\n}\n\nexport default class Server extends React.PureComponent<ServerProps, ServerState> {\n\tstatic whyDidYouRender = true\n\n\tmatterEngine?: Matter.Engine\n\tmatterMouse?: Matter.Mouse\n\tmatterMouseConstraint?: Matter.MouseConstraint\n\tmatterRender?: RenderAuraProj\n\tmatterRunner?: Matter.Runner\n\tmatterWorld?: Matter.World\n\n\tconstructor(props: ServerProps) {\n\t\tsuper(props)\n\n\t\tconst canvasRef: React.RefObject<HTMLCanvasElement> = React.createRef()\n\n\t\tthis.state = {\n\t\t\tcanvasRef: canvasRef,\n\t\t\tshowCrosshair: false,\n\t\t\tdraggingBody: false,\n\t\t\tmouseButton: undefined,\n\t\t\tmouseDownPos: undefined,\n\t\t\tmouseDownPosCanvas: undefined,\n\t\t\tdragStartPos: undefined,\n\t\t\tdragLastPos: undefined,\n\t\t\tsnookerBody: undefined,\n\t\t\tclickedBoundary: undefined,\n\t\t\tclickedOldBounds: undefined,\n\t\t\tresizeBoundaries: undefined,\n\t\t\tresizeMode: ResizeMode.NONE,\n\t\t}\n\t}\n\n\tcomponentDidMount = () => {\n\t\t// Get canvas context and set it up\n\t\tconst canvas = this.state.canvasRef.current\n\t\tif (!canvas) {\n\t\t\tconsole.log(\"Canvas ref is null\")\n\t\t\treturn\n\t\t}\n\n\t\tconst ctx = canvas.getContext(\"2d\")\n\t\tif (!ctx) {\n\t\t\tconsole.log(\"Couldn't get a 2D canvas context\")\n\t\t\treturn\n\t\t}\n\n\t\tctx.font = \"12px Arial\"\n\n\t\t// Fit canvas to container\n\t\t// TODO: make this dynamic\n\t\tcanvas.style.width = \"100%\"\n\t\tcanvas.style.height = \"100%\"\n\t\tcanvas.width  = canvas.offsetWidth\n\t\tcanvas.height = canvas.offsetHeight\n\n\t\t// Prevent menus on canvas\n\t\tcanvas.oncontextmenu = () => false\n\t\tcanvas.onselectstart = () => false\n\n\t\t// Create a physics world\n\t\tthis.matterWorld = Matter.World.create({\n\t\t\t// Top-down, so no gravity\n\t\t\tgravity: {\n\t\t\t\tscale: 1,\n\t\t\t\tx: 0,\n\t\t\t\ty: 0\n\t\t\t}\n\t\t})\n\n\t\t// Create a physics engine\n\t\tthis.matterEngine = Matter.Engine.create({\n\t\t\tenableSleeping: true,\n\t\t\tworld: this.matterWorld\n\t\t})\n\n\t\t// Add mouse control\n\t\tthis.matterMouse = Matter.Mouse.create(canvas)\n\t\tthis.matterMouseConstraint = Matter.MouseConstraint.create(this.matterEngine, {\n\t\t\tmouse: this.matterMouse,\n\t\t\tconstraint: {\n\t\t\t\tstiffness: 0.2,\n\t\t\t\trender: {\n\t\t\t\t\tlineWidth: 0,\n\t\t\t\t\tstrokeStyle: 'black',\n\t\t\t\t\tvisible: false\n\t\t\t\t}\n\t\t\t} as Matter.Constraint\n\t\t})\n\n\t\t// Create a renderer\n\t\tthis.matterRender = RenderAuraProj.create({\n\t\t\t// Bounds begin centered about the origin\n\t\t\tbounds: {\n\t\t\t\tmin: {\n\t\t\t\t\tx: -canvas.width / 2,\n\t\t\t\t\ty: -canvas.height / 2\n\t\t\t\t},\n\t\t\t\tmax: {\n\t\t\t\t\tx: canvas.width / 2,\n\t\t\t\t\ty: canvas.height / 2\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanvas: canvas,\n\t\t\tengine: this.matterEngine,\n\t\t\tmouse: this.matterMouse,\n\t\t\toptions: {\n\t\t\t\twidth: canvas.width,\n\t\t\t\theight: canvas.height,\n\t\t\t\tbackground: 'rgb(0, 0, 0, 0)',\n\t\t\t\twireframes: false,\n\t\t\t}\n\t\t})\n\n\t\tMatter.World.add(this.matterWorld, this.matterMouseConstraint)\n\n\t\t// Temp\n\t\tfor (let x = 0; x < 9; ++x) {\n\t\t\tfor (let y = 0; y < 9; ++y) {\n\t\t\t\tconst body = Matter.Bodies.circle(x * 50 - 200, y * 50 - 200, 20, { restitution: 0.5 })\n\t\t\t\tMatter.World.add(this.matterWorld, body)\n\t\t\t}\n\t\t}\n\n\t\tconst body = Matter.Bodies.circle(0, 300, 50, { restitution: 0.5 })\n\t\tMatter.World.add(this.matterWorld, body)\n\n\t\t// Create runner\n\t\tthis.matterRunner = Matter.Runner.create({ isFixed: false })\n\n\t\t// Mouse handlers\n\t\tMatter.Events.on(this.matterMouseConstraint, 'startdrag', this.onBodyDragStart)\n\t\tMatter.Events.on(this.matterMouseConstraint, 'enddrag', this.onBodyDragEnd)\n\n\t\t// Engine/runner hooks\n\t\tMatter.Events.on(this.matterEngine, 'beforeUpdate', this.onBeforeUpdate)\n\t\tif (this.props.onEngineBeforeUpdate)\n\t\t\tMatter.Events.on(this.matterEngine, 'beforeUpdate', this.props.onEngineBeforeUpdate)\n\t\tif (this.props.onEngineAfterUpdate)\n\t\t\tMatter.Events.on(this.matterEngine, 'afterUpdate', this.props.onEngineAfterUpdate)\n\n\t\t// Renderer hooks\n\t\tMatter.Events.on(this.matterRender, 'beforeRender', this.onBeforeRender)\n\t\tMatter.Events.on(this.matterRender, 'beforeObjects', this.onBeforeObjects)\n\n\t\t// Run the engine\n\t\tMatter.Runner.run(this.matterRunner, this.matterEngine)\n\n\t\t// Run the renderer\n\t\tRenderAuraProj.run(this.matterRender)\n\t}\n\n\tonBeforeUpdate = (event: Matter.IEventTimestamped<Matter.Engine>) => {\n\t\tif (!this.matterMouseConstraint)\n\t\t\treturn\n\n\t\t// Should we disable the mouse constraint (grab objects?)\n\t\tif (this.props.mouseMode !== MouseMode.OBJECT)\n\t\t\tthis.matterMouseConstraint.collisionFilter.mask = 0\n\t\telse\n\t\t\tthis.matterMouseConstraint.collisionFilter.mask = 0xFFFFFFFF\n\t}\n\n\tonBeforeRender = (event: Matter.IEventTimestamped<Matter.Render>) => {\n\t\tif (!this.matterRender)\n\t\t\treturn\n\n\t\t// Update some rendering options\n\t\tthis.matterRender.options.gridSize = this.props.gridSize\n\t\tthis.matterRender.options.showCrosshair = this.state.showCrosshair\n\t\tthis.matterRender.options.crosshairSnap = this.props.snapToGrid\n\t}\n\n\tonBeforeObjects = (event: Matter.IEventTimestamped<Matter.Render>) => {\n\t\tconst context = event.source.context\n\t\tconst mousePos = this.getMousePos(true)\n\t\tconst mousePosUnsnapped = this.getMousePos(true, true)\n\n\t\t// Draw boundaries\n\t\tcontext.setLineDash([])\n\t\tcontext.lineWidth = 1\n\n\t\tthis.props.boundaries.forEach(boundary => {\n\t\t\tconst topLeft = this.worldToCanvas(boundary.bounds.min)\n\t\t\tconst bottomRight = this.worldToCanvas(boundary.bounds.max)\n\t\t\tconst extents = Matter.Vector.sub(bottomRight, topLeft)\n\n\t\t\tconst mouseInBounds = pointInBounds(mousePosUnsnapped, { min: topLeft, max: bottomRight }, false)\n\t\t\tconst isClickedBoundary = this.state.clickedBoundary && this.state.clickedBoundary === boundary\n\n\t\t\tcontext.fillStyle = boundary.color\n\t\t\tcontext.strokeStyle = 'black'\n\n\t\t\tif (this.props.mouseMode === MouseMode.BOUNDARY_EDIT && this.state.resizeMode === ResizeMode.NONE && (isClickedBoundary || mouseInBounds))\n\t\t\t\tcontext.globalAlpha = 0.6\n\t\t\telse\n\t\t\t\tcontext.globalAlpha = 0.4\n\n\t\t\tcontext.beginPath()\n\t\t\tcontext.fillRect(topLeft.x, topLeft.y, extents.x, extents.y)\n\t\t\tcontext.globalAlpha = 1.0\n\t\t\tcontext.rect(topLeft.x, topLeft.y, extents.x, extents.y)\n\t\t\tcontext.stroke()\n\t\t})\n\n\t\tswitch (this.props.mouseMode) {\n\t\t\tcase MouseMode.BOUNDARY_EDIT: {\n\t\t\t\tif (!this.state.mouseDownPos || this.state.clickedBoundary || this.state.resizeBoundaries)\n\t\t\t\t\tbreak\n\n\t\t\t\t// Draw outline of new boundary\n\t\t\t\tconst topLeft = this.worldToCanvas(this.state.mouseDownPos)\n\t\t\t\tconst width = mousePos.x - topLeft.x\n\t\t\t\tconst height = mousePos.y - topLeft.y\n\n\t\t\t\tcontext.strokeStyle = 'blue'\n\t\t\t\tcontext.fillStyle = 'rgb(128, 128, 255, 0.2)'\n\t\t\t\tcontext.beginPath()\n\t\t\t\tcontext.fillRect(topLeft.x, topLeft.y, width, height)\n\t\t\t\tcontext.rect(topLeft.x, topLeft.y, width, height)\n\t\t\t\tcontext.stroke()\n\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase MouseMode.SNOOKER: {\n\t\t\t\tif (!this.state.snookerBody)\n\t\t\t\t\tbreak\n\n\t\t\t\t// Draw snooker \"cue\"\n\t\t\t\tconst bodyPos = this.worldToCanvas(this.state.snookerBody.position)\n\n\t\t\t\tcontext.strokeStyle = 'red'\n\t\t\t\tcontext.beginPath()\n\t\t\t\tcontext.moveTo(bodyPos.x, bodyPos.y)\n\t\t\t\tcontext.lineTo(mousePos.x, mousePos.y)\n\t\t\t\tcontext.stroke()\n\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tdefault: break\n\t\t}\n\t}\n\n\tonBodyDragStart = () => {\n\t\tthis.setState({ draggingBody: true })\n\t}\n\n\tonBodyDragEnd = () => {\n\t\tthis.setState({ draggingBody: false })\n\t}\n\n\tcheckResizeMode = (bUnder?: Boundary, bNear?: Array<Boundary>) => {\n\t\tlet resizeMode = ResizeMode.NONE\n\n\t\t// Mouse near a boundary edge\n\t\tif (bNear && bNear.length > 1)\n\t\t{\n\t\t\t// Mouse near a 4-way intersection\n\t\t\tif (bNear.length === 4) {\n\t\t\t\tresizeMode = ResizeMode.CROSS_SPLIT\n\t\t\t}\n\t\t\t// Mouse near 2-way intersection\n\t\t\telse if (bNear.length === 2) {\n\t\t\t\tconst b1 = bNear[0].bounds\n\t\t\t\tconst b2 = bNear[1].bounds\n\t\t\t\tif (b1.max.y <= b2.min.y || b2.max.y <= b1.min.y)\n\t\t\t\t\tresizeMode = ResizeMode.HORIZONTAL_SPLIT\n\t\t\t\telse\n\t\t\t\t\tresizeMode = ResizeMode.VERTICAL_SPLIT\n\t\t\t}\n\t\t}\n\t\telse if (bUnder) {\n\t\t\tconst mousePosCanvas = this.getMousePos(true, true)\n\t\t\tconst boundsCanvas = {\n\t\t\t\tmin: this.worldToCanvas(bUnder.bounds.min),\n\t\t\t\tmax: this.worldToCanvas(bUnder.bounds.max)\n\t\t\t}\n\n\t\t\tconst leftDist \t= Math.abs(boundsCanvas.min.x - mousePosCanvas.x)\n\t\t\tconst rightDist = Math.abs(boundsCanvas.max.x - mousePosCanvas.x)\n\t\t\tconst topDist = Math.abs(boundsCanvas.min.y - mousePosCanvas.y)\n\t\t\tconst bottomDist = Math.abs(boundsCanvas.max.y - mousePosCanvas.y)\n\n\t\t\t// Check corners\n\t\t\tif (leftDist <= MOUSE_BOUNDS_THRESHOLD && topDist <= MOUSE_BOUNDS_THRESHOLD)\n\t\t\t\tresizeMode = ResizeMode.TOP_LEFT_CORNER\n\t\t\telse if (rightDist <= MOUSE_BOUNDS_THRESHOLD && topDist <= MOUSE_BOUNDS_THRESHOLD)\n\t\t\t\tresizeMode = ResizeMode.TOP_RIGHT_CORNER\n\t\t\telse if (rightDist <= MOUSE_BOUNDS_THRESHOLD && bottomDist <= MOUSE_BOUNDS_THRESHOLD)\n\t\t\t\tresizeMode = ResizeMode.BOTTOM_RIGHT_CORNER\n\t\t\telse if (leftDist <= MOUSE_BOUNDS_THRESHOLD && bottomDist <= MOUSE_BOUNDS_THRESHOLD)\n\t\t\t\tresizeMode = ResizeMode.BOTTOM_LEFT_CORNER\n\n\t\t\t// Check edges\n\t\t\telse if (leftDist <= MOUSE_BOUNDS_THRESHOLD)\n\t\t\t\tresizeMode = ResizeMode.LEFT_EDGE\n\t\t\telse if (rightDist <= MOUSE_BOUNDS_THRESHOLD)\n\t\t\t\tresizeMode = ResizeMode.RIGHT_EDGE\n\t\t\telse if (topDist <= MOUSE_BOUNDS_THRESHOLD)\n\t\t\t\tresizeMode = ResizeMode.TOP_EDGE\n\t\t\telse if (bottomDist <= MOUSE_BOUNDS_THRESHOLD)\n\t\t\t\tresizeMode = ResizeMode.BOTTOM_EDGE\n\n\t\t}\n\n\t\treturn resizeMode\n\t}\n\n\tupdateCanvasCursorStyle = (resizeMode?: ResizeMode, bUnder?: Boundary) => {\n\t\tconst canvas = this.state.canvasRef.current\n\t\tif (!canvas)\n\t\t\treturn\n\n\t\tswitch (resizeMode) {\n\t\t\t// Single boundary\n\t\t\tcase ResizeMode.TOP_LEFT_CORNER: \t\tcanvas.style.cursor = 'nw-resize'; \tbreak;\n\t\t\tcase ResizeMode.TOP_RIGHT_CORNER:\t\tcanvas.style.cursor = 'ne-resize'; \tbreak;\n\t\t\tcase ResizeMode.BOTTOM_RIGHT_CORNER:\tcanvas.style.cursor = 'se-resize'; \tbreak;\n\t\t\tcase ResizeMode.BOTTOM_LEFT_CORNER:\t\tcanvas.style.cursor = 'sw-resize'; \tbreak;\n\t\t\tcase ResizeMode.LEFT_EDGE: \t\t\t\tcanvas.style.cursor = 'w-resize'; \tbreak;\n\t\t\tcase ResizeMode.RIGHT_EDGE:\t\t\t\tcanvas.style.cursor = 'e-resize'; \tbreak;\n\t\t\tcase ResizeMode.TOP_EDGE:\t\t\t\tcanvas.style.cursor = 'n-resize'; \tbreak;\n\t\t\tcase ResizeMode.BOTTOM_EDGE:\t\t\tcanvas.style.cursor = 's-resize'; \tbreak;\n\n\t\t\t// Multi boundary\n\t\t\tcase ResizeMode.CROSS_SPLIT:\t\t\tcanvas.style.cursor = 'move'; \t\tbreak;\n\t\t\tcase ResizeMode.HORIZONTAL_SPLIT:\t\tcanvas.style.cursor = 'ns-resize';\tbreak;\n\t\t\tcase ResizeMode.VERTICAL_SPLIT:\t\t\tcanvas.style.cursor = 'ew-resize';\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (bUnder && this.state.clickedBoundary)\n\t\t\t\t\tcanvas.style.cursor = 'grabbing';\n\t\t\t\telse if (bUnder)\n\t\t\t\t\tcanvas.style.cursor = 'grab';\n\t\t\t\telse\n\t\t\t\t\tcanvas.style.cursor = 'crosshair';\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonMouseDown = (event: React.MouseEvent<HTMLCanvasElement>) => {\n\t\tconst mousePos = this.getMousePos()\n\t\tconst mousePosCanvas = this.getMousePos(true)\n\n\t\tthis.setState({\n\t\t\tmouseButton: event.button,\n\t\t\tmouseDownPos: mousePos,\n\t\t\tmouseDownPosCanvas: mousePosCanvas\n\t\t})\n\n\t\tswitch (this.props.mouseMode) {\n\t\t\tcase MouseMode.SNOOKER: {\n\t\t\t\t// Did we left-click on an object?\n\t\t\t\tif (event.button === 0) {\n\t\t\t\t\tthis.setState({snookerBody: this.bodyAtPosition(mousePos)})\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase MouseMode.BOUNDARY_EDIT: {\n\t\t\t\tconst bUnder = this.boundaryUnderMouse()\n\t\t\t\tconst bNear = this.boundariesNearMouse()\n\n\t\t\t\tif (!bUnder && !bNear.length)\n\t\t\t\t\tbreak\n\n\t\t\t\t// Left-click: check & prepare for resize\n\t\t\t\tlet resizeMode = ResizeMode.NONE\n\t\t\t\tif (event.button === 0) {\n\t\t\t\t\tresizeMode = this.checkResizeMode(bUnder, bNear)\n\t\t\t\t\tthis.updateCanvasCursorStyle(resizeMode, bUnder)\n\t\t\t\t}\n\n\t\t\t\t// Mouse button went down near 2 or 4 adjacent boundaries\n\t\t\t\tif (bNear.length > 1) {\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tresizeBoundaries: bNear,\n\t\t\t\t\t\tresizeMode: resizeMode\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\t// Mouse button went down over a single boundary\n\t\t\t\telse if (bUnder) {\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tclickedBoundary: bUnder,\n\t\t\t\t\t\tclickedOldBounds: {\n\t\t\t\t\t\t\tmin: Object.assign({}, bUnder.bounds.min),\n\t\t\t\t\t\t\tmax: Object.assign({}, bUnder.bounds.max)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresizeMode: resizeMode\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tdefault: break\n\t\t}\n\t}\n\n\tonMouseUp = (event: React.MouseEvent<HTMLCanvasElement>) => {\n\t\tif (!this.matterWorld)\n\t\t\treturn\n\n\t\tconst mousePos = this.getMousePos()\n\t\tconst mousePosCanvas = this.getMousePos(true)\n\t\tconst click = \tthis.state.mouseButton === event.button &&\n\t\t\t\t\t\tthis.state.mouseDownPosCanvas &&\n\t\t\t\t\t\t(this.state.mouseDownPosCanvas.x === mousePosCanvas.x &&\n\t\t\t\t\t\tthis.state.mouseDownPosCanvas.y === mousePosCanvas.y)\n\n\t\tswitch (this.props.mouseMode) {\n\t\t\tcase MouseMode.OBJECT: {\n\t\t\t\t// Dragging an object, bail out\n\t\t\t\tif (this.state.draggingBody)\n\t\t\t\t\tbreak\n\n\t\t\t\t// Left-click: add new object\n\t\t\t\tif (event.button === 0) {\n\t\t\t\t\tconst body = Matter.Bodies.circle(mousePos.x, mousePos.y, 20, { restitution: 0.5 })\n\n\t\t\t\t\tMatter.World.add(this.matterWorld, body)\n\t\t\t\t\tif (this.props.onObjectAdded)\n\t\t\t\t\tthis.props.onObjectAdded(body)\n\t\t\t\t}\n\n\t\t\t\t// Right-click: delete object\n\t\t\t\telse if (event.button === 2) {\n\t\t\t\t\tconst body = this.bodyAtPosition(mousePos)\n\t\t\t\t\tif (body) {\n\t\t\t\t\t\tif (this.props.onObjectDeleted)\n\t\t\t\t\t\tthis.props.onObjectDeleted(body.id)\n\t\t\t\t\t\tMatter.Composite.remove(this.matterWorld, body)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase MouseMode.SNOOKER: {\n\t\t\t\tif (!this.state.snookerBody || event.button !== 0)\n\t\t\t\t\tbreak\n\n\t\t\t\tconst body = this.state.snookerBody\n\t\t\t\tconst force = Matter.Vector.mult(Matter.Vector.sub(body.position, mousePos), 0.001 * body.mass)\n\n\t\t\t\tMatter.Body.applyForce(body, body.position, force)\n\t\t\t\tthis.setState({ snookerBody: undefined })\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase MouseMode.BOUNDARY_EDIT: {\n\t\t\t\t// Did we just finish resizing? Clear state and bail out\n\t\t\t\tif (this.state.resizeMode !== ResizeMode.NONE) {\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tresizeMode: ResizeMode.NONE,\n\t\t\t\t\t\tresizeBoundaries: undefined\n\t\t\t\t\t})\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\t// Did we right-click on an existing boundary? Delete it and bail out\n\t\t\t\tif (this.props.onBoundaryDeleted && event.button === 2 && click && this.state.clickedBoundary) {\n\t\t\t\t\tthis.props.onBoundaryDeleted(this.state.clickedBoundary)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\t// Otherwise, add a new boundary\n\t\t\t\tif (this.props.onBoundaryAdded && event.button === 0 && this.state.mouseDownPos)\n\t\t\t\t\tthis.props.onBoundaryAdded(createBounds(this.state.mouseDownPos, mousePos))\n\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tdefault: break\n\t\t}\n\n\t\tthis.setState({\n\t\t\tmouseButton: undefined,\n\t\t\tmouseDownPos: undefined,\n\t\t\tmouseDownPosCanvas: undefined,\n\t\t\tclickedBoundary: undefined,\n\t\t\tclickedOldBounds: undefined\n\t\t})\n\n\t\tthis.updateCanvasCursorStyle(undefined, this.boundaryUnderMouse())\n\t}\n\n\tresizingMultiple = (b: Bounds | Array<Bounds>): b is Array<Bounds> => {\n\t\treturn (b as Array<Bounds>).length !== undefined\n\t}\n\n\tonMouseMove = (event: React.MouseEvent<HTMLCanvasElement>) => {\n\t\tif (!this.matterRender || !this.matterMouseConstraint)\n\t\t\treturn\n\n\t\tconst mousePos = this.getMousePos()\n\n\t\t// Right mouse button drag always pans\n\t\tif (this.state.mouseButton === 2) {\n\t\t\tif (!this.state.mouseDownPos || this.state.draggingBody)\n\t\t\t\treturn\n\n\t\t\tconst bounds = this.matterRender.bounds\n\t\t\tconst delta = {\n\t\t\t\tx: mousePos.x - this.state.mouseDownPos.x,\n\t\t\t\ty: mousePos.y - this.state.mouseDownPos.y\n\t\t\t}\n\n\t\t\t// Reposition viewport\n\t\t\tbounds.min = Matter.Vector.sub(bounds.min, delta)\n\t\t\tbounds.max = Matter.Vector.sub(bounds.max, delta)\n\n\t\t\t// Update mouse offset\n\t\t\tMatter.Mouse.setOffset(this.matterMouseConstraint.mouse, bounds.min)\n\t\t\treturn\n\t\t}\n\n\t\t// Left mouse buttton drag actions\n\t\tswitch (this.props.mouseMode) {\n\t\t\tcase MouseMode.BOUNDARY_EDIT: {\n\t\t\t\t// Not resizing or moving\n\t\t\t\tif (this.state.resizeMode === ResizeMode.NONE && !this.state.clickedBoundary) {\n\t\t\t\t\t// Just look for boundaries near the mouse and update the cursor\n\t\t\t\t\tconst bUnder = this.boundaryUnderMouse()\n\t\t\t\t\tconst bNear = this.boundariesNearMouse()\n\t\t\t\t\tthis.updateCanvasCursorStyle(this.checkResizeMode(bUnder, bNear))\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\t// Bail out if we don't have a callback\n\t\t\t\tif (!this.props.onBoundariesUpdated)\n\t\t\t\t\tbreak\n\n\t\t\t\tif (this.state.resizeBoundaries) {\n\t\t\t\t\tswitch (this.state.resizeMode) {\n\t\t\t\t\t\tcase ResizeMode.CROSS_SPLIT: {\n\t\t\t\t\t\t\tconst resizeInfo: Array<BoundaryResizeInfo> = this.state.resizeBoundaries.map((b) => {\n\t\t\t\t\t\t\t\tconst bounds = b.bounds\n\n\t\t\t\t\t\t\t\tlet newBounds = {\n\t\t\t\t\t\t\t\t\tmin: Object.assign({}, bounds.min),\n\t\t\t\t\t\t\t\t\tmax: Object.assign({}, bounds.max)\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Find the closest corner to the mouse\n\t\t\t\t\t\t\t\tconst dists = [\n\t\t\t\t\t\t\t\t\tdistanceSq(mousePos, bounds.min),\t\t\t\t\t\t\t// Top left\n\t\t\t\t\t\t\t\t\tdistanceSq(mousePos, { x: bounds.max.x, y: bounds.min.y }),\t// Top right\n\t\t\t\t\t\t\t\t\tdistanceSq(mousePos, bounds.max),\t\t\t\t\t\t\t// Bottom right\n\t\t\t\t\t\t\t\t\tdistanceSq(mousePos, { x: bounds.min.x, y: bounds.max.y }),\t// Bottom left\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\tconst minIndex = dists.reduce((minIndex, dist, i, dists) => dist < dists[minIndex] ? i : minIndex, 0)\n\n\t\t\t\t\t\t\t\t// Adjust the closest corner\n\t\t\t\t\t\t\t\tswitch (minIndex) {\n\t\t\t\t\t\t\t\t\t// Top left\n\t\t\t\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\t\t\t\tnewBounds.min.x = mousePos.x\n\t\t\t\t\t\t\t\t\t\tnewBounds.min.y = mousePos.y\n\t\t\t\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\t\t\t\t// Top right\n\t\t\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\t\t\tnewBounds.max.x = mousePos.x\n\t\t\t\t\t\t\t\t\t\tnewBounds.min.y = mousePos.y\n\t\t\t\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\t\t\t\t// Bottom right\n\t\t\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\t\t\tnewBounds.max.x = mousePos.x\n\t\t\t\t\t\t\t\t\t\tnewBounds.max.y = mousePos.y\n\t\t\t\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\t\t\t\t// Bottom left\n\t\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\t\tnewBounds.min.x = mousePos.x\n\t\t\t\t\t\t\t\t\t\tnewBounds.max.y = mousePos.y\n\t\t\t\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Fixup so that min is always at the top left and max is always at the bottom right\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tboundary: b,\n\t\t\t\t\t\t\t\t\tnewBounds: createBounds(newBounds.min, newBounds.max)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tthis.props.onBoundariesUpdated(resizeInfo)\n\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase ResizeMode.HORIZONTAL_SPLIT:\n\t\t\t\t\t\tcase ResizeMode.VERTICAL_SPLIT:\n\t\t\t\t\t\t\tvar b1 = this.state.resizeBoundaries[0]\n\t\t\t\t\t\t\tvar b2 = this.state.resizeBoundaries[1]\n\n\t\t\t\t\t\t\tvar newBounds1\n\t\t\t\t\t\t\tvar newBounds2\n\n\t\t\t\t\t\t\tif (this.state.resizeMode === ResizeMode.HORIZONTAL_SPLIT) {\n\t\t\t\t\t\t\t\t// Swap boundary order if necessary\n\t\t\t\t\t\t\t\tif (b1.bounds.max.y > b2.bounds.min.y)\n\t\t\t\t\t\t\t\t\t[b1, b2] = [b2, b1]\n\t\t\t\t\t\t\t\tnewBounds1 = createBounds(b1.bounds.min, { x: b1.bounds.max.x, y: mousePos.y })\n\t\t\t\t\t\t\t\tnewBounds2 = createBounds({ x: b2.bounds.min.x, y: mousePos.y }, b2.bounds.max)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (b1.bounds.max.x > b2.bounds.min.x)\n\t\t\t\t\t\t\t\t\t[b1, b2] = [b2, b1]\n\t\t\t\t\t\t\t\tnewBounds1 = createBounds(b1.bounds.min, { x: mousePos.x, y: b1.bounds.max.y })\n\t\t\t\t\t\t\t\tnewBounds2 = createBounds({ x: mousePos.x, y: b2.bounds.min.y }, b2.bounds.max)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Update boundaries\n\t\t\t\t\t\t\tthis.props.onBoundariesUpdated([\n\t\t\t\t\t\t\t\t{ boundary: b1, newBounds: newBounds1 },\n\t\t\t\t\t\t\t\t{ boundary: b2, newBounds: newBounds2 },\n\t\t\t\t\t\t\t])\n\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t} else if (this.state.clickedBoundary && this.state.clickedOldBounds) {\n\t\t\t\t\tlet newBounds = {\n\t\t\t\t\t\tmin: Object.assign({}, this.state.clickedOldBounds.min),\n\t\t\t\t\t\tmax: Object.assign({}, this.state.clickedOldBounds.max)\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (this.state.resizeMode) {\n\t\t\t\t\t\tcase ResizeMode.TOP_LEFT_CORNER:\n\t\t\t\t\t\t\tnewBounds.min.x = mousePos.x\n\t\t\t\t\t\t\tnewBounds.min.y = mousePos.y\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tcase ResizeMode.TOP_RIGHT_CORNER:\n\t\t\t\t\t\t\tnewBounds.max.x = mousePos.x\n\t\t\t\t\t\t\tnewBounds.min.y = mousePos.y\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tcase ResizeMode.BOTTOM_LEFT_CORNER:\n\t\t\t\t\t\t\tnewBounds.min.x = mousePos.x\n\t\t\t\t\t\t\tnewBounds.max.y = mousePos.y\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tcase ResizeMode.BOTTOM_RIGHT_CORNER:\n\t\t\t\t\t\t\tnewBounds.max.x = mousePos.x\n\t\t\t\t\t\t\tnewBounds.max.y = mousePos.y\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tcase ResizeMode.LEFT_EDGE:\n\t\t\t\t\t\t\tnewBounds.min.x = mousePos.x\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tcase ResizeMode.RIGHT_EDGE:\n\t\t\t\t\t\t\tnewBounds.max.x = mousePos.x\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tcase ResizeMode.TOP_EDGE:\n\t\t\t\t\t\t\tnewBounds.min.y = mousePos.y\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tcase ResizeMode.BOTTOM_EDGE:\n\t\t\t\t\t\t\tnewBounds.max.y = mousePos.y\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// Moving\n\t\t\t\t\t\t\tif (!this.state.mouseDownPos)\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\tconst mouseDelta = Matter.Vector.sub(mousePos, this.state.mouseDownPos)\n\t\t\t\t\t\t\tnewBounds.min = Matter.Vector.add(newBounds.min, mouseDelta)\n\t\t\t\t\t\t\tnewBounds.max = Matter.Vector.add(newBounds.max, mouseDelta)\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\n\t\t\t\t\t// Fixup so that min is always at the top left and max is always at the bottom right\n\t\t\t\t\tnewBounds = createBounds(newBounds.min, newBounds.max)\n\n\t\t\t\t\t// Update cursor\n\t\t\t\t\tthis.updateCanvasCursorStyle(this.state.resizeMode, this.state.clickedBoundary)\n\n\t\t\t\t\t// Update boundary\n\t\t\t\t\tthis.props.onBoundariesUpdated([\n\t\t\t\t\t\t{ boundary: this.state.clickedBoundary, newBounds: newBounds }\n\t\t\t\t\t])\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tonMouseOver = (event: React.MouseEvent<HTMLCanvasElement>) => {\n\t\t// Show crosshair and coords\n\t\tthis.setState({ showCrosshair: true })\n\t}\n\n\tonMouseOut = (event: React.MouseEvent<HTMLCanvasElement>) => {\n\t\tthis.setState({\n\t\t\t// Hide crosshair and coords\n\t\t\tshowCrosshair: false,\n\n\t\t\t// Clear drawing/resizing state\n\t\t\tmouseDownPos: undefined,\n\t\t\tclickedBoundary: undefined\n\t\t})\n\t}\n\n\tonWheel = (event: React.WheelEvent<HTMLCanvasElement>) => {\n\t\tif (!this.matterMouse || !this.matterRender)\n\t\t\treturn\n\n\t\tconst mouse = this.matterMouse\n\t\tconst zoomFactor = event.deltaY < 0 ? 0.9 : 1 / 0.9\n\t\tconst bounds = this.matterRender.bounds\n\n\t\t// Reposition viewport (i.e. min = zoomFactor * (min - mousePos) + mousePos)\n\t\tbounds.min = Matter.Vector.add(Matter.Vector.mult(Matter.Vector.sub(bounds.min, mouse.position), zoomFactor), mouse.position)\n\t\tbounds.max = Matter.Vector.add(Matter.Vector.mult(Matter.Vector.sub(bounds.max, mouse.position), zoomFactor), mouse.position)\n\t}\n\n\tspawnRandomObjects = (count: number) => {\n\t\tif (!this.matterRender || !this.matterWorld)\n\t\t\treturn\n\n\t\tlet bodies = []\n\t\tfor (let i = 0; i < count; ++i) {\n\t\t\tconst x = random(this.matterRender.bounds.min.x, this.matterRender.bounds.max.x, true)\n\t\t\tconst y = random(this.matterRender.bounds.min.y, this.matterRender.bounds.max.y, true)\n\t\t\tbodies.push(Matter.Bodies.circle(x, y, 10, { restitution: 0.5 }))\n\t\t}\n\n\t\tMatter.World.add(this.matterWorld, bodies)\n\t}\n\n\tclearAllObjects = () => {\n\t\tif (!this.matterMouseConstraint || !this.matterWorld)\n\t\t\treturn\n\n\t\t// Remove the bodies\n\t\tMatter.World.clear(this.matterWorld, false)\n\n\t\t// Re-add mouse constraint\n\t\tMatter.World.add(this.matterWorld, this.matterMouseConstraint)\n\t}\n\n\tshowAllObjects = () => {\n\t\tif (!this.matterWorld)\n\t\t\treturn\n\n\t\tif (this.matterWorld.bodies.length > 0)\n\t\t\tRenderAuraProj.lookAt(this.matterRender, this.matterWorld.bodies, {x: 50, y: 50}, true)\n\t}\n\n\tresetView = () => {\n\t\tif (!this.state.canvasRef.current || !this.matterRender)\n\t\t\treturn\n\n\t\tconst canvas = this.state.canvasRef.current\n\t\tconst render = this.matterRender\n\n\t\tlet halfExtent = {x: canvas.width / 2, y: canvas.height / 2} as Matter.Vector\n\t\trender.bounds.min = Matter.Vector.neg(halfExtent)\n\t\trender.bounds.max = halfExtent\n\t}\n\n\t// Convert a position in world space to canvas space\n\tworldToCanvas = (position: Point) => {\n\t\tif (!this.matterRender)\n\t\t\treturn {x: 0, y: 0} as Point\n\n\t\tconst render = this.matterRender\n\t\tconst scale = render.canvas.width / (render.bounds.max.x - render.bounds.min.x)\n\t\treturn Matter.Vector.mult(Matter.Vector.sub(position, render.bounds.min), scale)\n\t}\n\n\tboundaryUnderMouse = (): Boundary | undefined => {\n\t\tif (!this.matterMouse)\n\t\t\treturn undefined\n\n\t\tconst mouse = this.matterMouse\n\t\treturn this.props.boundaries.find(b => { return pointInBounds(mouse.position, b.bounds) })\n\t}\n\n\tboundariesNearMouse = (): Array<Boundary> => {\n\t\tif (!this.matterMouse)\n\t\t\treturn []\n\n\t\tconst mouse = this.matterMouse\n\t\treturn this.props.boundaries.filter(b => {\n\t\t\treturn circleOverlapBounds(mouse.position, MOUSE_BOUNDS_THRESHOLD / 2, b.bounds)\n\t\t})\n\t}\n\n\tbodyAtPosition = (position: Point) => {\n\t\tif (!this.matterWorld)\n\t\t\treturn\n\n\t\tconst allBodies = Matter.Composite.allBodies(this.matterWorld)\n\t\tconst bodies = Matter.Query.point(allBodies, position)\n\t\treturn bodies[0]\n\t}\n\n\t// Get position of mouse in canvas or world space (snapped to grid if necessary)\n\tgetMousePos = (canvas = false, forceUnsnapped = false) => {\n\t\tif (!this.matterMouse)\n\t\t\treturn {x: 0, y: 0} as Point\n\n\t\tconst gridSize = this.props.gridSize\n\t\tconst mousePos = Object.assign({}, this.matterMouse.position) as Point\n\n\t\tif (!forceUnsnapped && this.props.snapToGrid) {\n\t\t\tmousePos.x = Math.round(mousePos.x / gridSize) * gridSize\n\t\t\tmousePos.y = Math.round(mousePos.y / gridSize) * gridSize\n\t\t}\n\n\t\treturn canvas ? this.worldToCanvas(mousePos) : mousePos\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t// Don't apply any borders/scaling etc to the canvas directly or mouse coords will be off\n\t\t\t<div id={\"canvasContainer\"}>\n\t\t\t\t<canvas\n\t\t\t\t\tref={this.state.canvasRef}\n\t\t\t\t\tonMouseDown={this.onMouseDown}\n\t\t\t\t\tonMouseUp={this.onMouseUp}\n\t\t\t\t\tonMouseMove={this.onMouseMove}\n\t\t\t\t\tonMouseOver={this.onMouseOver}\n\t\t\t\t\tonMouseOut={this.onMouseOut}\n\t\t\t\t\tonWheel={this.onWheel}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t)\n\t}\n}\n","///<reference path=\"./types/types.d.ts\" />\n\nexport const createBounds = (p1: Point, p2: Point) => {\n\treturn {\n\t\tmin: {\n\t\t\tx: Math.min(p1.x, p2.x),\n\t\t\ty: Math.min(p1.y, p2.y),\n\t\t},\n\t\tmax: {\n\t\t\tx: Math.max(p1.x, p2.x),\n\t\t\ty: Math.max(p1.y, p2.y),\n\t\t}\n\t}\n}\n\nexport const boundsOverlap = (b1: Bounds, b2: Bounds) => !(b2.min.x >= b1.max.x || b2.max.x <= b1.min.x || b2.max.y <= b1.min.y || b2.min.y >= b1.max.y)\n\nexport const circleOverlapBounds = (p: Point, r: number, b: Bounds) => {\n\tconst bHalfWidth = (b.max.x - b.min.x) / 2\n\tconst bHalfHeight = (b.max.y - b.min.y) / 2\n\tconst bCenter = {\n\t\tx: b.min.x + bHalfWidth,\n\t\ty: b.min.y + bHalfHeight\n\t}\n\tconst dist = {\n\t\tx: Math.abs(p.x - bCenter.x),\n\t\ty: Math.abs(p.y - bCenter.y)\n\t}\n\n\tif (dist.x > bHalfWidth + r) return false\n\tif (dist.y > bHalfHeight + r) return false\n\n\tif (dist.x <= bHalfWidth) return true\n\tif (dist.y <= bHalfHeight) return true\n\n\tconst cornerDistSq = Math.pow(dist.x - bHalfWidth, 2) + Math.pow(dist.y - bHalfHeight, 2)\n\treturn cornerDistSq <= Math.pow(r, 2)\n}\n\nexport const distanceSq = (p1: Point, p2: Point) => {\n\tconst dx = p1.x - p2.x\n\tconst dy = p1.y - p2.y\n\treturn dx * dx + dy * dy\n}\n\nexport const pointInBounds = (p: Point, b: Bounds, includeEdges: boolean = true) => {\n\tif (includeEdges)\n\t\treturn p.x >= b.min.x && p.x <= b.max.x && p.y >= b.min.y && p.y <= b.max.y\n\telse\n\t\treturn p.x > b.min.x && p.x < b.max.x && p.y > b.min.y && p.y < b.max.y\n}\n\nexport const pointNearBounds = (p: Point, r: number, b: Bounds) => {\n\treturn  p.x - r < b.min.x ||\n\t\t\tp.x + r > b.max.x ||\n\t\t\tp.y - r < b.min.y ||\n\t\t\tp.y + r > b.max.y\n}\n\nexport const resizeBounds2WaySplit = (boundaries: Array<Boundary>, mousePos: Point, vertical: boolean) => {\n\n}\n\nexport const resizeBounds4WaySplit = (boundaries: Array<Boundary>, mousePos: Point) => {\n\n}\n\nexport const evaluateUtilFunction = (func: SubUtilityFunction, boundary: Boundary, constants: UtilityVariables, globalVars: UtilityVariables) => {\n\ttry {\n\t\treturn func.evalFunc({\n\t\t\t[func.utilVar]: boundary.vars[func.utilVar],\n\n\t\t\t// Non-boundary variables\n\t\t\t...constants,\n\t\t\t...globalVars\n\t\t})\n\t} catch {\n\t\treturn 0\n\t}\n}\n\nexport const evaluateServerUtilFunction = (serverUtilFunc: UtilityFunction, utilFuncs: Array<SubUtilityFunction>, boundary: Boundary, constants: UtilityVariables, globalVars: UtilityVariables) => {\n\tif (!serverUtilFunc.evalFunc)\n\t\treturn 0\n\n\tconst utilValues = {...boundary.vars, ...constants, ...globalVars}\n\tutilFuncs.forEach(func => {\n\t\tif (!func.evalFunc || func.utilVar === 'x')\n\t\t\treturn\n\t\tutilValues[`U_${func.utilVar}`] = evaluateUtilFunction(func, boundary, constants, globalVars)\n\t})\n\n\ttry {\n\t\treturn serverUtilFunc.evalFunc(utilValues)\n\t} catch(e) {\n\t\treturn 0\n\t}\n}","///<reference path=\"./types/types.d.ts\" />\n\nimport * as React from 'react'\n\nimport MathJax from 'react-mathjax2'\nimport Table from 'react-bootstrap/Table'\n\nimport ContentEditable from 'react-contenteditable'\n\n/*\ncost of sending and receiving an object migration\ncost of sending and receiving an aura creation\ncost of sending and receiving an aura update\ncost of sending and receiving an aura deletion\ncost of maintaining an aura on the sending and receiving side\nand then of course cost of simulating an object, but this is really dependent on what it is doing (sleeping or not, number of contacts, number of nearby objects)\nthen you can calculate the cost of having a boundary in particular place, depending on all the above factors\nthere's also the cost of number of objects that are completely out of their host server's region as the islands check has to be performed on them\n*/\n\nexport const constants: Variables = {\n\tC_m: {\n\t\tdesc: \"Cost of sending and receiving an object migration\",\n\t\tdefaultValue: 1\n\t},\n\tC_c: {\n\t\tdesc: \"Cost of sending and receiving an aura creation\",\n\t\tdefaultValue: 1\n\t},\n\tC_u: {\n\t\tdesc: \"Cost of sending and receiving an aura update\",\n\t\tdefaultValue: 1\n\t},\n\tC_d: {\n\t\tdesc: \"Cost of sending and receiving an aura deletion\",\n\t\tdefaultValue: 1\n\t},\n\tC_i: {\n\t\tdesc: \"Cost of number of objects out of host region (islands)\",\n\t\tdefaultValue: 1\n\t}\n}\n\nexport const globalVars: Variables = {\n\tsigma: {\n\t\ttype: \"count\",\n\t\tdesc: \"Number of servers\"\n\t},\n\tN: {\n\t\ttype: \"count\",\n\t\tdesc: \"Total number of objects in the world\"\n\t},\n\tt: {\n\t\ttype: \"count\",\n\t\tdesc: \"Time since boundaries were last moved (seconds)\"\n\t}\n}\n\nexport const vars: Variables = {\n\tlambda: {\n\t\ttype: \"proportion\",\n\t\tdesc: \"CPU load of the server\",\n\t},\n\tdelta: {\n\t\ttype: \"count\",\n\t\tdesc: \"Frame time for the physics simulation step (milliseconds)\",\n\t},\n\talpha: {\n\t\ttype: \"proportion\",\n\t\tdesc: \"Number of active (awake) objects\",\n\t},\n\tbeta: {\n\t\ttype: \"proportion\",\n\t\tdesc: \"Number of objects near a boundary\",\n\t},\n\tn: {\n\t\ttype: \"count\",\n\t\tdesc: \"Number of objects managed by this server\",\n\t}\n}\n\ninterface VariablesProps {\n\tboundaries: Array<Boundary>,\n\tutilConstants: UtilityConstants,\n\tutilGlobalVars: UtilityVariables,\n\tonUtilConstantUpdated: UtilConstantUpdatedCallback\n}\n\nexport const Variables: React.FC<VariablesProps> = (props) => {\n\treturn (\n\t\t<div>\n\t\t\t<h5>Constants (click to edit)</h5>\n\t\t\t<Table hover striped size=\"sm\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Value</th>\n\t\t\t\t\t\t<th>Description</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t{ Object.keys(props.utilConstants).map((v, i) =>\n\t\t\t\t\t<tr key={i}>\n\t\t\t\t\t\t<td><MathJax.Node>{v}</MathJax.Node></td>\n\t\t\t\t\t\t<ContentEditable html={`${props.utilConstants[v]}`} tagName=\"td\" onChange={ e => props.onUtilConstantUpdated(v, parseFloat(e.target.value.trim())) }/>\n\t\t\t\t\t\t<td>{constants[v].desc}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t) }\n\t\t\t\t</tbody>\n\t\t\t</Table>\n\n\t\t\t<h5>Global variables</h5>\n\t\t\t<Table hover striped size=\"sm\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Value</th>\n\t\t\t\t\t\t<th>Type</th>\n\t\t\t\t\t\t<th>Description</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t{ Object.keys(props.utilGlobalVars).map((v, i) =>\n\t\t\t\t\t<tr key={i}>\n\t\t\t\t\t\t<td><MathJax.Node>{v}</MathJax.Node></td>\n\t\t\t\t\t\t<td>{props.utilGlobalVars[v].toFixed(2)}</td>\n\t\t\t\t\t\t<td>{globalVars[v].type}</td>\n\t\t\t\t\t\t<td>{globalVars[v].desc}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t) }\n\t\t\t\t</tbody>\n\t\t\t</Table>\n\n\t\t\t<h5>Server-local variables</h5>\n\t\t\t<Table hover striped size=\"sm\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Type</th>\n\t\t\t\t\t\t<th>Description</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t{ Object.keys(vars).map((v, i) =>\n\t\t\t\t\t<tr key={i}>\n\t\t\t\t\t\t<td><MathJax.Node>{v}</MathJax.Node></td>\n\t\t\t\t\t\t<td>{vars[v].type}</td>\n\t\t\t\t\t\t<td>{vars[v].desc}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t) }\n\t\t\t\t</tbody>\n\t\t\t</Table>\n\n\t\t\t<h5>Server-local variable values</h5>\n\t\t\t{ props.boundaries.length > 0 && <Table hover striped size=\"sm\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Server</th>\n\t\t\t\t\t\t{ Object.keys(props.boundaries[0].vars).map((v, i) => <th key={i} title={`${vars[v].desc} (${vars[v].type})`}><MathJax.Node>{v}</MathJax.Node></th>) }\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t{ props.boundaries.map((b, i) =>\n\t\t\t\t\t<tr key={i}>\n\t\t\t\t\t\t<td>{i}</td>\n\t\t\t\t\t\t{ Object.keys(b.vars).map((v, j) => <td key={j}>{b.vars[v].toFixed(2)}</td>) }\n\t\t\t\t\t</tr>\n\t\t\t\t) }\n\t\t\t\t</tbody>\n\t\t\t</Table> }\n\t\t</div>\n\t)\n}","///<reference path=\"./types/types.d.ts\" />\n\nimport * as React from 'react'\n\nimport MathJax from 'react-mathjax2'\nimport * as ReactColor from 'react-color'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nimport Button from 'react-bootstrap/Button'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport FormControl from 'react-bootstrap/FormControl'\nimport InputGroup from 'react-bootstrap/InputGroup'\nimport Tab from 'react-bootstrap/Tab'\nimport Table from 'react-bootstrap/Table'\nimport Tabs from 'react-bootstrap/Tabs'\n\nimport { evaluateServerUtilFunction } from './util'\nimport { vars, Variables } from './variables'\n\ninterface ControlPanelProps {\n\tshowColorPicker: boolean,\n\tcolorIndex?: number,\n\tonChangeColorClicked: ChangeColorClickedCallback,\n\tonColorUpdated: ColorUpdatedCallback,\n\n\tboundaries: Array<Boundary>,\n\tutilServer: UtilityFunction,\n\tutilFunctions: Array<SubUtilityFunction>,\n\tutilConstants: UtilityVariables,\n\tutilGlobalVars: UtilityVariables,\n\tonUtilFunctionAdded: UtilFuncAddedCallback,\n\tonUtilFunctionDeleted: UtilFuncDeletedCallback,\n\tonUtilFunctionUpdated: UtilFuncExpressionUpdatedCallback,\n\tonServerUtilFunctionUpdated: ServerUtilFuncExpressionUpdatedCallback,\n\tonUtilVarUpdated: UtilFuncVarUpdatedCallback,\n\tonUtilConstantUpdated: UtilConstantUpdatedCallback\n}\n\nexport const ControlPanel: React.FC<ControlPanelProps> = (props) => {\n\tconst popover: React.CSSProperties = {\n\t\tposition: 'absolute',\n\t\ttop: '2.5rem',\n\t\tright: 0,\n\t\tzIndex: 200,\n\t}\n\tconst cover: React.CSSProperties = {\n\t\tposition: 'fixed',\n\t\ttop: '0px',\n\t\tright: '0px',\n\t\tbottom: '0px',\n\t\tleft: '0px',\n\t}\n\n\tconst serverUtilValues = props.boundaries.map(b =>\n\t\tevaluateServerUtilFunction(props.utilServer, props.utilFunctions, b, props.utilConstants, props.utilGlobalVars)\n\t)\n\tconst globalUtilValue = serverUtilValues.length ? serverUtilValues.reduce((a, b) => a + b).toFixed(2) : 0\n\n\treturn (\n\t\t<Tabs id=\"control-panel\">\n\t\t\t<Tab eventKey=\"variables\" title=\"Variables\">\n\t\t\t\t<Variables boundaries={props.boundaries} utilConstants={props.utilConstants} utilGlobalVars={props.utilGlobalVars} onUtilConstantUpdated={props.onUtilConstantUpdated} />\n\t\t\t</Tab>\n\n\t\t\t<Tab eventKey=\"functions\" title=\"Functions\">\n\t\t\t\t<h5>Utility functions</h5>\n\t\t\t\t{ props.utilFunctions.map((func, i) =>\n\t\t\t\t\t<InputGroup className=\"mb-1\" key={i}>\n\t\t\t\t\t\t<InputGroup.Prepend>\n\t\t\t\t\t\t\t<InputGroup.Text>\n\t\t\t\t\t\t\t\t<MathJax.Node inline>{`U_${func.utilVar}=${func.expression}`}</MathJax.Node>\n\t\t\t\t\t\t\t</InputGroup.Text>\n\t\t\t\t\t\t</InputGroup.Prepend>\n\n\t\t\t\t\t\t<FormControl\n\t\t\t\t\t\t\tplaceholder=\"Function (in ASCIImath)\"\n\t\t\t\t\t\t\taria-label=\"Function (in ASCIImath)\"\n\t\t\t\t\t\t\tonChange={ (e: React.FormEvent<HTMLInputElement>) => e.currentTarget.value && props.onUtilFunctionUpdated(i, e.currentTarget.value) }\n\t\t\t\t\t\t\tvalue={func.expression}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<InputGroup.Append>\n\t\t\t\t\t\t\t<Dropdown>\n\t\t\t\t\t\t\t\t<Dropdown.Toggle id={`util-var-dropdown-${i}`} variant=\"dark\" style={{borderRadius: 0}}>\n\t\t\t\t\t\t\t\t\t<MathJax.Node inline>{func.utilVar}</MathJax.Node>\n\t\t\t\t\t\t\t\t</Dropdown.Toggle>\n\n\t\t\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\t\t\t<Dropdown.Header>Utility variable</Dropdown.Header>\n\t\t\t\t\t\t\t\t\t<Dropdown.Item onSelect={() => { props.onUtilVarUpdated(i, \"x\") }}>\n\t\t\t\t\t\t\t\t\t\t<MathJax.Node inline>x</MathJax.Node>\n\t\t\t\t\t\t\t\t\t</Dropdown.Item>\n\t\t\t\t\t\t\t\t\t<Dropdown.Divider />\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tObject.keys(vars).map((key, j) =>\n\t\t\t\t\t\t\t\t\t\t\t<Dropdown.Item key={j} onSelect={() => { props.onUtilVarUpdated(i, key) }}>\n\t\t\t\t\t\t\t\t\t\t\t\t<MathJax.Node>{key}</MathJax.Node>\n\t\t\t\t\t\t\t\t\t\t\t</Dropdown.Item>\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t\t\t</Dropdown>\n\n\t\t\t\t\t\t\t<Button onClick={() => props.onChangeColorClicked(i)} style={{backgroundColor: func.color}}><FontAwesomeIcon icon=\"palette\"/></Button>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprops.showColorPicker && props.colorIndex === i &&\n\t\t\t\t\t\t\t\t<div style={ popover }>\n\t\t\t\t\t\t\t\t\t<div style={ cover } onClick={ () => props.onChangeColorClicked(undefined) }/>\n\t\t\t\t\t\t\t\t\t<ReactColor.SketchPicker disableAlpha={true} color={func.color} onChange={props.onColorUpdated} />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t<Button variant=\"danger\" onClick={ () => props.onUtilFunctionDeleted(i) }>\n\t\t\t\t\t\t\t\t<FontAwesomeIcon icon=\"trash\"/>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</InputGroup.Append>\n\t\t\t\t\t</InputGroup>\n\t\t\t\t) }\n\t\t\t\t<Button className=\"mb-2\" variant=\"success\" onClick={props.onUtilFunctionAdded}><FontAwesomeIcon icon=\"plus\"/>&nbsp;Add function</Button>\n\n\t\t\t\t<h5>Local utility</h5>\n\t\t\t\t<InputGroup className=\"mb-1\">\n\t\t\t\t\t<InputGroup.Prepend>\n\t\t\t\t\t\t<InputGroup.Text>\n\t\t\t\t\t\t\t<MathJax.Node inline>{`U_i=${props.utilServer.expression}`}</MathJax.Node>\n\t\t\t\t\t\t</InputGroup.Text>\n\t\t\t\t\t</InputGroup.Prepend>\n\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tplaceholder=\"Function (in ASCIImath)\"\n\t\t\t\t\t\taria-label=\"Function (in ASCIImath)\"\n\t\t\t\t\t\tonChange={ (e: React.FormEvent<HTMLInputElement>) => e.currentTarget.value && props.onServerUtilFunctionUpdated(e.currentTarget.value) }\n\t\t\t\t\t\tvalue={props.utilServer.expression}\n\t\t\t\t\t/>\n\t\t\t\t</InputGroup>\n\t\t\t\t<Table hover striped size=\"sm\">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Server</th>\n\t\t\t\t\t\t\t<th><MathJax.Node>U_i</MathJax.Node></th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t{ props.boundaries.map((b, i) =>\n\t\t\t\t\t\t<tr key={i}>\n\t\t\t\t\t\t\t<td>{i}</td>\n\t\t\t\t\t\t\t<td><MathJax.Node>{ serverUtilValues[i].toFixed(2) }</MathJax.Node></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t) }\n\t\t\t\t\t</tbody>\n\t\t\t\t</Table>\n\n\t\t\t\t<h5>Global utility</h5>\n\t\t\t\t<MathJax.Node>U_g = U_0 + U_1 + ... + U_n</MathJax.Node>\n\t\t\t\t= {globalUtilValue}\n\t\t\t</Tab>\n\n\t\t\t<Tab eventKey=\"boundaries\" title=\"Boundaries\">\n\t\t\t\t<Table hover striped size=\"sm\">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>Server</td>\n\t\t\t\t\t\t\t<td><MathJax.Node>x_1</MathJax.Node></td>\n\t\t\t\t\t\t\t<td><MathJax.Node>y_1</MathJax.Node></td>\n\t\t\t\t\t\t\t<td><MathJax.Node>x_2</MathJax.Node></td>\n\t\t\t\t\t\t\t<td><MathJax.Node>y_2</MathJax.Node></td>\n\t\t\t\t\t\t\t<td>Width</td>\n\t\t\t\t\t\t\t<td>Height</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t{ props.boundaries.map((b, i) =>\n\t\t\t\t\t\t<tr key={i}>\n\t\t\t\t\t\t\t<td>{i}</td>\n\t\t\t\t\t\t\t<td>{b.bounds.min.x.toFixed(2)}</td>\n\t\t\t\t\t\t\t<td>{b.bounds.min.y.toFixed(2)}</td>\n\t\t\t\t\t\t\t<td>{b.bounds.max.x.toFixed(2)}</td>\n\t\t\t\t\t\t\t<td>{b.bounds.max.y.toFixed(2)}</td>\n\t\t\t\t\t\t\t<td>{(b.bounds.max.x - b.bounds.min.x).toFixed(2)}</td>\n\t\t\t\t\t\t\t<td>{(b.bounds.max.y - b.bounds.min.y).toFixed(2)}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t)}\n\t\t\t\t\t</tbody>\n\t\t\t\t</Table>\n\t\t\t</Tab>\n\t\t</Tabs>\n\t)\n}\n\nexport default ControlPanel","///<reference path=\"./types/types.d.ts\" />\n\nimport * as React from 'react'\nimport { Scatter } from 'react-chartjs-2'\nimport * as chartjs from 'chart.js'\nimport memoize from 'memoize-one'\n\nimport { evaluateUtilFunction } from './util'\n\ninterface FunctionPlotProps {\n\t// width: number,\n\t// height: number,\n\tboundaries: Array<Boundary>,\n\tutilFunctions: Array<SubUtilityFunction>,\n\tutilConstants: UtilityConstants,\n\tutilGlobalVars: UtilityVariables\n}\n\ninterface FunctionPlotState {\n\t// width: number,\n\t// height: number,\n\txRange: Array<number>,\n\tyRange: Array<number>\n}\n\nexport default class FunctionPlot extends React.Component<FunctionPlotProps, FunctionPlotState> {\n\tconstructor(props: FunctionPlotProps) {\n\t\tsuper(props)\n\n\t\tthis.state = {\n\t\t\t//width: props.width,\n\t\t\t//height: props.height,\n\t\t\txRange: [0, 1],\n\t\t\tyRange: [0, 1],\n\t\t}\n\t}\n\n\t// Memoized function returns cached results when arguments are the same as the last call\n\tprivate updateCurves = memoize((funcs: Array<SubUtilityFunction>, constants, globalVars) => {\n\t\tconst numSteps = 100\n\t\tconst stepSize = (this.state.xRange[1] - this.state.xRange[0]) / numSteps\n\n\t\t// Plot curves\n\t\tlet datasets = new Array<chartjs.ChartDataSets>()\n\t\tfuncs.forEach(func => {\n\t\t\tif (!func.evalFunc)\n\t\t\t\treturn\n\n\t\t\tlet dataset: chartjs.ChartDataSets = {\n\t\t\t\tlabel: `U(${func.utilVar})`,\n\t\t\t\tfill: false,\n\t\t\t\tshowLine: true,\n\t\t\t\tpointRadius: 0,\n\t\t\t\tpointHitRadius: 2,\n\t\t\t\tbackgroundColor: func.color,\n\t\t\t\tborderColor: func.color,\n\t\t\t\tborderWidth: 2\n\t\t\t}\n\n\t\t\tdataset.data = new Array<chartjs.ChartPoint>(numSteps)\n\n\t\t\ttry {\n\t\t\t\tfor (let x: number = this.state.xRange[0]; x <= this.state.xRange[1]; x += stepSize) {\n\t\t\t\t\tconst y: number = func.evalFunc({\n\t\t\t\t\t\t[func.utilVar]: x,\n\n\t\t\t\t\t\t// Non-boundary variables\n\t\t\t\t\t\t...constants,\n\t\t\t\t\t\t...globalVars\n\t\t\t\t\t})\n\n\t\t\t\t\tdataset.data.push({x, y})\n\t\t\t\t}\n\t\t\t\tdatasets.push(dataset)\n\t\t\t} catch(e) {\n\t\t\t\t// Skip this function\n\t\t\t}\n\t\t})\n\n\t\treturn datasets\n\t})\n\n\tprivate updatePoints = memoize((\n\t\tboundaries: Array<Boundary>,\n\t\tfuncs: Array<SubUtilityFunction>,\n\t\tconstants: UtilityConstants,\n\t\tglobalVars: UtilityVariables) => {\n\t\t\tlet datasets = new Array<chartjs.ChartDataSets>()\n\n\t\t\tfuncs.forEach(func => {\n\t\t\t\tif (!func.evalFunc || func.utilVar === 'x')\n\t\t\t\t\treturn\n\n\t\t\t\ttry {\n\t\t\t\tboundaries.forEach((b, i) => {\n\t\t\t\t\tconst x = b.vars[func.utilVar]\n\t\t\t\t\tconst y = evaluateUtilFunction(func, b, constants, globalVars)\n\n\t\t\t\t\tdatasets.push({\n\t\t\t\t\t\tlabel: `B${i} U(${func.utilVar})`,\n\t\t\t\t\t\tfill: true,\n\t\t\t\t\t\tshowLine: false,\n\t\t\t\t\t\tpointRadius: 6,\n\t\t\t\t\t\tpointStyle: 'circle',\n\t\t\t\t\t\tpointHitRadius: 2,\n\t\t\t\t\t\tbackgroundColor: b.color,\n\t\t\t\t\t\tborderColor: func.color,\n\t\t\t\t\t\tdata: [{x, y}]\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t} catch(e) {\n\t\t\t\t\t// Skip this function\n\t\t\t\t}\n\t\t\t})\n\n\t\treturn datasets\n\t})\n\n\trender() {\n\t\tconst curves = this.updateCurves(this.props.utilFunctions, this.props.utilConstants, this.props.utilGlobalVars)\n\t\tconst points = this.updatePoints(this.props.boundaries, this.props.utilFunctions, this.props.utilConstants, this.props.utilGlobalVars)\n\t\tconst data = { datasets: points.concat(curves) }\n\n\t\treturn (\n\t\t\t<Scatter\n\t\t\t\tdata={ data }\n\t\t\t\t//width={ this.state.width }\n\t\t\t\t//height={ this.state.height }\n\t\t\t\toptions={{\n\t\t\t\t\tmaintainAspectRatio: false,\n\t\t\t\t\tanimation: {\n\t\t\t\t\t\tduration: 0\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n}\n","///<reference path=\"./types/types.d.ts\" />\n\nimport React from 'react'\n\nimport { useDrop } from 'react-dnd'\nimport { NativeTypes } from 'react-dnd-html5-backend'\nimport Button from 'react-bootstrap/Button'\n\nconst outerStyle: React.CSSProperties = {\n\theight: '12rem',\n\tpadding: '1rem',\n\ttextAlign: 'center',\n\tfontSize: '1rem',\n\tlineHeight: 'normal',\n\tborder: '1px dashed darkgrey',\n\tborderRadius: '1rem',\n\tdisplay: 'table',\n\twidth: '100%'\n}\n\nconst middleStyle: React.CSSProperties = {\n\tdisplay: 'table-cell',\n\tverticalAlign: 'middle'\n}\n\nconst innerStyle: React.CSSProperties = {\n\tmarginLeft: 'auto',\n\tmarginRight: 'auto',\n}\n\ninterface ImportDropTargetProps {\n\tonFilesSelected?: FilesSelectedCallback\n}\n\nconst ImportDropTarget: React.FC<ImportDropTargetProps> = (props) => {\n\tlet fileUploader: HTMLInputElement | null = null\n\n\tconst [{ canDrop, isOver }, drop] = useDrop({\n\t\taccept: [ NativeTypes.FILE ],\n\t\tdrop: (item, monitor) => {\n\t\t\tconst files = monitor.getItem().files\n\t\t\tif (files && props.onFilesSelected)\n\t\t\t\tprops.onFilesSelected(files)\n\t\t},\n\t\tcollect: monitor => ({\n\t\t\tisOver: monitor.isOver(),\n\t\t\tcanDrop: monitor.canDrop()\n\t\t}),\n\t})\n\n\tlet backgroundColor = 'white'\n\n\t// Dragged file is over the drop zone\n\tif (canDrop && isOver) {\n\t\tbackgroundColor = 'lightgreen'\n\t\treturn (\n\t\t\t<div ref={drop} style={{ ...outerStyle, backgroundColor }}>\n\t\t\t\t<div style={ middleStyle }>\n\t\t\t\t\t<div style={ innerStyle }>\n\t\t\t\t\t\tRelease to drop!\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n\n\t// Dragged file is in the browser window\n\tif (canDrop) {\n\t\tbackgroundColor = 'lightyellow'\n\t\treturn (\n\t\t\t<div ref={drop} style={{ ...outerStyle, backgroundColor }}>\n\t\t\t\t<div style={ middleStyle }>\n\t\t\t\t\t<div style={ innerStyle }>\n\t\t\t\t\t\tDrag file here...\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n\n\t// No dragging\n\treturn (\n\t\t<div ref={drop} style={{ ...outerStyle, backgroundColor }}>\n\t\t\t<div style={ middleStyle }>\n\t\t\t\t<div style={ innerStyle }>\n\t\t\t\t\t<p>Drag and drop an exported .json file</p>\n\t\t\t\t\t<p>or:</p>\n\t\t\t\t\t<Button variant=\"success\" onClick={ () => { fileUploader && fileUploader.click() } }>\n\t\t\t\t\t\tSelect from your computer\n\t\t\t\t\t</Button>\n\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype='file'\n\t\t\t\t\t\tid='file'\n\t\t\t\t\t\tref={ (input) => { fileUploader = input } }\n\t\t\t\t\t\tstyle={ {display: 'none'} }\n\t\t\t\t\t\tonChange={ (event) => { event.target.files && props.onFilesSelected && props.onFilesSelected(event.target.files) } }\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n\nexport default ImportDropTarget\n","///<reference path=\"./types/types.d.ts\" />\n\nimport * as React from 'react';\nimport { Navbar, Nav } from 'react-bootstrap';\n\ninterface MainToolbarProps {\n\tonImportClickedCallback?: ImportClickedCallback,\n\tonExportClickedCallback?: ExportClickedCallback\n}\n\nexport const MainToolbar: React.FC<MainToolbarProps> = (props) => {\n\treturn <Navbar bg=\"dark\" variant=\"dark\" expand=\"lg\">\n\t\t<Navbar.Brand href=\"#home\">\n\t\t\t<img\n\t\t\t\tsrc=\"logo.svg\"\n\t\t\t\twidth=\"200\"\n\t\t\t\tclassName=\"d-inline-block align-top\"\n\t\t\t\talt=\"auratool\"\n\t\t\t/>\n\t\t</Navbar.Brand>\n\t\t<Navbar.Toggle aria-controls=\"responsive-navbar-nav\" />\n\t\t<Navbar.Collapse id=\"responsive-navbar-nav\">\n\t\t\t<Nav className=\"ml-auto\">\n\t\t\t\t<Nav.Link onClick={ () => props.onImportClickedCallback && props.onImportClickedCallback() }>Import</Nav.Link>\n\t\t\t\t<Nav.Link onClick={ () => props.onExportClickedCallback && props.onExportClickedCallback() }>Export</Nav.Link>\n\t\t\t</Nav>\n\t\t</Navbar.Collapse>\n\t</Navbar>\n}\n\nexport default MainToolbar","/**\n* Custom Matter.js Canvas renderer based on Matter.Render.\n*\n* @class RenderAuraProj\n*/\n\nimport Bounds from 'matter-js/src/geometry/Bounds'\nimport Common from 'matter-js/src/core/Common'\nimport Composite from 'matter-js/src/body/Composite'\nimport Events from 'matter-js/src/core/Events'\nimport Grid from 'matter-js/src/collision/Grid'\nimport Mouse from 'matter-js/src/core/Mouse'\nimport Vector from 'matter-js/src/geometry/Vector'\nimport { round } from 'lodash'\n\nexport class RenderAuraProj {\n\tstatic _requestAnimationFrame = (() => {\n\t\tif (typeof window !== 'undefined') {\n\t\t\treturn  window.requestAnimationFrame ||\n\t\t\t\t\twindow.webkitRequestAnimationFrame ||\n\t\t\t\t\twindow.mozRequestAnimationFrame ||\n\t\t\t\t\twindow.msRequestAnimationFrame ||\n\t\t\t\t\tfunction(callback) { window.setTimeout(function() { callback(Common.now()) }, 1000 / 60) }\n\n\t\t}\n\t})()\n\n\tstatic _cancelAnimationFrame = (() => {\n\t\tif (typeof window !== 'undefined') {\n\t\t\treturn  window.cancelAnimationFrame ||\n\t\t\t\t\twindow.mozCancelAnimationFrame ||\n\t\t\t\t\twindow.webkitCancelAnimationFrame ||\n\t\t\t\t\twindow.msCancelAnimationFrame\n\t\t}\n\t})()\n\n\tbounds\n\tcanvas\n\tcontext\n\tcurrentBackground\n\tengine\n\tframe\n\tframeRequestId\n\tmouse\n\toptions\n\ttextures\n\n\t/**\n\t * Creates a new renderer. The options parameter is an object that specifies any properties you wish to override the defaults.\n\t * All properties have default values, and many are pre-calculated automatically based on other properties.\n\t * See the properties section below for detailed information on what you can pass via the `options` object.\n\t * @method create\n\t * @param {object} [options]\n\t * @return {render} A new renderer\n\t */\n\tstatic create(options) {\n\t\tvar defaults = {\n\t\t\tcontroller: RenderAuraProj,\n\t\t\tengine: null,\n\t\t\telement: null,\n\t\t\tcanvas: null,\n\t\t\tmouse: null,\n\t\t\tframeRequestId: null,\n\t\t\toptions: {\n\t\t\t\twidth: 800,\n\t\t\t\theight: 600,\n\t\t\t\tpixelRatio: 1,\n\t\t\t\tbackground: '#18181d',\n\t\t\t\twireframeBackground: '#0f0f13',\n\t\t\t\tgridSize: 50,\n\t\t\t\thasBounds: !!options.bounds,\n\t\t\t\tenabled: true,\n\t\t\t\twireframes: true,\n\t\t\t\tshowSleeping: true,\n\t\t\t\tshowDebug: false,\n\t\t\t\tshowBroadphase: false,\n\t\t\t\tshowBounds: false,\n\t\t\t\tshowVelocity: false,\n\t\t\t\tshowCollisions: false,\n\t\t\t\tshowSeparations: false,\n\t\t\t\tshowAxes: false,\n\t\t\t\tshowPositions: false,\n\t\t\t\tshowAngleIndicator: false,\n\t\t\t\tshowIds: false,\n\t\t\t\tshowShadows: false,\n\t\t\t\tshowVertexNumbers: false,\n\t\t\t\tshowConvexHulls: false,\n\t\t\t\tshowInternalEdges: false,\n\t\t\t\tshowMousePosition: false,\n\t\t\t\tshowGrid: true,\n\t\t\t\tcrosshairSnap: false,\n\t\t\t}\n\t\t};\n\n\t\tvar render = Common.extend(defaults, options);\n\n\t\tif (render.canvas) {\n\t\t\trender.canvas.width = render.options.width || render.canvas.width;\n\t\t\trender.canvas.height = render.options.height || render.canvas.height;\n\t\t}\n\n\t\trender.mouse = options.mouse;\n\t\trender.engine = options.engine;\n\t\trender.canvas = render.canvas || RenderAuraProj._createCanvas(render.options.width, render.options.height);\n\t\trender.context = render.canvas.getContext('2d');\n\t\trender.textures = {};\n\n\t\trender.bounds = render.bounds || {\n\t\t\tmin: {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0\n\t\t\t},\n\t\t\tmax: {\n\t\t\t\tx: render.canvas.width,\n\t\t\t\ty: render.canvas.height\n\t\t\t}\n\t\t};\n\n\t\tif (render.options.pixelRatio !== 1) {\n\t\t\tRenderAuraProj.setPixelRatio(render, render.options.pixelRatio);\n\t\t}\n\n\t\tif (Common.isElement(render.element)) {\n\t\t\trender.element.appendChild(render.canvas);\n\t\t} else if (!render.canvas.parentNode) {\n\t\t\tCommon.log('RenderAuraProj.create: options.element was undefined, render.canvas was created but not appended', 'warn');\n\t\t}\n\n\t\treturn render;\n\t}\n\n\t/**\n\t * Continuously updates the render canvas on the `requestAnimationFrame` event.\n\t * @method run\n\t * @param {render} render\n\t */\n\tstatic run(render) {\n\t\t(function loop(time){\n\t\t\trender.frameRequestId = RenderAuraProj._requestAnimationFrame.call(window, loop);\n\t\t\tRenderAuraProj.world(render);\n\t\t})();\n\t};\n\n\t/**\n\t * Ends execution of `RenderAuraProj.run` on the given `render`, by canceling the animation frame request event loop.\n\t * @method stop\n\t * @param {render} render\n\t */\n\tstatic stop(render) {\n\t\tRenderAuraProj._cancelAnimationFrame.call(window, render.frameRequestId);\n\t};\n\n\t/**\n\t * Sets the pixel ratio of the renderer and updates the canvas.\n\t * To automatically detect the correct ratio, pass the string `'auto'` for `pixelRatio`.\n\t * @method setPixelRatio\n\t * @param {render} render\n\t * @param {number} pixelRatio\n\t */\n\tstatic setPixelRatio(render, pixelRatio) {\n\t\tvar options = render.options,\n\t\t\tcanvas = render.canvas;\n\n\t\tif (pixelRatio === 'auto') {\n\t\t\tpixelRatio = RenderAuraProj._getPixelRatio(canvas);\n\t\t}\n\n\t\toptions.pixelRatio = pixelRatio;\n\t\tcanvas.setAttribute('data-pixel-ratio', pixelRatio);\n\t\tcanvas.width = options.width * pixelRatio;\n\t\tcanvas.height = options.height * pixelRatio;\n\t\tcanvas.style.width = options.width + 'px';\n\t\tcanvas.style.height = options.height + 'px';\n\t};\n\n\t/**\n\t * Positions and sizes the viewport around the given object bounds.\n\t * Objects must have at least one of the following properties:\n\t * - `object.bounds`\n\t * - `object.position`\n\t * - `object.min` and `object.max`\n\t * - `object.x` and `object.y`\n\t * @method lookAt\n\t * @param {render} render\n\t * @param {object[]} objects\n\t * @param {vector} [padding]\n\t * @param {bool} [center=true]\n\t */\n\tstatic lookAt(render, objects, padding, center) {\n\t\tcenter = typeof center !== 'undefined' ? center : true;\n\t\tobjects = Common.isArray(objects) ? objects : [objects];\n\t\tpadding = padding || {\n\t\t\tx: 0,\n\t\t\ty: 0\n\t\t};\n\n\t\t// find bounds of all objects\n\t\tvar bounds = {\n\t\t\tmin: { x: Infinity, y: Infinity },\n\t\t\tmax: { x: -Infinity, y: -Infinity }\n\t\t};\n\n\t\tfor (var i = 0; i < objects.length; i += 1) {\n\t\t\tvar object = objects[i],\n\t\t\t\tmin = object.bounds ? object.bounds.min : (object.min || object.position || object),\n\t\t\t\tmax = object.bounds ? object.bounds.max : (object.max || object.position || object);\n\n\t\t\tif (min && max) {\n\t\t\t\tif (min.x < bounds.min.x)\n\t\t\t\t\tbounds.min.x = min.x;\n\n\t\t\t\tif (max.x > bounds.max.x)\n\t\t\t\t\tbounds.max.x = max.x;\n\n\t\t\t\tif (min.y < bounds.min.y)\n\t\t\t\t\tbounds.min.y = min.y;\n\n\t\t\t\tif (max.y > bounds.max.y)\n\t\t\t\t\tbounds.max.y = max.y;\n\t\t\t}\n\t\t}\n\n\t\t// find ratios\n\t\tvar width = (bounds.max.x - bounds.min.x) + 2 * padding.x,\n\t\t\theight = (bounds.max.y - bounds.min.y) + 2 * padding.y,\n\t\t\tviewHeight = render.canvas.height,\n\t\t\tviewWidth = render.canvas.width,\n\t\t\touterRatio = viewWidth / viewHeight,\n\t\t\tinnerRatio = width / height,\n\t\t\tscaleX = 1,\n\t\t\tscaleY = 1;\n\n\t\t// find scale factor\n\t\tif (innerRatio > outerRatio) {\n\t\t\tscaleY = innerRatio / outerRatio;\n\t\t} else {\n\t\t\tscaleX = outerRatio / innerRatio;\n\t\t}\n\n\t\t// enable bounds\n\t\trender.options.hasBounds = true;\n\n\t\t// position and size\n\t\trender.bounds.min.x = bounds.min.x;\n\t\trender.bounds.max.x = bounds.min.x + width * scaleX;\n\t\trender.bounds.min.y = bounds.min.y;\n\t\trender.bounds.max.y = bounds.min.y + height * scaleY;\n\n\t\t// center\n\t\tif (center) {\n\t\t\trender.bounds.min.x += width * 0.5 - (width * scaleX) * 0.5;\n\t\t\trender.bounds.max.x += width * 0.5 - (width * scaleX) * 0.5;\n\t\t\trender.bounds.min.y += height * 0.5 - (height * scaleY) * 0.5;\n\t\t\trender.bounds.max.y += height * 0.5 - (height * scaleY) * 0.5;\n\t\t}\n\n\t\t// padding\n\t\trender.bounds.min.x -= padding.x;\n\t\trender.bounds.max.x -= padding.x;\n\t\trender.bounds.min.y -= padding.y;\n\t\trender.bounds.max.y -= padding.y;\n\n\t\t// update mouse\n\t\tif (render.mouse) {\n\t\t\tMouse.setScale(render.mouse, {\n\t\t\t\tx: (render.bounds.max.x - render.bounds.min.x) / render.canvas.width,\n\t\t\t\ty: (render.bounds.max.y - render.bounds.min.y) / render.canvas.height\n\t\t\t});\n\n\t\t\tMouse.setOffset(render.mouse, render.bounds.min);\n\t\t}\n\t};\n\n\t/**\n\t * Applies viewport transforms based on `render.bounds` to a render context.\n\t * @method startViewTransform\n\t * @param {render} render\n\t */\n\tstatic startViewTransform(render) {\n\t\tvar boundsWidth = render.bounds.max.x - render.bounds.min.x,\n\t\t\tboundsHeight = render.bounds.max.y - render.bounds.min.y,\n\t\t\tboundsScaleX = boundsWidth / render.options.width,\n\t\t\tboundsScaleY = boundsHeight / render.options.height;\n\n\t\trender.context.setTransform(\n\t\t\trender.options.pixelRatio / boundsScaleX, 0, 0,\n\t\t\trender.options.pixelRatio / boundsScaleY, 0, 0\n\t\t);\n\n\t\trender.context.translate(-render.bounds.min.x, -render.bounds.min.y);\n\t};\n\n\t/**\n\t * Resets all transforms on the render context.\n\t * @method endViewTransform\n\t * @param {render} render\n\t */\n\tstatic endViewTransform(render) {\n\t\trender.context.setTransform(render.options.pixelRatio, 0, 0, render.options.pixelRatio, 0, 0);\n\t};\n\n\tstatic drawGrid(render, context) {\n\t\tconst gridSize = render.options.gridSize\n\t\tconst canvasWidth = render.canvas.width\n\t\tconst canvasHeight = render.canvas.height\n\t\tconst bounds = render.bounds\n\n\t\t// Convert between viewport/canvas coords\n\t\tconst boundsWidth = (bounds.max.x - bounds.min.x)\n\t\tconst boundsHeight = (bounds.max.y - bounds.min.y)\n\t\tconst scale = canvasWidth / boundsWidth\n\n\t\tconst xOriginOffset = -bounds.min.x\n\t\tconst yOriginOffset = -bounds.min.y\n\n\t\tconst xGridOffset = RenderAuraProj._mod(xOriginOffset, gridSize)\n\t\tconst yGridOffset = RenderAuraProj._mod(yOriginOffset, gridSize)\n\n\t\tconst gridStrokeStyle = 'rgb(128, 128, 255, 0.2)'\n\t\tconst originStrokeStyle = 'rgb(255, 128, 128, 0.5)'\n\n\t\tcontext.lineWidth = 1\n\t\tcontext.setLineDash([])\n\t\tcontext.strokeStyle = gridStrokeStyle\n\t\tcontext.fillStyle = 'black'\n\n\t\tconst drawXGridLine = (x, label) => {\n\t\t\tx = RenderAuraProj._roundDrawCoord(x)\n\t\t\tcontext.beginPath()\n\t\t\tcontext.moveTo(x, 0)\n\t\t\tcontext.lineTo(x, canvasHeight)\n\t\t\tcontext.stroke()\n\n\t\t\tcontext.fillText(label, x + 2, canvasHeight - 2)\n\t\t}\n\n\t\tconst drawYGridLine = (y, label) => {\n\t\t\ty = RenderAuraProj._roundDrawCoord(y)\n\t\t\tcontext.beginPath()\n\t\t\tcontext.moveTo(0, y)\n\t\t\tcontext.lineTo(canvasWidth, y)\n\t\t\tcontext.stroke()\n\n\t\t\tcontext.fillText(label, 0, y + 2)\n\t\t}\n\n\t\t// Axis labels\n\t\tvar xLabel = Math.floor(bounds.min.x / gridSize) * gridSize\n\t\tvar yLabel = Math.floor(bounds.min.y / gridSize) * gridSize\n\t\tif (xGridOffset !== 0) xLabel += gridSize\n\t\tif (yGridOffset !== 0) yLabel += gridSize\n\n\t\tfor (var x = xGridOffset; x < boundsWidth; x += gridSize, xLabel += gridSize) {\n\t\t\tif (RenderAuraProj._almostEqual(x, xOriginOffset)) {\n\t\t\t\t// Red origin line\n\t\t\t\tcontext.save()\n\t\t\t\tcontext.strokeStyle = originStrokeStyle\n\t\t\t\tdrawXGridLine(x * scale, xLabel)\n\t\t\t\tcontext.restore()\n\t\t\t}\n\t\t\telse drawXGridLine(x * scale, xLabel)\n\t\t}\n\n\t\tfor (var y = yGridOffset; y < boundsHeight; y += gridSize, yLabel += gridSize) {\n\t\t\tif (RenderAuraProj._almostEqual(y, yOriginOffset)) {\n\t\t\t\t// Red origin line\n\t\t\t\tcontext.save()\n\t\t\t\tcontext.strokeStyle = originStrokeStyle\n\t\t\t\tdrawYGridLine(y * scale, yLabel)\n\t\t\t\tcontext.restore()\n\t\t\t}\n\t\t\telse drawYGridLine(y * scale, yLabel)\n\t\t}\n\t};\n\n\tstatic drawCrosshair(render, context) {\n\t\tconst scale = render.canvas.width / (render.bounds.max.x - render.bounds.min.x)\n\t\tconst gridSize = render.options.gridSize\n\n\t\tif (!render.mouse)\n\t\t\treturn\n\n\t\tvar crosshairX = render.mouse.position.x\n\t\tvar crosshairY = render.mouse.position.y\n\n\t\tif (render.options.crosshairSnap) {\n\t\t\tcrosshairX = Math.round(crosshairX / gridSize) * gridSize\n\t\t\tcrosshairY = Math.round(crosshairY / gridSize) * gridSize\n\t\t}\n\n\t\tconst drawX = RenderAuraProj._roundDrawCoord((crosshairX - render.bounds.min.x) * scale)\n\t\tconst drawY = RenderAuraProj._roundDrawCoord((crosshairY - render.bounds.min.y) * scale)\n\n\t\tcontext.setLineDash([5, 8])\n\t\tcontext.lineWidth = 1\n\t\tcontext.strokeStyle = 'black'\n\t\tcontext.fillStyle = 'black'\n\n\t\tcontext.beginPath()\n\t\tcontext.moveTo(drawX, 0)\n\t\tcontext.lineTo(drawX, render.canvas.height)\n\t\tcontext.stroke()\n\n\t\tcontext.beginPath()\n\t\tcontext.moveTo(0, drawY)\n\t\tcontext.lineTo(render.canvas.width, drawY)\n\t\tcontext.stroke()\n\n\t\t// Draw coordinates\n\t\tcontext.fillText(`${round(crosshairX, 2)}, ${round(crosshairY, 2)}`, drawX + 10, drawY - 10)\n\t};\n\n\t/**\n\t * Renders the given `engine`'s `Matter.World` object.\n\t * This is the entry point for all rendering and should be called every time the scene changes.\n\t * @method world\n\t * @param {render} render\n\t */\n\tstatic world(render) {\n\t\tvar engine = render.engine,\n\t\t\tworld = engine.world,\n\t\t\tcanvas = render.canvas,\n\t\t\tcontext = render.context,\n\t\t\toptions = render.options,\n\t\t\tallBodies = Composite.allBodies(world),\n\t\t\tallConstraints = Composite.allConstraints(world),\n\t\t\tbackground = options.wireframes ? options.wireframeBackground : options.background,\n\t\t\tbodies = [],\n\t\t\tconstraints = [],\n\t\t\ti;\n\n\t\tvar event = {\n\t\t\ttimestamp: engine.timing.timestamp\n\t\t};\n\n\t\tEvents.trigger(render, 'beforeRender', event);\n\n\t\t// apply background if it has changed\n\t\tif (render.currentBackground !== background)\n\t\t\tRenderAuraProj._applyBackground(render, background);\n\n\t\t// clear the canvas with a transparent fill, to allow the canvas background to show\n\t\tcontext.globalCompositeOperation = 'source-in';\n\t\tcontext.fillStyle = \"transparent\";\n\t\tcontext.fillRect(0, 0, canvas.width, canvas.height);\n\t\tcontext.globalCompositeOperation = 'source-over';\n\n\t\t// Render grid\n\t\tif (render.options.showGrid)\n\t\t\tRenderAuraProj.drawGrid(render, context);\n\n\t\tEvents.trigger(render, 'beforeObjects', event);\n\n\t\t// handle bounds\n\t\tif (options.hasBounds) {\n\t\t\t// filter out bodies that are not in view\n\t\t\tfor (i = 0; i < allBodies.length; i++) {\n\t\t\t\tvar body = allBodies[i];\n\t\t\t\tif (Bounds.overlaps(body.bounds, render.bounds))\n\t\t\t\t\tbodies.push(body);\n\t\t\t}\n\n\t\t\t// filter out constraints that are not in view\n\t\t\tfor (i = 0; i < allConstraints.length; i++) {\n\t\t\t\tvar constraint = allConstraints[i],\n\t\t\t\t\tbodyA = constraint.bodyA,\n\t\t\t\t\tbodyB = constraint.bodyB,\n\t\t\t\t\tpointAWorld = constraint.pointA,\n\t\t\t\t\tpointBWorld = constraint.pointB;\n\n\t\t\t\tif (bodyA) pointAWorld = Vector.add(bodyA.position, constraint.pointA);\n\t\t\t\tif (bodyB) pointBWorld = Vector.add(bodyB.position, constraint.pointB);\n\n\t\t\t\tif (!pointAWorld || !pointBWorld)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (Bounds.contains(render.bounds, pointAWorld) || Bounds.contains(render.bounds, pointBWorld))\n\t\t\t\t\tconstraints.push(constraint);\n\t\t\t}\n\n\t\t\t// transform the view\n\t\t\tRenderAuraProj.startViewTransform(render);\n\n\t\t\t// update mouse\n\t\t\tif (render.mouse) {\n\t\t\t\tMouse.setScale(render.mouse, {\n\t\t\t\t\tx: (render.bounds.max.x - render.bounds.min.x) / render.options.width,\n\t\t\t\t\ty: (render.bounds.max.y - render.bounds.min.y) / render.options.height\n\t\t\t\t});\n\n\t\t\t\tMouse.setOffset(render.mouse, render.bounds.min);\n\t\t\t}\n\t\t} else {\n\t\t\tconstraints = allConstraints;\n\t\t\tbodies = allBodies;\n\n\t\t\tif (render.options.pixelRatio !== 1) {\n\t\t\t\trender.context.setTransform(render.options.pixelRatio, 0, 0, render.options.pixelRatio, 0, 0);\n\t\t\t}\n\t\t}\n\n\t\tif (!options.wireframes || (engine.enableSleeping && options.showSleeping)) {\n\t\t\t// fully featured rendering of bodies\n\t\t\tRenderAuraProj.bodies(render, bodies, context);\n\t\t} else {\n\t\t\tif (options.showConvexHulls)\n\t\t\t\tRenderAuraProj.bodyConvexHulls(render, bodies, context);\n\n\t\t\t// optimised method for wireframes only\n\t\t\tRenderAuraProj.bodyWireframes(render, bodies, context);\n\t\t}\n\n\t\tif (options.showBounds)\n\t\t\tRenderAuraProj.bodyBounds(render, bodies, context);\n\n\t\tif (options.showAxes || options.showAngleIndicator)\n\t\t\tRenderAuraProj.bodyAxes(render, bodies, context);\n\n\t\tif (options.showPositions)\n\t\t\tRenderAuraProj.bodyPositions(render, bodies, context);\n\n\t\tif (options.showVelocity)\n\t\t\tRenderAuraProj.bodyVelocity(render, bodies, context);\n\n\t\tif (options.showIds)\n\t\t\tRenderAuraProj.bodyIds(render, bodies, context);\n\n\t\tif (options.showSeparations)\n\t\t\tRenderAuraProj.separations(render, engine.pairs.list, context);\n\n\t\tif (options.showCollisions)\n\t\t\tRenderAuraProj.collisions(render, engine.pairs.list, context);\n\n\t\tif (options.showVertexNumbers)\n\t\t\tRenderAuraProj.vertexNumbers(render, bodies, context);\n\n\t\tif (options.showMousePosition)\n\t\t\tRenderAuraProj.mousePosition(render, render.mouse, context);\n\n\t\tRenderAuraProj.constraints(constraints, context);\n\n\t\tif (options.showBroadphase && engine.broadphase.controller === Grid)\n\t\t\tRenderAuraProj.grid(render, engine.broadphase, context);\n\n\t\tif (options.showDebug)\n\t\t\tRenderAuraProj.debug(render, context);\n\n\t\tif (options.hasBounds) {\n\t\t\t// revert view transforms\n\t\t\tRenderAuraProj.endViewTransform(render);\n\t\t}\n\n\t\tEvents.trigger(render, 'afterRender', event);\n\n\t\t// Render crosshair\n\t\tif (render.options.showCrosshair)\n\t\t\tRenderAuraProj.drawCrosshair(render, context);\n\t};\n\n\t/**\n\t * Description\n\t * @private\n\t * @method debug\n\t * @param {render} render\n\t * @param {RenderingContext} context\n\t */\n\tstatic debug(render, context) {\n\t\tvar c = context,\n\t\t\tengine = render.engine,\n\t\t\tworld = engine.world,\n\t\t\tmetrics = engine.metrics,\n\t\t\toptions = render.options,\n\t\t\tbodies = Composite.allBodies(world),\n\t\t\tspace = \"    \";\n\n\t\tif (engine.timing.timestamp - (render.debugTimestamp || 0) >= 500) {\n\t\t\tvar text = \"\";\n\n\t\t\tif (metrics.timing) {\n\t\t\t\ttext += \"fps: \" + Math.round(metrics.timing.fps) + space;\n\t\t\t}\n\n\t\t\t// @if DEBUG\n\t\t\tif (metrics.extended) {\n\t\t\t\tif (metrics.timing) {\n\t\t\t\t\ttext += \"delta: \" + metrics.timing.delta.toFixed(3) + space;\n\t\t\t\t\ttext += \"correction: \" + metrics.timing.correction.toFixed(3) + space;\n\t\t\t\t}\n\n\t\t\t\ttext += \"bodies: \" + bodies.length + space;\n\n\t\t\t\tif (engine.broadphase.controller === Grid)\n\t\t\t\t\ttext += \"buckets: \" + metrics.buckets + space;\n\n\t\t\t\ttext += \"\\n\";\n\n\t\t\t\ttext += \"collisions: \" + metrics.collisions + space;\n\t\t\t\ttext += \"pairs: \" + engine.pairs.list.length + space;\n\t\t\t\ttext += \"broad: \" + metrics.broadEff + space;\n\t\t\t\ttext += \"mid: \" + metrics.midEff + space;\n\t\t\t\ttext += \"narrow: \" + metrics.narrowEff + space;\n\t\t\t}\n\t\t\t// @endif\n\n\t\t\trender.debugString = text;\n\t\t\trender.debugTimestamp = engine.timing.timestamp;\n\t\t}\n\n\t\tif (render.debugString) {\n\t\t\tc.font = \"12px Arial\";\n\n\t\t\tif (options.wireframes) {\n\t\t\t\tc.fillStyle = 'rgba(255,255,255,0.5)';\n\t\t\t} else {\n\t\t\t\tc.fillStyle = 'rgba(0,0,0,0.5)';\n\t\t\t}\n\n\t\t\tvar split = render.debugString.split('\\n');\n\n\t\t\tfor (var i = 0; i < split.length; i++) {\n\t\t\t\tc.fillText(split[i], 50, 50 + i * 18);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Description\n\t * @private\n\t * @method constraints\n\t * @param {constraint[]} constraints\n\t * @param {RenderingContext} context\n\t */\n\tstatic constraints(constraints, context) {\n\t\tvar c = context;\n\n\t\tfor (var i = 0; i < constraints.length; i++) {\n\t\t\tvar constraint = constraints[i];\n\n\t\t\tif (!constraint.render.visible || !constraint.pointA || !constraint.pointB)\n\t\t\t\tcontinue;\n\n\t\t\tvar bodyA = constraint.bodyA,\n\t\t\t\tbodyB = constraint.bodyB,\n\t\t\t\tstart,\n\t\t\t\tend;\n\n\t\t\tif (bodyA) {\n\t\t\t\tstart = Vector.add(bodyA.position, constraint.pointA);\n\t\t\t} else {\n\t\t\t\tstart = constraint.pointA;\n\t\t\t}\n\n\t\t\tif (constraint.render.type === 'pin') {\n\t\t\t\tc.beginPath();\n\t\t\t\tc.arc(start.x, start.y, 3, 0, 2 * Math.PI);\n\t\t\t\tc.closePath();\n\t\t\t} else {\n\t\t\t\tif (bodyB) {\n\t\t\t\t\tend = Vector.add(bodyB.position, constraint.pointB);\n\t\t\t\t} else {\n\t\t\t\t\tend = constraint.pointB;\n\t\t\t\t}\n\n\t\t\t\tc.beginPath();\n\t\t\t\tc.moveTo(start.x, start.y);\n\n\t\t\t\tif (constraint.render.type === 'spring') {\n\t\t\t\t\tvar delta = Vector.sub(end, start),\n\t\t\t\t\t\tnormal = Vector.perp(Vector.normalise(delta)),\n\t\t\t\t\t\tcoils = Math.ceil(Common.clamp(constraint.length / 5, 12, 20)),\n\t\t\t\t\t\toffset;\n\n\t\t\t\t\tfor (var j = 1; j < coils; j += 1) {\n\t\t\t\t\t\toffset = j % 2 === 0 ? 1 : -1;\n\n\t\t\t\t\t\tc.lineTo(\n\t\t\t\t\t\t\tstart.x + delta.x * (j / coils) + normal.x * offset * 4,\n\t\t\t\t\t\t\tstart.y + delta.y * (j / coils) + normal.y * offset * 4\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tc.lineTo(end.x, end.y);\n\t\t\t}\n\n\t\t\tif (constraint.render.lineWidth) {\n\t\t\t\tc.lineWidth = constraint.render.lineWidth;\n\t\t\t\tc.strokeStyle = constraint.render.strokeStyle;\n\t\t\t\tc.stroke();\n\t\t\t}\n\n\t\t\tif (constraint.render.anchors) {\n\t\t\t\tc.fillStyle = constraint.render.strokeStyle;\n\t\t\t\tc.beginPath();\n\t\t\t\tc.arc(start.x, start.y, 3, 0, 2 * Math.PI);\n\t\t\t\tc.arc(end.x, end.y, 3, 0, 2 * Math.PI);\n\t\t\t\tc.closePath();\n\t\t\t\tc.fill();\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Description\n\t * @private\n\t * @method bodyShadows\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic bodyShadows(render, bodies, context) {\n\t\tvar c = context;\n\n\t\tfor (var i = 0; i < bodies.length; i++) {\n\t\t\tvar body = bodies[i];\n\n\t\t\tif (!body.render.visible)\n\t\t\t\tcontinue;\n\n\t\t\tif (body.circleRadius) {\n\t\t\t\tc.beginPath();\n\t\t\t\tc.arc(body.position.x, body.position.y, body.circleRadius, 0, 2 * Math.PI);\n\t\t\t\tc.closePath();\n\t\t\t} else {\n\t\t\t\tc.beginPath();\n\t\t\t\tc.moveTo(body.vertices[0].x, body.vertices[0].y);\n\t\t\t\tfor (var j = 1; j < body.vertices.length; j++) {\n\t\t\t\t\tc.lineTo(body.vertices[j].x, body.vertices[j].y);\n\t\t\t\t}\n\t\t\t\tc.closePath();\n\t\t\t}\n\n\t\t\tvar distanceX = body.position.x - render.options.width * 0.5,\n\t\t\t\tdistanceY = body.position.y - render.options.height * 0.2,\n\t\t\t\tdistance = Math.abs(distanceX) + Math.abs(distanceY);\n\n\t\t\tc.shadowColor = 'rgba(0,0,0,0.15)';\n\t\t\tc.shadowOffsetX = 0.05 * distanceX;\n\t\t\tc.shadowOffsetY = 0.05 * distanceY;\n\t\t\tc.shadowBlur = 1 + 12 * Math.min(1, distance / 1000);\n\n\t\t\tc.fill();\n\n\t\t\tc.shadowColor = null;\n\t\t\tc.shadowOffsetX = null;\n\t\t\tc.shadowOffsetY = null;\n\t\t\tc.shadowBlur = null;\n\t\t}\n\t};\n\n\t/**\n\t * Description\n\t * @private\n\t * @method bodies\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic bodies(render, bodies, context) {\n\t\tvar c = context,\n\t\t\toptions = render.options,\n\t\t\tshowInternalEdges = options.showInternalEdges || !options.wireframes,\n\t\t\tbody,\n\t\t\tpart,\n\t\t\ti,\n\t\t\tk;\n\n\t\tfor (i = 0; i < bodies.length; i++) {\n\t\t\tbody = bodies[i];\n\n\t\t\tif (!body.render.visible)\n\t\t\t\tcontinue;\n\n\t\t\t// handle compound parts\n\t\t\tfor (k = body.parts.length > 1 ? 1 : 0; k < body.parts.length; k++) {\n\t\t\t\tpart = body.parts[k];\n\n\t\t\t\tif (!part.render.visible)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// if (options.showSleeping && body.isSleeping) {\n\t\t\t\t//     c.globalAlpha = 0.5 * part.render.opacity;\n\t\t\t\t// } else if (part.render.opacity !== 1) {\n\t\t\t\t//     c.globalAlpha = part.render.opacity;\n\t\t\t\t// }\n\n\t\t\t\tif (part.render.sprite && part.render.sprite.texture && !options.wireframes) {\n\t\t\t\t\t// part sprite\n\t\t\t\t\tvar sprite = part.render.sprite,\n\t\t\t\t\t\ttexture = RenderAuraProj._getTexture(render, sprite.texture);\n\n\t\t\t\t\tc.translate(part.position.x, part.position.y);\n\t\t\t\t\tc.rotate(part.angle);\n\n\t\t\t\t\tc.drawImage(\n\t\t\t\t\t\ttexture,\n\t\t\t\t\t\ttexture.width * -sprite.xOffset * sprite.xScale,\n\t\t\t\t\t\ttexture.height * -sprite.yOffset * sprite.yScale,\n\t\t\t\t\t\ttexture.width * sprite.xScale,\n\t\t\t\t\t\ttexture.height * sprite.yScale\n\t\t\t\t\t);\n\n\t\t\t\t\t// revert translation, hopefully faster than save / restore\n\t\t\t\t\tc.rotate(-part.angle);\n\t\t\t\t\tc.translate(-part.position.x, -part.position.y);\n\t\t\t\t} else {\n\t\t\t\t\t// part polygon\n\t\t\t\t\tif (part.circleRadius) {\n\t\t\t\t\t\tc.beginPath();\n\t\t\t\t\t\tc.arc(part.position.x, part.position.y, part.circleRadius, 0, 2 * Math.PI);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc.beginPath();\n\t\t\t\t\t\tc.moveTo(part.vertices[0].x, part.vertices[0].y);\n\n\t\t\t\t\t\tfor (var j = 1; j < part.vertices.length; j++) {\n\t\t\t\t\t\t\tif (!part.vertices[j - 1].isInternal || showInternalEdges) {\n\t\t\t\t\t\t\t\tc.lineTo(part.vertices[j].x, part.vertices[j].y);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tc.moveTo(part.vertices[j].x, part.vertices[j].y);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (part.vertices[j].isInternal && !showInternalEdges) {\n\t\t\t\t\t\t\t\tc.moveTo(part.vertices[(j + 1) % part.vertices.length].x, part.vertices[(j + 1) % part.vertices.length].y);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tc.lineTo(part.vertices[0].x, part.vertices[0].y);\n\t\t\t\t\t\tc.closePath();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!options.wireframes) {\n\t\t\t\t\t\tif (options.showSleeping && body.isSleeping) {\n\t\t\t\t\t\t\tc.fillStyle = RenderAuraProj._colorLuminance(part.render.fillStyle, -0.2)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tc.fillStyle = part.render.fillStyle;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (part.render.lineWidth) {\n\t\t\t\t\t\t\tc.lineWidth = part.render.lineWidth;\n\t\t\t\t\t\t\tc.strokeStyle = part.render.strokeStyle;\n\t\t\t\t\t\t\tc.stroke();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tc.fill();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc.lineWidth = 1;\n\t\t\t\t\t\tc.strokeStyle = '#bbb';\n\t\t\t\t\t\tc.stroke();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tc.globalAlpha = 1;\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Optimised method for drawing body wireframes in one pass\n\t * @private\n\t * @method bodyWireframes\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic bodyWireframes(render, bodies, context) {\n\t\tvar c = context,\n\t\t\tshowInternalEdges = render.options.showInternalEdges,\n\t\t\tbody,\n\t\t\tpart,\n\t\t\ti,\n\t\t\tj,\n\t\t\tk;\n\n\t\tc.beginPath();\n\n\t\t// render all bodies\n\t\tfor (i = 0; i < bodies.length; i++) {\n\t\t\tbody = bodies[i];\n\n\t\t\tif (!body.render.visible)\n\t\t\t\tcontinue;\n\n\t\t\t// handle compound parts\n\t\t\tfor (k = body.parts.length > 1 ? 1 : 0; k < body.parts.length; k++) {\n\t\t\t\tpart = body.parts[k];\n\n\t\t\t\tc.moveTo(part.vertices[0].x, part.vertices[0].y);\n\n\t\t\t\tfor (j = 1; j < part.vertices.length; j++) {\n\t\t\t\t\tif (!part.vertices[j - 1].isInternal || showInternalEdges) {\n\t\t\t\t\t\tc.lineTo(part.vertices[j].x, part.vertices[j].y);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc.moveTo(part.vertices[j].x, part.vertices[j].y);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (part.vertices[j].isInternal && !showInternalEdges) {\n\t\t\t\t\t\tc.moveTo(part.vertices[(j + 1) % part.vertices.length].x, part.vertices[(j + 1) % part.vertices.length].y);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tc.lineTo(part.vertices[0].x, part.vertices[0].y);\n\t\t\t}\n\t\t}\n\n\t\tc.lineWidth = 1;\n\t\tc.strokeStyle = '#bbb';\n\t\tc.stroke();\n\t};\n\n\t/**\n\t * Optimised method for drawing body convex hull wireframes in one pass\n\t * @private\n\t * @method bodyConvexHulls\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic bodyConvexHulls(render, bodies, context) {\n\t\tvar c = context,\n\t\t\tbody,\n\t\t\ti,\n\t\t\tj;\n\n\t\tc.beginPath();\n\n\t\t// render convex hulls\n\t\tfor (i = 0; i < bodies.length; i++) {\n\t\t\tbody = bodies[i];\n\n\t\t\tif (!body.render.visible || body.parts.length === 1)\n\t\t\t\tcontinue;\n\n\t\t\tc.moveTo(body.vertices[0].x, body.vertices[0].y);\n\n\t\t\tfor (j = 1; j < body.vertices.length; j++) {\n\t\t\t\tc.lineTo(body.vertices[j].x, body.vertices[j].y);\n\t\t\t}\n\n\t\t\tc.lineTo(body.vertices[0].x, body.vertices[0].y);\n\t\t}\n\n\t\tc.lineWidth = 1;\n\t\tc.strokeStyle = 'rgba(255,255,255,0.2)';\n\t\tc.stroke();\n\t};\n\n\t/**\n\t * Renders body vertex numbers.\n\t * @private\n\t * @method vertexNumbers\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic vertexNumbers(render, bodies, context) {\n\t\tvar c = context,\n\t\t\ti,\n\t\t\tj,\n\t\t\tk;\n\n\t\tfor (i = 0; i < bodies.length; i++) {\n\t\t\tvar parts = bodies[i].parts;\n\t\t\tfor (k = parts.length > 1 ? 1 : 0; k < parts.length; k++) {\n\t\t\t\tvar part = parts[k];\n\t\t\t\tfor (j = 0; j < part.vertices.length; j++) {\n\t\t\t\t\tc.fillStyle = 'rgba(255,255,255,0.2)';\n\t\t\t\t\tc.fillText(i + '_' + j, part.position.x + (part.vertices[j].x - part.position.x) * 0.8, part.position.y + (part.vertices[j].y - part.position.y) * 0.8);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Renders mouse position.\n\t * @private\n\t * @method mousePosition\n\t * @param {render} render\n\t * @param {mouse} mouse\n\t * @param {RenderingContext} context\n\t */\n\tstatic mousePosition(render, mouse, context) {\n\t\tvar c = context;\n\t\tc.fillStyle = 'rgba(255,255,255,0.8)';\n\t\tc.fillText(mouse.position.x + '  ' + mouse.position.y, mouse.position.x + 5, mouse.position.y - 5);\n\t};\n\n\t/**\n\t * Draws body bounds\n\t * @private\n\t * @method bodyBounds\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic bodyBounds(render, bodies, context) {\n\t\tvar c = context,\n\t\t\toptions = render.options;\n\n\t\tc.beginPath();\n\n\t\tfor (var i = 0; i < bodies.length; i++) {\n\t\t\tvar body = bodies[i];\n\n\t\t\tif (body.render.visible) {\n\t\t\t\tvar parts = bodies[i].parts;\n\t\t\t\tfor (var j = parts.length > 1 ? 1 : 0; j < parts.length; j++) {\n\t\t\t\t\tvar part = parts[j];\n\t\t\t\t\tc.rect(part.bounds.min.x, part.bounds.min.y, part.bounds.max.x - part.bounds.min.x, part.bounds.max.y - part.bounds.min.y);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (options.wireframes) {\n\t\t\tc.strokeStyle = 'rgba(255,255,255,0.08)';\n\t\t} else {\n\t\t\tc.strokeStyle = 'rgba(0,0,0,0.1)';\n\t\t}\n\n\t\tc.lineWidth = 1;\n\t\tc.stroke();\n\t};\n\n\t/**\n\t * Draws body angle indicators and axes\n\t * @private\n\t * @method bodyAxes\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic bodyAxes(render, bodies, context) {\n\t\tvar c = context,\n\t\t\toptions = render.options,\n\t\t\tpart,\n\t\t\ti,\n\t\t\tj,\n\t\t\tk;\n\n\t\tc.beginPath();\n\n\t\tfor (i = 0; i < bodies.length; i++) {\n\t\t\tvar body = bodies[i],\n\t\t\t\tparts = body.parts;\n\n\t\t\tif (!body.render.visible)\n\t\t\t\tcontinue;\n\n\t\t\tif (options.showAxes) {\n\t\t\t\t// render all axes\n\t\t\t\tfor (j = parts.length > 1 ? 1 : 0; j < parts.length; j++) {\n\t\t\t\t\tpart = parts[j];\n\t\t\t\t\tfor (k = 0; k < part.axes.length; k++) {\n\t\t\t\t\t\tvar axis = part.axes[k];\n\t\t\t\t\t\tc.moveTo(part.position.x, part.position.y);\n\t\t\t\t\t\tc.lineTo(part.position.x + axis.x * 20, part.position.y + axis.y * 20);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (j = parts.length > 1 ? 1 : 0; j < parts.length; j++) {\n\t\t\t\t\tpart = parts[j];\n\t\t\t\t\tfor (k = 0; k < part.axes.length; k++) {\n\t\t\t\t\t\t// render a single axis indicator\n\t\t\t\t\t\tc.moveTo(part.position.x, part.position.y);\n\t\t\t\t\t\tc.lineTo((part.vertices[0].x + part.vertices[part.vertices.length-1].x) / 2,\n\t\t\t\t\t\t\t\t (part.vertices[0].y + part.vertices[part.vertices.length-1].y) / 2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (options.wireframes) {\n\t\t\tc.strokeStyle = 'indianred';\n\t\t\tc.lineWidth = 1;\n\t\t} else {\n\t\t\tc.strokeStyle = 'rgba(255, 255, 255, 0.4)';\n\t\t\tc.globalCompositeOperation = 'overlay';\n\t\t\tc.lineWidth = 2;\n\t\t}\n\n\t\tc.stroke();\n\t\tc.globalCompositeOperation = 'source-over';\n\t};\n\n\t/**\n\t * Draws body positions\n\t * @private\n\t * @method bodyPositions\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic bodyPositions(render, bodies, context) {\n\t\tvar c = context,\n\t\t\toptions = render.options,\n\t\t\tbody,\n\t\t\tpart,\n\t\t\ti,\n\t\t\tk;\n\n\t\tc.beginPath();\n\n\t\t// render current positions\n\t\tfor (i = 0; i < bodies.length; i++) {\n\t\t\tbody = bodies[i];\n\n\t\t\tif (!body.render.visible)\n\t\t\t\tcontinue;\n\n\t\t\t// handle compound parts\n\t\t\tfor (k = 0; k < body.parts.length; k++) {\n\t\t\t\tpart = body.parts[k];\n\t\t\t\tc.arc(part.position.x, part.position.y, 3, 0, 2 * Math.PI, false);\n\t\t\t\tc.closePath();\n\t\t\t}\n\t\t}\n\n\t\tif (options.wireframes) {\n\t\t\tc.fillStyle = 'indianred';\n\t\t} else {\n\t\t\tc.fillStyle = 'rgba(0,0,0,0.5)';\n\t\t}\n\t\tc.fill();\n\n\t\tc.beginPath();\n\n\t\t// render previous positions\n\t\tfor (i = 0; i < bodies.length; i++) {\n\t\t\tbody = bodies[i];\n\t\t\tif (body.render.visible) {\n\t\t\t\tc.arc(body.positionPrev.x, body.positionPrev.y, 2, 0, 2 * Math.PI, false);\n\t\t\t\tc.closePath();\n\t\t\t}\n\t\t}\n\n\t\tc.fillStyle = 'rgba(255,165,0,0.8)';\n\t\tc.fill();\n\t};\n\n\t/**\n\t * Draws body velocity\n\t * @private\n\t * @method bodyVelocity\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic bodyVelocity(render, bodies, context) {\n\t\tvar c = context;\n\n\t\tc.beginPath();\n\n\t\tfor (var i = 0; i < bodies.length; i++) {\n\t\t\tvar body = bodies[i];\n\n\t\t\tif (!body.render.visible)\n\t\t\t\tcontinue;\n\n\t\t\tc.moveTo(body.position.x, body.position.y);\n\t\t\tc.lineTo(body.position.x + (body.position.x - body.positionPrev.x) * 2, body.position.y + (body.position.y - body.positionPrev.y) * 2);\n\t\t}\n\n\t\tc.lineWidth = 3;\n\t\tc.strokeStyle = 'cornflowerblue';\n\t\tc.stroke();\n\t};\n\n\t/**\n\t * Draws body ids\n\t * @private\n\t * @method bodyIds\n\t * @param {render} render\n\t * @param {body[]} bodies\n\t * @param {RenderingContext} context\n\t */\n\tstatic bodyIds(render, bodies, context) {\n\t\tvar c = context,\n\t\t\ti,\n\t\t\tj;\n\n\t\tfor (i = 0; i < bodies.length; i++) {\n\t\t\tif (!bodies[i].render.visible)\n\t\t\t\tcontinue;\n\n\t\t\tvar parts = bodies[i].parts;\n\t\t\tfor (j = parts.length > 1 ? 1 : 0; j < parts.length; j++) {\n\t\t\t\tvar part = parts[j];\n\t\t\t\tc.font = \"12px Arial\";\n\t\t\t\tc.fillStyle = 'rgba(255,255,255,0.5)';\n\t\t\t\tc.fillText(part.id, part.position.x + 10, part.position.y - 10);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Description\n\t * @private\n\t * @method collisions\n\t * @param {render} render\n\t * @param {pair[]} pairs\n\t * @param {RenderingContext} context\n\t */\n\tstatic collisions(render, pairs, context) {\n\t\tvar c = context,\n\t\t\toptions = render.options,\n\t\t\tpair,\n\t\t\tcollision,\n\t\t\ti,\n\t\t\tj;\n\n\t\tc.beginPath();\n\n\t\t// render collision positions\n\t\tfor (i = 0; i < pairs.length; i++) {\n\t\t\tpair = pairs[i];\n\n\t\t\tif (!pair.isActive)\n\t\t\t\tcontinue;\n\n\t\t\tcollision = pair.collision;\n\t\t\tfor (j = 0; j < pair.activeContacts.length; j++) {\n\t\t\t\tvar contact = pair.activeContacts[j],\n\t\t\t\t\tvertex = contact.vertex;\n\t\t\t\tc.rect(vertex.x - 1.5, vertex.y - 1.5, 3.5, 3.5);\n\t\t\t}\n\t\t}\n\n\t\tif (options.wireframes) {\n\t\t\tc.fillStyle = 'rgba(255,255,255,0.7)';\n\t\t} else {\n\t\t\tc.fillStyle = 'orange';\n\t\t}\n\t\tc.fill();\n\n\t\tc.beginPath();\n\n\t\t// render collision normals\n\t\tfor (i = 0; i < pairs.length; i++) {\n\t\t\tpair = pairs[i];\n\n\t\t\tif (!pair.isActive)\n\t\t\t\tcontinue;\n\n\t\t\tcollision = pair.collision;\n\n\t\t\tif (pair.activeContacts.length > 0) {\n\t\t\t\tvar normalPosX = pair.activeContacts[0].vertex.x,\n\t\t\t\t\tnormalPosY = pair.activeContacts[0].vertex.y;\n\n\t\t\t\tif (pair.activeContacts.length === 2) {\n\t\t\t\t\tnormalPosX = (pair.activeContacts[0].vertex.x + pair.activeContacts[1].vertex.x) / 2;\n\t\t\t\t\tnormalPosY = (pair.activeContacts[0].vertex.y + pair.activeContacts[1].vertex.y) / 2;\n\t\t\t\t}\n\n\t\t\t\tif (collision.bodyB === collision.supports[0].body || collision.bodyA.isStatic === true) {\n\t\t\t\t\tc.moveTo(normalPosX - collision.normal.x * 8, normalPosY - collision.normal.y * 8);\n\t\t\t\t} else {\n\t\t\t\t\tc.moveTo(normalPosX + collision.normal.x * 8, normalPosY + collision.normal.y * 8);\n\t\t\t\t}\n\n\t\t\t\tc.lineTo(normalPosX, normalPosY);\n\t\t\t}\n\t\t}\n\n\t\tif (options.wireframes) {\n\t\t\tc.strokeStyle = 'rgba(255,165,0,0.7)';\n\t\t} else {\n\t\t\tc.strokeStyle = 'orange';\n\t\t}\n\n\t\tc.lineWidth = 1;\n\t\tc.stroke();\n\t};\n\n\t/**\n\t * Description\n\t * @private\n\t * @method separations\n\t * @param {render} render\n\t * @param {pair[]} pairs\n\t * @param {RenderingContext} context\n\t */\n\tstatic separations(render, pairs, context) {\n\t\tvar c = context,\n\t\t\toptions = render.options,\n\t\t\tpair,\n\t\t\tcollision,\n\t\t\tbodyA,\n\t\t\tbodyB,\n\t\t\ti;\n\n\t\tc.beginPath();\n\n\t\t// render separations\n\t\tfor (i = 0; i < pairs.length; i++) {\n\t\t\tpair = pairs[i];\n\n\t\t\tif (!pair.isActive)\n\t\t\t\tcontinue;\n\n\t\t\tcollision = pair.collision;\n\t\t\tbodyA = collision.bodyA;\n\t\t\tbodyB = collision.bodyB;\n\n\t\t\tvar k = 1;\n\n\t\t\tif (!bodyB.isStatic && !bodyA.isStatic) k = 0.5;\n\t\t\tif (bodyB.isStatic) k = 0;\n\n\t\t\tc.moveTo(bodyB.position.x, bodyB.position.y);\n\t\t\tc.lineTo(bodyB.position.x - collision.penetration.x * k, bodyB.position.y - collision.penetration.y * k);\n\n\t\t\tk = 1;\n\n\t\t\tif (!bodyB.isStatic && !bodyA.isStatic) k = 0.5;\n\t\t\tif (bodyA.isStatic) k = 0;\n\n\t\t\tc.moveTo(bodyA.position.x, bodyA.position.y);\n\t\t\tc.lineTo(bodyA.position.x + collision.penetration.x * k, bodyA.position.y + collision.penetration.y * k);\n\t\t}\n\n\t\tif (options.wireframes) {\n\t\t\tc.strokeStyle = 'rgba(255,165,0,0.5)';\n\t\t} else {\n\t\t\tc.strokeStyle = 'orange';\n\t\t}\n\t\tc.stroke();\n\t};\n\n\t/**\n\t * Description\n\t * @private\n\t * @method grid\n\t * @param {render} render\n\t * @param {grid} grid\n\t * @param {RenderingContext} context\n\t */\n\tstatic grid(render, grid, context) {\n\t\tvar c = context,\n\t\t\toptions = render.options;\n\n\t\tif (options.wireframes) {\n\t\t\tc.strokeStyle = 'rgba(255,180,0,0.1)';\n\t\t} else {\n\t\t\tc.strokeStyle = 'rgba(255,180,0,0.5)';\n\t\t}\n\n\t\tc.beginPath();\n\n\t\tvar bucketKeys = Common.keys(grid.buckets);\n\n\t\tfor (var i = 0; i < bucketKeys.length; i++) {\n\t\t\tvar bucketId = bucketKeys[i];\n\n\t\t\tif (grid.buckets[bucketId].length < 2)\n\t\t\t\tcontinue;\n\n\t\t\tvar region = bucketId.split(/C|R/);\n\t\t\tc.rect(0.5 + parseInt(region[1], 10) * grid.bucketWidth,\n\t\t\t\t\t0.5 + parseInt(region[2], 10) * grid.bucketHeight,\n\t\t\t\t\tgrid.bucketWidth,\n\t\t\t\t\tgrid.bucketHeight);\n\t\t}\n\n\t\tc.lineWidth = 1;\n\t\tc.stroke();\n\t};\n\n\t/**\n\t * Description\n\t * @private\n\t * @method inspector\n\t * @param {inspector} inspector\n\t * @param {RenderingContext} context\n\t */\n\tstatic inspector(inspector, context) {\n\t\tvar selected = inspector.selected,\n\t\t\trender = inspector.render,\n\t\t\toptions = render.options,\n\t\t\tbounds;\n\n\t\tif (options.hasBounds) {\n\t\t\tvar boundsWidth = render.bounds.max.x - render.bounds.min.x,\n\t\t\t\tboundsHeight = render.bounds.max.y - render.bounds.min.y,\n\t\t\t\tboundsScaleX = boundsWidth / render.options.width,\n\t\t\t\tboundsScaleY = boundsHeight / render.options.height;\n\n\t\t\tcontext.scale(1 / boundsScaleX, 1 / boundsScaleY);\n\t\t\tcontext.translate(-render.bounds.min.x, -render.bounds.min.y);\n\t\t}\n\n\t\tfor (var i = 0; i < selected.length; i++) {\n\t\t\tvar item = selected[i].data;\n\n\t\t\tcontext.translate(0.5, 0.5);\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.strokeStyle = 'rgba(255,165,0,0.9)';\n\t\t\tcontext.setLineDash([1,2]);\n\n\t\t\tswitch (item.type) {\n\n\t\t\tcase 'body':\n\n\t\t\t\t// render body selections\n\t\t\t\tbounds = item.bounds;\n\t\t\t\tcontext.beginPath();\n\t\t\t\tcontext.rect(Math.floor(bounds.min.x - 3), Math.floor(bounds.min.y - 3),\n\t\t\t\t\t\t\t Math.floor(bounds.max.x - bounds.min.x + 6), Math.floor(bounds.max.y - bounds.min.y + 6));\n\t\t\t\tcontext.closePath();\n\t\t\t\tcontext.stroke();\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'constraint':\n\n\t\t\t\t// render constraint selections\n\t\t\t\tvar point = item.pointA;\n\t\t\t\tif (item.bodyA)\n\t\t\t\t\tpoint = item.pointB;\n\t\t\t\tcontext.beginPath();\n\t\t\t\tcontext.arc(point.x, point.y, 10, 0, 2 * Math.PI);\n\t\t\t\tcontext.closePath();\n\t\t\t\tcontext.stroke();\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcontext.setLineDash([]);\n\t\t\tcontext.translate(-0.5, -0.5);\n\t\t}\n\n\t\t// render selection region\n\t\tif (inspector.selectStart !== null) {\n\t\t\tcontext.translate(0.5, 0.5);\n\t\t\tcontext.lineWidth = 1;\n\t\t\tcontext.strokeStyle = 'rgba(255,165,0,0.6)';\n\t\t\tcontext.fillStyle = 'rgba(255,165,0,0.1)';\n\t\t\tbounds = inspector.selectBounds;\n\t\t\tcontext.beginPath();\n\t\t\tcontext.rect(Math.floor(bounds.min.x), Math.floor(bounds.min.y),\n\t\t\t\t\t\t Math.floor(bounds.max.x - bounds.min.x), Math.floor(bounds.max.y - bounds.min.y));\n\t\t\tcontext.closePath();\n\t\t\tcontext.stroke();\n\t\t\tcontext.fill();\n\t\t\tcontext.translate(-0.5, -0.5);\n\t\t}\n\n\t\tif (options.hasBounds)\n\t\t\tcontext.setTransform(1, 0, 0, 1, 0, 0);\n\t};\n\n\t/**\n\t * Description\n\t * @method _createCanvas\n\t * @private\n\t * @param {} width\n\t * @param {} height\n\t * @return canvas\n\t */\n\tstatic _createCanvas(width, height) {\n\t\tvar canvas = document.createElement('canvas');\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\tcanvas.oncontextmenu = function() { return false; };\n\t\tcanvas.onselectstart = function() { return false; };\n\t\treturn canvas;\n\t};\n\n\t/**\n\t * Gets the pixel ratio of the canvas.\n\t * @method _getPixelRatio\n\t * @private\n\t * @param {HTMLElement} canvas\n\t * @return {Number} pixel ratio\n\t */\n\tstatic _getPixelRatio(canvas) {\n\t\tvar context = canvas.getContext('2d'),\n\t\t\tdevicePixelRatio = window.devicePixelRatio || 1,\n\t\t\tbackingStorePixelRatio = context.webkitBackingStorePixelRatio || context.mozBackingStorePixelRatio\n\t\t\t\t\t\t\t\t\t  || context.msBackingStorePixelRatio || context.oBackingStorePixelRatio\n\t\t\t\t\t\t\t\t\t  || context.backingStorePixelRatio || 1;\n\n\t\treturn devicePixelRatio / backingStorePixelRatio;\n\t};\n\n\t/**\n\t * Gets the requested texture (an Image) via its path\n\t * @method _getTexture\n\t * @private\n\t * @param {render} render\n\t * @param {string} imagePath\n\t * @return {Image} texture\n\t */\n\tstatic _getTexture(render, imagePath) {\n\t\tvar image = render.textures[imagePath];\n\n\t\tif (image)\n\t\t\treturn image;\n\n\t\timage = render.textures[imagePath] = new Image();\n\t\timage.src = imagePath;\n\n\t\treturn image;\n\t};\n\n\t/**\n\t * Applies the background to the canvas using CSS.\n\t * @method applyBackground\n\t * @private\n\t * @param {render} render\n\t * @param {string} background\n\t */\n\tstatic _applyBackground(render, background) {\n\t\tvar cssBackground = background;\n\n\t\tif (/(jpg|gif|png)$/.test(background))\n\t\t\tcssBackground = 'url(' + background + ')';\n\n\t\trender.canvas.style.background = cssBackground;\n\t\trender.canvas.style.backgroundSize = \"contain\";\n\t\trender.currentBackground = background;\n\t};\n\n\t/**\n\t * Performs modulo operation, handling negative numbers.\n\t * @method mod\n\t * @private\n\t * @param {} x\n\t * @param {} n\n\t */\n\tstatic _mod(x, n) { return (x % n + n) % n };\n\n\t/**\n\t * Compares two floating-point numbers for near-equality using an epsilon value.\n\t * @method almostEqual\n\t * @private\n\t * @param {} a\n\t * @param {} b\n\t */\n\tstatic _almostEqual(a, b) { return Math.abs(a - b) < 0.00001 };\n\n\t/**\n\t * Aligns a draw coordinate.\n\t * @method roundDrawCoord\n\t * @private\n\t * @param {} x\n\t */\n\tstatic _roundDrawCoord(x) { return Math.round(x) + 0.5 };\n\n\t/**\n\t * Adjusts a hex string color value's luminosity.\n\t * Borrowed from https://www.sitepoint.com/javascript-generate-lighter-darker-color/\n\t*/\n\tstatic _colorLuminance(hex, lum) {\n\t\t// validate hex string\n\t\thex = String(hex).replace(/[^0-9a-f]/gi, '');\n\t\tif (hex.length < 6) {\n\t\t\thex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];\n\t\t}\n\t\tlum = lum || 0;\n\n\t\t// convert to decimal and change luminosity\n\t\tvar rgb = \"#\", c, i;\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\tc = parseInt(hex.substr(i*2,2), 16);\n\t\t\tc = Math.round(Math.min(Math.max(0, c + (c * lum)), 255)).toString(16);\n\t\t\trgb += (\"00\"+c).substr(c.length);\n\t\t}\n\n\t\treturn rgb;\n\t}\n\n\t/*\n\t*\n\t*  Events Documentation\n\t*\n\t*/\n\n\t/**\n\t* Fired before rendering\n\t*\n\t* @event beforeRender\n\t* @param {} event An event object\n\t* @param {number} event.timestamp The engine.timing.timestamp of the event\n\t* @param {} event.source The source object of the event\n\t* @param {} event.name The name of the event\n\t*/\n\n\t/**\n\t* Fired after rendering\n\t*\n\t* @event afterRender\n\t* @param {} event An event object\n\t* @param {number} event.timestamp The engine.timing.timestamp of the event\n\t* @param {} event.source The source object of the event\n\t* @param {} event.name The name of the event\n\t*/\n\n\t/*\n\t*\n\t*  Properties Documentation\n\t*\n\t*/\n\n\t/**\n\t * A back-reference to the `Matter.Render` module.\n\t *\n\t * @property controller\n\t * @type render\n\t */\n\n\t/**\n\t * A reference to the `Matter.Engine` instance to be used.\n\t *\n\t * @property engine\n\t * @type engine\n\t */\n\n\t/**\n\t * A reference to the element where the canvas is to be inserted (if `render.canvas` has not been specified)\n\t *\n\t * @property element\n\t * @type HTMLElement\n\t * @default null\n\t */\n\n\t/**\n\t * The canvas element to render to. If not specified, one will be created if `render.element` has been specified.\n\t *\n\t * @property canvas\n\t * @type HTMLCanvasElement\n\t * @default null\n\t */\n\n\t/**\n\t * The configuration options of the renderer.\n\t *\n\t * @property options\n\t * @type {}\n\t */\n\n\t/**\n\t * The target width in pixels of the `render.canvas` to be created.\n\t *\n\t * @property options.width\n\t * @type number\n\t * @default 800\n\t */\n\n\t/**\n\t * The target height in pixels of the `render.canvas` to be created.\n\t *\n\t * @property options.height\n\t * @type number\n\t * @default 600\n\t */\n\n\t/**\n\t * A flag that specifies if `render.bounds` should be used when rendering.\n\t *\n\t * @property options.hasBounds\n\t * @type boolean\n\t * @default false\n\t */\n\n\t/**\n\t * A `Bounds` object that specifies the drawing view region.\n\t * Rendering will be automatically transformed and scaled to fit within the canvas size (`render.options.width` and `render.options.height`).\n\t * This allows for creating views that can pan or zoom around the scene.\n\t * You must also set `render.options.hasBounds` to `true` to enable bounded rendering.\n\t *\n\t * @property bounds\n\t * @type bounds\n\t */\n\n\t/**\n\t * The 2d rendering context from the `render.canvas` element.\n\t *\n\t * @property context\n\t * @type CanvasRenderingContext2D\n\t */\n\n\t/**\n\t * The sprite texture cache.\n\t *\n\t * @property textures\n\t * @type {}\n\t */\n}","///<reference path=\"./types/types.d.ts\" />\n\nimport { cloneDeep } from 'lodash'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport evaluatex from 'evaluatex/dist/evaluatex'\nimport { saveAs } from 'file-saver'\nimport { get, set } from 'local-storage'\nimport Matter from 'matter-js'\nimport * as React from 'react'\nimport * as ReactColor from 'react-color'\nimport { DndProvider } from 'react-dnd'\nimport Backend from 'react-dnd-html5-backend'\n\nimport Button from 'react-bootstrap/Button'\nimport ButtonToolbar from 'react-bootstrap/ButtonToolbar'\nimport ButtonGroup from 'react-bootstrap/ButtonGroup'\nimport Col from 'react-bootstrap/Col'\nimport Container from 'react-bootstrap/Container'\nimport Modal from 'react-bootstrap/Modal'\nimport Row from 'react-bootstrap/Row'\n\nimport { boundsOverlap, pointInBounds, pointNearBounds } from './util'\nimport { constants } from './variables'\nimport ControlPanel from './controlpanel'\nimport FunctionPlot from './functionplot'\nimport ImportDropTarget from './importdroptarget'\nimport MainToolbar from './maintoolbar'\nimport Server, { MouseMode } from './server'\n\nconst colors = [\n\t'#e6194b',\n\t'#3cb44b',\n\t'#4363d8',\n\t'#f58231',\n\t'#911eb4',\n\t'#46f0f0',\n\t'#f032e6',\n\t'#bcf60c',\n\t'#fabebe',\n\t'#008080',\n\t'#e6beff',\n\t'#9a6324',\n\t'#fffac8',\n\t'#800000',\n\t'#aaffc3',\n\t'#808000',\n\t'#ffd8b1',\n\t'#000075',\n\t'#808080',\n\t'#ffe119',\n\t'#ffffff',\n\t'#000000'\n]\n\nconst A_VERY_BIG_NUMBER = 100000\n\ninterface UtilSimState {\n\t// UI\n\tshowColorPicker: boolean,\n\tshowImportModal: boolean,\n\tcolorIndex?: number,\n\tlastBoundaryMoveTime: number,\n\tmouseMode: MouseMode,\n\tgridSize: number,\n\tsnapToGrid: boolean,\n\n\t// Simulation\n\tboundaries: Array<Boundary>,\n\tutilFunctions: Array<SubUtilityFunction>,\n\tutilConstants: UtilityVariables,\n\tutilGlobalVars: UtilityVariables,\n\tutilServer: UtilityFunction\n}\n\nexport default class UtilSim extends React.Component<{}, UtilSimState> {\n\t//static whyDidYouRender = true\n\n\tserverRef: React.RefObject<Server>\n\tlastFrameTime: number\n\tframeTimeHistory: Array<number>\n\n\tconstructor(props: {}) {\n\t\tsuper(props)\n\n\t\tconst defaultConstantValues: UtilityVariables = {}\n\t\tObject.keys(constants).forEach((key) => defaultConstantValues[key] = constants[key].defaultValue as number)\n\n\t\tthis.serverRef = React.createRef()\n\t\tthis.lastFrameTime = 0\n\t\tthis.frameTimeHistory = new Array(10)\n\n\t\tconst localStorageState = get<UtilSimState>('utilSim')\n\t\tif (localStorageState) {\n\t\t\tconsole.log('Loading settings from local storage')\n\t\t\tthis.state = localStorageState\n\t\t\treturn\n\t\t}\n\n\t\tconsole.log('Using default settings')\n\t\tthis.state = {\n\t\t\tshowColorPicker: false,\n\t\t\tshowImportModal: false,\n\t\t\tcolorIndex: 0,\n\t\t\tlastBoundaryMoveTime: window.performance.now(),\n\n\t\t\tmouseMode: MouseMode.OBJECT,\n\t\t\tgridSize: 50,\n\t\t\tsnapToGrid: false,\n\n\t\t\tboundaries: [\n\t\t\t\t{\n\t\t\t\t\tbounds: { min: {x: 0, y: -A_VERY_BIG_NUMBER}, max: {x: A_VERY_BIG_NUMBER, y: 0} },\n\t\t\t\t\tcolor: colors[0],\n\t\t\t\t\tvars: {}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbounds: { min: {x: 0, y: 0}, max: {x: A_VERY_BIG_NUMBER, y: A_VERY_BIG_NUMBER} },\n\t\t\t\t\tcolor: colors[1],\n\t\t\t\t\tvars: {}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbounds: { min: {x: -A_VERY_BIG_NUMBER, y: -0}, max: {x: 0, y: A_VERY_BIG_NUMBER} },\n\t\t\t\t\tcolor: colors[2],\n\t\t\t\t\tvars: {}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbounds: { min: {x: -A_VERY_BIG_NUMBER, y: -A_VERY_BIG_NUMBER}, max: {x: 0, y: 0} },\n\t\t\t\t\tcolor: colors[3],\n\t\t\t\t\tvars: {}\n\t\t\t\t}\n\t\t\t],\n\n\t\t\tutilFunctions: [\n\t\t\t\t{\n\t\t\t\t\texpression: \"e^(-10alpha)\",\n\t\t\t\t\tutilVar: \"alpha\",\n\t\t\t\t\tcolor: colors[5]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\texpression: \"e^(-5beta)\",\n\t\t\t\t\tutilVar: \"beta\",\n\t\t\t\t\tcolor: colors[6]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\texpression: \"min(max(0, -log(delta, 1000/60)), 1)\",\n\t\t\t\t\tutilVar: \"delta\",\n\t\t\t\t\tcolor: colors[7]\n\t\t\t\t}\n\t\t\t],\n\t\t\tutilConstants: defaultConstantValues,\n\t\t\tutilGlobalVars: {},\n\t\t\tutilServer: {\n\t\t\t\texpression: \"U_alpha + U_beta + U_delta\"\n\t\t\t}\n\t\t}\n\t}\n\n\tcomponentDidMount = () => {\n\t\t// Try to compile the functions\n\t\tthis.state.utilFunctions.forEach((func, i) => this.onUtilFunctionUpdated(i, func.expression))\n\t\tthis.onServerUtilFunctionUpdated(this.state.utilServer.expression)\n\t}\n\n\tonEngineBeforeUpdate = (event: Matter.IEventTimestamped<Matter.Engine>) => {\n\t\tthis.lastFrameTime = window.performance.now()\n\t}\n\n\tonEngineAfterUpdate = (event: Matter.IEventTimestamped<Matter.Engine>) => {\n\t\t// Update timing metrics\n\t\tconst now = window.performance.now()\n\t\tconst delta = (now - this.lastFrameTime)\n\t\tthis.frameTimeHistory.push(delta)\n\t\tthis.frameTimeHistory.shift()\n\t\tconst avgFrameTime = this.frameTimeHistory.reduce((a, b) => a + b) / this.frameTimeHistory.length\n\n\t\tconst boundaries = this.state.boundaries.slice()\n\t\tconst allBodies = Matter.Composite.allBodies(event.source.world)\n\t\tconst totalObjects = allBodies.length\n\n\t\t// Update boundary-local vars\n\t\tboundaries.forEach(b => {\n\t\t\tvar numObjects = 0\n\t\t\tvar numNearBoundary = 0\n\t\t\tvar numActive = 0\n\n\t\t\tvar i = 0\n\t\t\twhile (i < allBodies.length) {\n\t\t\t\tconst body = allBodies[i]\n\t\t\t\tif (!pointInBounds(body.position, b.bounds, true)) {\n\t\t\t\t\t++i\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\n\t\t\t\t// Update counters\n\t\t\t\t++numObjects\n\n\t\t\t\t// Is it active?\n\t\t\t\tif (!body.isSleeping)\n\t\t\t\t\t++numActive\n\n\t\t\t\t// Is the object near any of the boundary edges?\n\t\t\t\tif (pointNearBounds(body.position, body.circleRadius as number, b.bounds))\n\t\t\t\t\t++numNearBoundary\n\n\t\t\t\t// Make object same colour as boundary that contains it\n\t\t\t\tbody.render.fillStyle = b.color\n\n\t\t\t\t// Remove from 'all objects array'\n\t\t\t\tallBodies.splice(i, 1)\n\t\t\t}\n\n\t\t\t// Fake CPU usage (we can't get real CPU usage in JS)\n\t\t\tb.vars.lambda = (numObjects ? Math.min(1.0, numActive / totalObjects) : 0) + Math.random() * 0.1\n\t\t\tb.vars.delta = avgFrameTime\n\t\t\tb.vars.alpha = numObjects ? numActive / numObjects : 0\n\t\t\tb.vars.beta = numObjects ? numNearBoundary / numObjects : 0\n\t\t\tb.vars.n = numObjects\n\t\t})\n\n\t\t// Color remaining bodies (not in any boundary, which is something that should never happen) black\n\t\tallBodies.forEach(b => b.render.fillStyle = 'black')\n\n\t\t// Update global vars\n\t\tconst timeSinceBoundaryMoved = (now - this.state.lastBoundaryMoveTime) / 1000\n\t\tconst utilGlobalVars = {\n\t\t\tsigma: boundaries.length,\n\t\t\tt: timeSinceBoundaryMoved,\n\t\t\tN: totalObjects\n\t\t}\n\n\t\tthis.setState({ boundaries, utilGlobalVars })\n\t}\n\n\t// Validate the bounds\n\tvalidateResize = (resizeInfo: Array<BoundaryResizeInfo>) => {\n\t\t// Get the boundaries not being updated\n\t\tvar notBeingUpdated: Bounds[] = []\n\t\tthis.state.boundaries.forEach(b => {\n\t\t\tif (!resizeInfo.some(r => r.boundary === b))\n\t\t\t\tnotBeingUpdated.push(b.bounds)\n\t\t})\n\n\t\treturn resizeInfo.every(info => {\n\t\t\tconst bounds = info.newBounds\n\n\t\t// Reject min == max\n\t\tif (bounds.min.x === bounds.max.x || bounds.min.y === bounds.max.y)\n\t\t\treturn false\n\n\t\t\t// Combine check list with boundaries being updated\n\t\t\tconst checkList = [...notBeingUpdated]\n\t\t\tresizeInfo.forEach(r => (r !== info) && checkList.push(r.newBounds))\n\n\t\t\t// Reject overlapping boundaries\n\t\t\treturn !checkList.some(b => boundsOverlap(bounds, b))\n\t\t})\n\t}\n\n\tvalidateBoundary = (bounds: Bounds, boundaryToIgnore?: Boundary) => {\n\t\t// Reject min == max\n\t\tif (bounds.min.x === bounds.max.x || bounds.min.y === bounds.max.y)\n\t\t\treturn false\n\n\t\t// Reject overlapping boundaries\n\t\treturn this.state.boundaries.every(boundary => {\n\t\t\t// Prevent comparison against self\n\t\t\tif (boundary === boundaryToIgnore)\n\t\t\t\treturn true\n\n\t\t\t// Check it doesn't overlap\n\t\t\treturn !boundsOverlap(bounds, boundary.bounds)\n\t\t})\n\t}\n\n\tonBoundaryAdded = (bounds: Bounds) => {\n\t\tif (!this.validateBoundary(bounds))\n\t\t\treturn\n\n\t\tvar boundaries = this.state.boundaries.slice()\n\t\tboundaries.push({\n\t\t\tbounds: bounds,\n\t\t\tcolor: colors[boundaries.length % colors.length],\n\t\t\tvars: {}\n\t\t})\n\t\tthis.setState({ boundaries, lastBoundaryMoveTime: window.performance.now() })\n\t}\n\n\tonBoundaryDeleted = (boundary: Boundary) => {\n\t\tconst index = this.state.boundaries.findIndex(b => b === boundary)\n\t\tif (index === -1)\n\t\t\treturn\n\n\t\tvar boundaries = this.state.boundaries.slice()\n\t\tboundaries.splice(index, 1)\n\t\tthis.setState({ boundaries, lastBoundaryMoveTime: window.performance.now() })\n\t}\n\n\tonBoundariesUpdated = (resizeInfo: Array<BoundaryResizeInfo>, validate: boolean = true) => {\n\t\tif (validate && !this.validateResize(resizeInfo))\n\t\t\treturn\n\n\t\tconst boundaries = this.state.boundaries.slice()\n\t\tresizeInfo.forEach(info => {\n\t\t\t// Find the right boundary object to to update\n\t\t\tfor (let i = 0; i < boundaries.length; ++i) {\n\t\t\t\tif (info.boundary !== boundaries[i])\n\t\t\t\t\tcontinue\n\n\t\t\t\tconst oldBounds = boundaries[i].bounds\n\t\t\t\toldBounds.min.x = info.newBounds.min.x\n\t\t\t\toldBounds.min.y = info.newBounds.min.y\n\t\t\t\toldBounds.max.x = info.newBounds.max.x\n\t\t\t\toldBounds.max.y = info.newBounds.max.y\n\t\t\t\tbreak\n\t\t\t}\n\t\t})\n\n\t\tthis.setState({\n\t\t\tboundaries,\n\t\t\tlastBoundaryMoveTime: window.performance.now()\n\t\t})\n\t}\n\n\tonUtilFunctionUpdated = (index: number, value: string) => {\n\t\tconst utilFunctions = this.state.utilFunctions.slice()\n\t\tutilFunctions[index].expression = value\n\n\t\t// Try to compile the function\n\t\ttry {\n\t\t\tutilFunctions[index].evalFunc = evaluatex(value, { e: Math.E, pi: Math.PI })\n\t\t} catch {\n\t\t\tutilFunctions[index].evalFunc = null\n\t\t}\n\n\t\tthis.setState({ utilFunctions })\n\t}\n\n\tonServerUtilFunctionUpdated = (value: string) => {\n\t\tconst utilServer = cloneDeep(this.state.utilServer)\n\t\tutilServer.expression = value\n\n\t\t// Try to compile the function\n\t\ttry {\n\t\t\tutilServer.evalFunc = evaluatex(value, { e: Math.E, pi: Math.PI })\n\t\t} catch {\n\t\t\tutilServer.evalFunc = undefined\n\t\t}\n\n\t\tthis.setState({ utilServer })\n\t}\n\n\tonUtilConstantUpdated = (key: string, value: number) => {\n\t\tconst utilConstants = cloneDeep(this.state.utilConstants)\n\t\tutilConstants[key] = value\n\t\tthis.setState({ utilConstants })\n\t}\n\n\tonUtilVarUpdated = (index: number, value: string) => {\n\t\tlet utilFunctions = this.state.utilFunctions.slice()\n\t\tutilFunctions[index].utilVar = value\n\t\tthis.setState({ utilFunctions })\n\t}\n\n\tonUtilFunctionAdded = () => {\n\t\tlet utilFunctions = this.state.utilFunctions.slice()\n\t\tutilFunctions.push({\n\t\t\texpression: \"\",\n\t\t\tutilVar: \"x\",\n\t\t\tcolor: colors[utilFunctions.length % colors.length]\n\t\t})\n\t\tthis.setState({ utilFunctions })\n\t}\n\n\tonUtilFunctionDeleted = (index: number) => {\n\t\tlet utilFunctions = this.state.utilFunctions.slice()\n\t\tutilFunctions.splice(index, 1)\n\t\tthis.setState({ utilFunctions })\n\t}\n\n\tonChangeColorClicked = (index?: number) => {\n\t\tthis.setState({\n\t\t\tshowColorPicker: !this.state.showColorPicker,\n\t\t\tcolorIndex: !this.state.showColorPicker ? index : undefined\n\t\t})\n\t}\n\n\tonColorUpdated = (color: ReactColor.ColorResult) => {\n\t\tlet utilFunctions = this.state.utilFunctions.slice()\n\t\tutilFunctions[this.state.colorIndex as number].color = color.hex\n\t\tthis.setState({ utilFunctions })\n\t}\n\n\tonRandomClicked = () => {\n\t\tif (!this.serverRef.current)\n\t\t\treturn;\n\t\tthis.serverRef.current.spawnRandomObjects(100)\n\t}\n\n\tonClearClicked = () => {\n\t\tif (!this.serverRef.current)\n\t\t\treturn;\n\t\tthis.serverRef.current.clearAllObjects()\n\t}\n\n\tonHomeClicked = () => {\n\t\tif (!this.serverRef.current)\n\t\t\treturn;\n\t\tthis.serverRef.current.resetView()\n\t}\n\n\tonShowAllObjectsClicked = () => {\n\t\tif (!this.serverRef.current)\n\t\t\treturn;\n\t\tthis.serverRef.current.showAllObjects()\n\t}\n\n\tonImportClicked = () => {\n\t\tthis.setState({ showImportModal: true })\n\t}\n\n\tonImportModalClosed = (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n\t\tthis.setState({ showImportModal: false })\n\t}\n\n\tonExportClicked = () => {\n\t\tlet saveObj: ExportData = {\n\t\t\tsimState: {\n\t\t\t\tboundaries: this.state.boundaries,\n\t\t\t\tutilFunctions: this.state.utilFunctions,\n\t\t\t\tutilConstants: this.state.utilConstants,\n\t\t\t\tutilGlobalVars: this.state.utilGlobalVars,\n\t\t\t\tutilServer: this.state.utilServer\n\t\t\t}\n\t\t}\n\n\t\tif (this.serverRef.current && this.serverRef.current.matterWorld) {\n\t\t\tconst matterWorld = this.serverRef.current.matterWorld\n\t\t\tconst allBodies = Matter.Composite.allBodies(matterWorld)\n\n\t\t\t// TODO: Make this object typed\n\t\t\tconst bodies: Array<ExportBody> = allBodies.map(body => { return {\n\t\t\t\tinverseMass: body.inverseMass,\n\t\t\t\tmass: body.mass,\n\t\t\t\tposition: body.position,\n\t\t\t\tspeed: body.speed,\n\t\t\t\tvelocity: body.velocity,\n\t\t\t\tvertices: body.vertices.map(vertex => { return Matter.Vector.create(vertex.x, vertex.y) }),\n\t\t\t}})\n\n\t\t\t//set('bodies', bodies)\n\t\t\tsaveObj.bodies = bodies\n\t\t}\n\n\t\t//set('utilSim', this.state)\n\t\tsaveAs(new Blob([JSON.stringify(saveObj)]), 'util-sim.json')\n\t}\n\n\tonFilesSelected = (fileList: FileList) => {\n\t\tconst file = fileList[0]\n\n\t\tlet reader = new FileReader()\n\t\treader.readAsBinaryString(file)\n\t\treader.onloadend = () => {\n\t\t\tconst newState = JSON.parse(reader.result as string) as ExportData\n\n\t\t\t// Load boundary/function state\n\t\t\tif (newState.simState)\n\t\t\t\tthis.setState(newState.simState)\n\n\t\t\t// Load bodies\n\t\t\tif (newState.bodies && this.serverRef.current && this.serverRef.current.matterWorld) {\n\t\t\t\tconst matterWorld = this.serverRef.current.matterWorld\n\t\t\t\tnewState.bodies.forEach(bodyData => {\n\t\t\t\t\tlet body = Matter.Body.create(bodyData)\n\n\t\t\t\t\t// We need to do this so Matter intializes previousPosition so that\n\t\t\t\t\t// velocity is applied properly and the object resumes movement.\n\t\t\t\t\tMatter.Body.setVelocity(body, body.velocity)\n\n\t\t\t\t\tMatter.World.add(matterWorld, body)\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<MainToolbar\n\t\t\t\t\tonImportClickedCallback = { this.onImportClicked }\n\t\t\t\t\tonExportClickedCallback = { this.onExportClicked }\n\t\t\t\t/>\n\n\t\t\t\t<Modal show={ this.state.showImportModal } onHide={ () => { this.setState({ showImportModal: false }) } }>\n\t\t\t\t\t<Modal.Header closeButton>\n\t\t\t\t\t\t<Modal.Title>Import data</Modal.Title>\n\t\t\t\t\t</Modal.Header>\n\t\t\t\t\t<Modal.Body>\n\t\t\t\t\t\t<DndProvider backend={Backend}>\n\t\t\t\t\t\t\t<ImportDropTarget onFilesSelected={ this.onFilesSelected } />\n\t\t\t\t\t\t</DndProvider>\n\t\t\t\t\t</Modal.Body>\n\t\t\t\t\t<Modal.Footer>\n\t\t\t\t\t\t<Button variant=\"primary\" onClick={ this.onImportModalClosed }>\n\t\t\t\t\t\t\tImport\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Modal.Footer>\n\t\t\t\t</Modal>\n\n\t\t\t\t<Container fluid={true} className=\"mt-2\">\n\t\t\t\t\t<Row>\n\t\t\t\t\t\t<Col>\n\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t<Col>\n\t\t\t\t\t\t\t\t\t<ButtonToolbar className=\"mb-2\">\n\t\t\t\t\t\t\t\t\t\t<ButtonGroup className=\"mr-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"secondary\" title=\"Object mode\" active={this.state.mouseMode === MouseMode.OBJECT} onClick={() => { this.setState({mouseMode: MouseMode.OBJECT })}}>\n\t\t\t\t\t\t\t\t\t\t\t\t<FontAwesomeIcon icon=\"cube\"></FontAwesomeIcon>\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"secondary\" title=\"Boundary mode\" active={this.state.mouseMode === MouseMode.BOUNDARY_EDIT} onClick={() => { this.setState({mouseMode: MouseMode.BOUNDARY_EDIT })}}>\n\t\t\t\t\t\t\t\t\t\t\t\t<FontAwesomeIcon icon=\"vector-square\"></FontAwesomeIcon>\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"secondary\" title=\"Snooker mode\" active={this.state.mouseMode === MouseMode.SNOOKER} onClick={() => { this.setState({mouseMode: MouseMode.SNOOKER })}}>\n\t\t\t\t\t\t\t\t\t\t\t\t<FontAwesomeIcon icon=\"bowling-ball\"></FontAwesomeIcon>\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t\t\t\t\t\t<ButtonGroup className=\"mr-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"secondary\" title=\"Reset view\" onClick={this.onHomeClicked}><FontAwesomeIcon icon=\"home\"></FontAwesomeIcon></Button>\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"secondary\" title=\"Show all objects\" onClick={this.onShowAllObjectsClicked}><FontAwesomeIcon icon=\"eye\"></FontAwesomeIcon></Button>\n\t\t\t\t\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t\t\t\t\t\t<ButtonGroup className=\"mr-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"secondary\" title=\"Toggle snap to grid\" active={this.state.snapToGrid} onClick={() => { this.setState({snapToGrid: !this.state.snapToGrid })}}>\n\t\t\t\t\t\t\t\t\t\t\t\t<FontAwesomeIcon icon=\"magnet\"></FontAwesomeIcon>\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"secondary\" title=\"Decrease grid size\" onClick={() => { this.setState({gridSize: Math.max(25, this.state.gridSize / 2)}) }}>\n\t\t\t\t\t\t\t\t\t\t\t\t<FontAwesomeIcon icon=\"th\"></FontAwesomeIcon>\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"secondary\" title=\"Increase grid size\" onClick={() => { this.setState({gridSize: this.state.gridSize * 2}) }}>\n\t\t\t\t\t\t\t\t\t\t\t\t<FontAwesomeIcon icon=\"th-large\"></FontAwesomeIcon>\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t\t\t\t\t\t<ButtonGroup className=\"mr-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"secondary\" title=\"Spawn random objects\" onClick={this.onRandomClicked}><FontAwesomeIcon icon=\"dice\"></FontAwesomeIcon></Button>\n\t\t\t\t\t\t\t\t\t\t\t<Button size=\"sm\" variant=\"warning\" title=\"Remove all objects\" onClick={this.onClearClicked}><FontAwesomeIcon icon=\"radiation\"></FontAwesomeIcon></Button>\n\t\t\t\t\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t\t\t\t\t</ButtonToolbar>\n\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t<Col>\n\t\t\t\t\t\t\t\t\t<Server\n\t\t\t\t\t\t\t\t\t\tref={this.serverRef}\n\t\t\t\t\t\t\t\t\t\tboundaries={this.state.boundaries}\n\t\t\t\t\t\t\t\t\t\t//objects={this.state.objects}\n\n\t\t\t\t\t\t\t\t\t\t// State\n\t\t\t\t\t\t\t\t\t\tgridSize={this.state.gridSize}\n\t\t\t\t\t\t\t\t\t\tmouseMode={this.state.mouseMode}\n\t\t\t\t\t\t\t\t\t\tsnapToGrid={this.state.snapToGrid}\n\n\t\t\t\t\t\t\t\t\t\t// Callbacks\n\t\t\t\t\t\t\t\t\t\tonBoundaryAdded={this.onBoundaryAdded}\n\t\t\t\t\t\t\t\t\t\tonBoundariesUpdated={this.onBoundariesUpdated}\n\t\t\t\t\t\t\t\t\t\tonBoundaryDeleted={this.onBoundaryDeleted}\n\n\t\t\t\t\t\t\t\t\t\tonEngineBeforeUpdate={this.onEngineBeforeUpdate}\n\t\t\t\t\t\t\t\t\t\tonEngineAfterUpdate={this.onEngineAfterUpdate}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t<Col>\n\t\t\t\t\t\t\t<FunctionPlot\n\t\t\t\t\t\t\t\tboundaries={this.state.boundaries}\n\t\t\t\t\t\t\t\tutilFunctions={this.state.utilFunctions}\n\t\t\t\t\t\t\t\tutilConstants={this.state.utilConstants}\n\t\t\t\t\t\t\t\tutilGlobalVars={this.state.utilGlobalVars}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t<Col>\n\t\t\t\t\t\t\t<ControlPanel\n\t\t\t\t\t\t\t\t// Physics state\n\t\t\t\t\t\t\t\tboundaries={this.state.boundaries}\n\n\t\t\t\t\t\t\t\t// Utility state\n\t\t\t\t\t\t\t\tutilFunctions={this.state.utilFunctions}\n\t\t\t\t\t\t\t\tutilConstants={this.state.utilConstants}\n\t\t\t\t\t\t\t\tutilGlobalVars={this.state.utilGlobalVars}\n\t\t\t\t\t\t\t\tutilServer={this.state.utilServer}\n\n\t\t\t\t\t\t\t\t// Control panel callbacks\n\t\t\t\t\t\t\t\tonUtilFunctionUpdated={this.onUtilFunctionUpdated}\n\t\t\t\t\t\t\t\tonUtilFunctionAdded={this.onUtilFunctionAdded}\n\t\t\t\t\t\t\t\tonUtilFunctionDeleted={this.onUtilFunctionDeleted}\n\t\t\t\t\t\t\t\tonServerUtilFunctionUpdated={this.onServerUtilFunctionUpdated}\n\t\t\t\t\t\t\t\tonUtilConstantUpdated={this.onUtilConstantUpdated}\n\t\t\t\t\t\t\t\tonUtilVarUpdated={this.onUtilVarUpdated}\n\t\t\t\t\t\t\t\tonChangeColorClicked={this.onChangeColorClicked}\n\t\t\t\t\t\t\t\tonColorUpdated={this.onColorUpdated}\n\t\t\t\t\t\t\t\tshowColorPicker={this.state.showColorPicker}\n\t\t\t\t\t\t\t\tcolorIndex={this.state.colorIndex}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Row>\n\t\t\t\t</Container>\n\t\t\t</div>\n\t\t);\n\t}\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n\twindow.location.hostname === 'localhost' ||\n\t\t// [::1] is the IPv6 localhost address.\n\t\twindow.location.hostname === '[::1]' ||\n\t\t// 127.0.0.1/8 is considered localhost for IPv4.\n\t\twindow.location.hostname.match(\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n\t\t)\n);\n\ntype Config = {\n\tonSuccess?: (registration: ServiceWorkerRegistration) => void;\n\tonUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n\tif (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n\t\t// The URL constructor is available in all browsers that support SW.\n\t\tconst publicUrl = new URL(\n\t\t\t(process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n\t\t\twindow.location.href\n\t\t);\n\t\tif (publicUrl.origin !== window.location.origin) {\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\n\t\t\t// serve assets; see https://github.com/facebook/create-react-app/issues/2374\n\t\t\treturn;\n\t\t}\n\n\t\twindow.addEventListener('load', () => {\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n\t\t\tif (isLocalhost) {\n\t\t\t\t// This is running on localhost. Let's check if a service worker still exists or not.\n\t\t\t\tcheckValidServiceWorker(swUrl, config);\n\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\n\t\t\t\t// service worker/PWA documentation.\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t'This web app is being served cache-first by a service ' +\n\t\t\t\t\t\t\t'worker. To learn more, visit https://bit.ly/CRA-PWA'\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Is not localhost. Just register service worker\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n\tnavigator.serviceWorker\n\t\t.register(swUrl)\n\t\t.then(registration => {\n\t\t\tregistration.onupdatefound = () => {\n\t\t\t\tconst installingWorker = registration.installing;\n\t\t\t\tif (installingWorker == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tinstallingWorker.onstatechange = () => {\n\t\t\t\t\tif (installingWorker.state === 'installed') {\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\n\t\t\t\t\t\t\t// At this point, the updated precached content has been fetched,\n\t\t\t\t\t\t\t// but the previous service worker will still serve the older\n\t\t\t\t\t\t\t// content until all client tabs are closed.\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'New content is available and will be used when all ' +\n\t\t\t\t\t\t\t\t\t'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && config.onUpdate) {\n\t\t\t\t\t\t\t\tconfig.onUpdate(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// At this point, everything has been precached.\n\t\t\t\t\t\t\t// It's the perfect time to display a\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\n\t\t\t\t\t\t\tconsole.log('Content is cached for offline use.');\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && config.onSuccess) {\n\t\t\t\t\t\t\t\tconfig.onSuccess(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error('Error during service worker registration:', error);\n\t\t});\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n\t// Check if the service worker can be found. If it can't reload the page.\n\tfetch(swUrl)\n\t\t.then(response => {\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\n\t\t\tconst contentType = response.headers.get('content-type');\n\t\t\tif (\n\t\t\t\tresponse.status === 404 ||\n\t\t\t\t(contentType != null && contentType.indexOf('javascript') === -1)\n\t\t\t) {\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\t\t\tregistration.unregister().then(() => {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Service worker found. Proceed as normal.\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t})\n\t\t.catch(() => {\n\t\t\tconsole.log(\n\t\t\t\t'No internet connection found. App is running in offline mode.'\n\t\t\t);\n\t\t});\n}\n\nexport function unregister() {\n\tif ('serviceWorker' in navigator) {\n\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\tregistration.unregister();\n\t\t});\n\t}\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom';\n\nimport MathJax from 'react-mathjax2';\n\nimport 'bootstrap/dist/css/bootstrap.css';\nimport './index.css';\n\nimport UtilSim from './utilsim'\nimport * as serviceWorker from './serviceWorker';\n\n// Setup Font Awesome\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport {\n\tfaBorderAll, faBowlingBall, faChartLine, faCube, faDice,\n\tfaEye, faHome, faMagnet, faPlus, faPalette, faRadiation,\n\tfaTh, faThLarge, faTrash, faVectorSquare\n} from '@fortawesome/free-solid-svg-icons'\nlibrary.add(\n\tfaBorderAll, faBowlingBall, faChartLine, faCube, faDice,\n\tfaEye, faHome, faMagnet, faPlus, faPalette, faRadiation,\n\tfaTh, faThLarge, faTrash, faVectorSquare\n)\n\n// Setup Why Did You Render?\n// if (process.env.NODE_ENV !== 'production') {\n// \tconst whyDidYouRender = require('@welldone-software/why-did-you-render/dist/no-classes-transpile/umd/whyDidYouRender.min.js');\n// \twhyDidYouRender(React);\n// }\n\nReactDOM.render(\n\t<MathJax.Context\n\t\tinput='ascii'\n\t\toptions={{\n\t\t\tasciimath2jax: {\n\t\t\t\tuseMathMLspacing: true,\n\t\t\t\tpreview: \"none\",\n\t\t\t}\n\t\t}}\n\t>\n\t\t<UtilSim/>\n\t</MathJax.Context>,\n\tdocument.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}