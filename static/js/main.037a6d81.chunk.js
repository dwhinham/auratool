(this["webpackJsonputil-proto"]=this["webpackJsonputil-proto"]||[]).push([[0],{163:function(e,t,n){e.exports=n(357)},175:function(e,t,n){},349:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=349},357:function(e,t,n){"use strict";n.r(t);var o,a=n(0),r=n.n(a),i=n(79),s=n.n(i),l=n(10),c=n.n(l),u=(n(174),n(175),n(31)),d=n(32),m=n(49),h=n(45),v=n(50),f=n(26),b=n(15),y=n(109),p=n.n(y),x=n(5),g=n.n(x),E=n(11),w=n(161),k=n(66),C=n(54),T=n(160),O=n(111),S=n(89),R=n(46),B=n(62),M=function(e,t){return{min:{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)},max:{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}}},P=function(e,t){return!(t.min.x>=e.max.x||t.max.x<=e.min.x||t.max.y<=e.min.y||t.min.y>=e.max.y)},_=function(e,t){var n=e.x-t.x,o=e.y-t.y;return n*n+o*o},U=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return n?e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y:e.x>t.min.x&&e.x<t.max.x&&e.y>t.min.y&&e.y<t.max.y},F=function(e,t,n){return e.x-t<n.min.x||e.x+t>n.max.x||e.y-t<n.min.y||e.y+t>n.max.y},N=function(e,t,n,o){try{return e.evalFunc(Object(B.a)(Object(R.a)({},e.utilVar,t.vars[e.utilVar]),n,{},o))}catch(a){return 0}},A=n(35),I=n(154),D=n.n(I),V={C_m:{desc:"Cost of sending and receiving an object migration",defaultValue:1},C_c:{desc:"Cost of sending and receiving an aura creation",defaultValue:1},C_u:{desc:"Cost of sending and receiving an aura update",defaultValue:1},C_d:{desc:"Cost of sending and receiving an aura deletion",defaultValue:1},C_i:{desc:"Cost of number of objects out of host region (islands)",defaultValue:1}},j={sigma:{type:"count",desc:"Number of servers"},N:{type:"count",desc:"Total number of objects in the world"},t:{type:"count",desc:"Time since boundaries were last moved (seconds)"}},z={lambda:{type:"proportion",desc:"CPU load of the server"},delta:{type:"count",desc:"Frame time for the physics simulation step (milliseconds)"},alpha:{type:"proportion",desc:"Number of active (awake) objects"},beta:{type:"proportion",desc:"Number of objects near a boundary"},n:{type:"count",desc:"Number of objects managed by this server"}},G=function(e){return a.createElement("div",null,a.createElement("h5",null,"Constants (click to edit)"),a.createElement(A.a,{hover:!0,striped:!0,size:"sm"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Name"),a.createElement("th",null,"Value"),a.createElement("th",null,"Description"))),a.createElement("tbody",null,Object.keys(e.utilConstants).map((function(t,n){return a.createElement("tr",{key:n},a.createElement("td",null,a.createElement(c.a.Node,null,t)),a.createElement(D.a,{html:"".concat(e.utilConstants[t]),tagName:"td",onChange:function(n){return e.onUtilConstantUpdated(t,parseFloat(n.target.value.trim()))}}),a.createElement("td",null,V[t].desc))})))),a.createElement("h5",null,"Global variables"),a.createElement(A.a,{hover:!0,striped:!0,size:"sm"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Name"),a.createElement("th",null,"Value"),a.createElement("th",null,"Type"),a.createElement("th",null,"Description"))),a.createElement("tbody",null,Object.keys(e.utilGlobalVars).map((function(t,n){return a.createElement("tr",{key:n},a.createElement("td",null,a.createElement(c.a.Node,null,t)),a.createElement("td",null,e.utilGlobalVars[t].toFixed(2)),a.createElement("td",null,j[t].type),a.createElement("td",null,j[t].desc))})))),a.createElement("h5",null,"Server-local variables"),a.createElement(A.a,{hover:!0,striped:!0,size:"sm"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Name"),a.createElement("th",null,"Type"),a.createElement("th",null,"Description"))),a.createElement("tbody",null,Object.keys(z).map((function(e,t){return a.createElement("tr",{key:t},a.createElement("td",null,a.createElement(c.a.Node,null,e)),a.createElement("td",null,z[e].type),a.createElement("td",null,z[e].desc))})))),a.createElement("h5",null,"Server-local variable values"),e.boundaries.length>0&&a.createElement(A.a,{hover:!0,striped:!0,size:"sm"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Server"),Object.keys(e.boundaries[0].vars).map((function(e,t){return a.createElement("th",{key:t,title:"".concat(z[e].desc," (").concat(z[e].type,")")},a.createElement(c.a.Node,null,e))})))),a.createElement("tbody",null,e.boundaries.map((function(e,t){return a.createElement("tr",{key:t},a.createElement("td",null,t),Object.keys(e.vars).map((function(t,n){return a.createElement("td",{key:n},e.vars[t].toFixed(2))})))})))))},W=n(156),L=n(39),H=n(112),q=n(38),Y=n(88),K=n(162),J=function(e){var t={position:"absolute",top:"2.5rem",right:0,zIndex:200},n={position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},o=e.boundaries.map((function(t){return function(e,t,n,o,a){if(!e.evalFunc)return 0;var r=Object(B.a)({},n.vars,{},o,{},a);t.forEach((function(e){e.evalFunc&&"x"!==e.utilVar&&(r["U_".concat(e.utilVar)]=N(e,n,o,a))}));try{return e.evalFunc(r)}catch(i){return 0}}(e.utilServer,e.utilFunctions,t,e.utilConstants,e.utilGlobalVars)})),r=o.length?o.reduce((function(e,t){return e+t})).toFixed(2):0;return a.createElement(K.a,{id:"control-panel"},a.createElement(Y.a,{eventKey:"variables",title:"Variables"},a.createElement(G,{boundaries:e.boundaries,utilConstants:e.utilConstants,utilGlobalVars:e.utilGlobalVars,onUtilConstantUpdated:e.onUtilConstantUpdated})),a.createElement(Y.a,{eventKey:"functions",title:"Functions"},a.createElement("h5",null,"Utility functions"),e.utilFunctions.map((function(o,r){return a.createElement(q.a,{className:"mb-1",key:r},a.createElement(q.a.Prepend,null,a.createElement(q.a.Text,null,a.createElement(c.a.Node,{inline:!0},"U_".concat(o.utilVar,"=").concat(o.expression)))),a.createElement(H.a,{placeholder:"Function (in ASCIImath)","aria-label":"Function (in ASCIImath)",onChange:function(t){return t.currentTarget.value&&e.onUtilFunctionUpdated(r,t.currentTarget.value)},value:o.expression}),a.createElement(q.a.Append,null,a.createElement(L.a,null,a.createElement(L.a.Toggle,{id:"util-var-dropdown-".concat(r),variant:"dark",style:{borderRadius:0}},a.createElement(c.a.Node,{inline:!0},o.utilVar)),a.createElement(L.a.Menu,null,a.createElement(L.a.Header,null,"Utility variable"),a.createElement(L.a.Item,{onSelect:function(){e.onUtilVarUpdated(r,"x")}},a.createElement(c.a.Node,{inline:!0},"x")),a.createElement(L.a.Divider,null),Object.keys(z).map((function(t,n){return a.createElement(L.a.Item,{key:n,onSelect:function(){e.onUtilVarUpdated(r,t)}},a.createElement(c.a.Node,null,t))})))),a.createElement(E.a,{onClick:function(){return e.onChangeColorClicked(r)},style:{backgroundColor:o.color}},a.createElement(b.a,{icon:"palette"})),e.showColorPicker&&e.colorIndex===r&&a.createElement("div",{style:t},a.createElement("div",{style:n,onClick:function(){return e.onChangeColorClicked(void 0)}}),a.createElement(W.SketchPicker,{disableAlpha:!0,color:o.color,onChange:e.onColorUpdated})),a.createElement(E.a,{variant:"danger",onClick:function(){return e.onUtilFunctionDeleted(r)}},a.createElement(b.a,{icon:"trash"}))))})),a.createElement(E.a,{className:"mb-2",variant:"success",onClick:e.onUtilFunctionAdded},a.createElement(b.a,{icon:"plus"}),"\xa0Add function"),a.createElement("h5",null,"Local utility"),a.createElement(q.a,{className:"mb-1"},a.createElement(q.a.Prepend,null,a.createElement(q.a.Text,null,a.createElement(c.a.Node,{inline:!0},"U_i=".concat(e.utilServer.expression)))),a.createElement(H.a,{placeholder:"Function (in ASCIImath)","aria-label":"Function (in ASCIImath)",onChange:function(t){return t.currentTarget.value&&e.onServerUtilFunctionUpdated(t.currentTarget.value)},value:e.utilServer.expression})),a.createElement(A.a,{hover:!0,striped:!0,size:"sm"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Server"),a.createElement("th",null,a.createElement(c.a.Node,null,"U_i")))),a.createElement("tbody",null,e.boundaries.map((function(e,t){return a.createElement("tr",{key:t},a.createElement("td",null,t),a.createElement("td",null,a.createElement(c.a.Node,null,o[t].toFixed(2))))})))),a.createElement("h5",null,"Global utility"),a.createElement(c.a.Node,null,"U_g = U_0 + U_1 + ... + U_n"),"= ",r),a.createElement(Y.a,{eventKey:"boundaries",title:"Boundaries"},a.createElement(A.a,{hover:!0,striped:!0,size:"sm"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("td",null,"Server"),a.createElement("td",null,a.createElement(c.a.Node,null,"x_1")),a.createElement("td",null,a.createElement(c.a.Node,null,"y_1")),a.createElement("td",null,a.createElement(c.a.Node,null,"x_2")),a.createElement("td",null,a.createElement(c.a.Node,null,"y_2")),a.createElement("td",null,"Width"),a.createElement("td",null,"Height"))),a.createElement("tbody",null,e.boundaries.map((function(e,t){return a.createElement("tr",{key:t},a.createElement("td",null,t),a.createElement("td",null,e.bounds.min.x.toFixed(2)),a.createElement("td",null,e.bounds.min.y.toFixed(2)),a.createElement("td",null,e.bounds.max.x.toFixed(2)),a.createElement("td",null,e.bounds.max.y.toFixed(2)),a.createElement("td",null,(e.bounds.max.x-e.bounds.min.x).toFixed(2)),a.createElement("td",null,(e.bounds.max.y-e.bounds.min.y).toFixed(2)))}))))))},Z=n(158),X=n(110),$=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).updateCurves=Object(X.a)((function(e,t,o){var a=(n.state.xRange[1]-n.state.xRange[0])/100,r=new Array;return e.forEach((function(e){if(e.evalFunc){var i={label:"U(".concat(e.utilVar,")"),fill:!1,showLine:!0,pointRadius:0,pointHitRadius:2,backgroundColor:e.color,borderColor:e.color,borderWidth:2};i.data=new Array(100);try{for(var s=n.state.xRange[0];s<=n.state.xRange[1];s+=a){var l=e.evalFunc(Object(B.a)(Object(R.a)({},e.utilVar,s),t,{},o));i.data.push({x:s,y:l})}r.push(i)}catch(c){}}})),r})),n.updatePoints=Object(X.a)((function(e,t,n,o){var a=new Array;return t.forEach((function(t){if(t.evalFunc&&"x"!==t.utilVar)try{e.forEach((function(e,r){var i=e.vars[t.utilVar],s=N(t,e,n,o);a.push({label:"B".concat(r," U(").concat(t.utilVar,")"),fill:!0,showLine:!1,pointRadius:6,pointStyle:"circle",pointHitRadius:2,backgroundColor:e.color,borderColor:t.color,data:[{x:i,y:s}]})}))}catch(r){}})),a})),n.state={xRange:[0,1],yRange:[0,1]},n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.updateCurves(this.props.utilFunctions,this.props.utilConstants,this.props.utilGlobalVars),t={datasets:this.updatePoints(this.props.boundaries,this.props.utilFunctions,this.props.utilConstants,this.props.utilGlobalVars).concat(e)};return a.createElement(Z.a,{data:t,options:{maintainAspectRatio:!1,animation:{duration:0}}})}}]),t}(a.Component),Q=n(30),ee=n.n(Q),te=n(12),ne=n.n(te),oe=n(64),ae=n.n(oe),re=n(42),ie=n.n(re),se=n(86),le=n.n(se),ce=n(52),ue=n.n(ce),de=n(18),me=n.n(de),he=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,null,[{key:"create",value:function(t){var n={controller:e,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#18181d",wireframeBackground:"#0f0f13",gridSize:50,hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1,showGrid:!0,crosshairSnap:!1}},o=ne.a.extend(n,t);return o.canvas&&(o.canvas.width=o.options.width||o.canvas.width,o.canvas.height=o.options.height||o.canvas.height),o.mouse=t.mouse,o.engine=t.engine,o.canvas=o.canvas||e._createCanvas(o.options.width,o.options.height),o.context=o.canvas.getContext("2d"),o.textures={},o.bounds=o.bounds||{min:{x:0,y:0},max:{x:o.canvas.width,y:o.canvas.height}},1!==o.options.pixelRatio&&e.setPixelRatio(o,o.options.pixelRatio),ne.a.isElement(o.element)?o.element.appendChild(o.canvas):o.canvas.parentNode||ne.a.log("RenderAuraProj.create: options.element was undefined, render.canvas was created but not appended","warn"),o}},{key:"run",value:function(t){!function n(o){t.frameRequestId=e._requestAnimationFrame.call(window,n),e.world(t)}()}},{key:"stop",value:function(t){e._cancelAnimationFrame.call(window,t.frameRequestId)}},{key:"setPixelRatio",value:function(t,n){var o=t.options,a=t.canvas;"auto"===n&&(n=e._getPixelRatio(a)),o.pixelRatio=n,a.setAttribute("data-pixel-ratio",n),a.width=o.width*n,a.height=o.height*n,a.style.width=o.width+"px",a.style.height=o.height+"px"}},{key:"lookAt",value:function(e,t,n,o){o="undefined"===typeof o||o,t=ne.a.isArray(t)?t:[t],n=n||{x:0,y:0};for(var a={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},r=0;r<t.length;r+=1){var i=t[r],s=i.bounds?i.bounds.min:i.min||i.position||i,l=i.bounds?i.bounds.max:i.max||i.position||i;s&&l&&(s.x<a.min.x&&(a.min.x=s.x),l.x>a.max.x&&(a.max.x=l.x),s.y<a.min.y&&(a.min.y=s.y),l.y>a.max.y&&(a.max.y=l.y))}var c=a.max.x-a.min.x+2*n.x,u=a.max.y-a.min.y+2*n.y,d=e.canvas.height,m=e.canvas.width/d,h=c/u,v=1,f=1;h>m?f=h/m:v=m/h,e.options.hasBounds=!0,e.bounds.min.x=a.min.x,e.bounds.max.x=a.min.x+c*v,e.bounds.min.y=a.min.y,e.bounds.max.y=a.min.y+u*f,o&&(e.bounds.min.x+=.5*c-c*v*.5,e.bounds.max.x+=.5*c-c*v*.5,e.bounds.min.y+=.5*u-u*f*.5,e.bounds.max.y+=.5*u-u*f*.5),e.bounds.min.x-=n.x,e.bounds.max.x-=n.x,e.bounds.min.y-=n.y,e.bounds.max.y-=n.y,e.mouse&&(ue.a.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),ue.a.setOffset(e.mouse,e.bounds.min))}},{key:"startViewTransform",value:function(e){var t=e.bounds.max.x-e.bounds.min.x,n=e.bounds.max.y-e.bounds.min.y,o=t/e.options.width,a=n/e.options.height;e.context.setTransform(e.options.pixelRatio/o,0,0,e.options.pixelRatio/a,0,0),e.context.translate(-e.bounds.min.x,-e.bounds.min.y)}},{key:"endViewTransform",value:function(e){e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0)}},{key:"drawGrid",value:function(t,n){var o=t.options.gridSize,a=t.canvas.width,r=t.canvas.height,i=t.bounds,s=i.max.x-i.min.x,l=i.max.y-i.min.y,c=a/s,u=-i.min.x,d=-i.min.y,m=e._mod(u,o),h=e._mod(d,o);n.lineWidth=1,n.setLineDash([]),n.strokeStyle="rgb(128, 128, 255, 0.2)",n.fillStyle="black";var v=function(t,o){t=e._roundDrawCoord(t),n.beginPath(),n.moveTo(t,0),n.lineTo(t,r),n.stroke(),n.fillText(o,t+2,r-2)},f=function(t,o){t=e._roundDrawCoord(t),n.beginPath(),n.moveTo(0,t),n.lineTo(a,t),n.stroke(),n.fillText(o,0,t+2)},b=Math.floor(i.min.x/o)*o,y=Math.floor(i.min.y/o)*o;0!==m&&(b+=o),0!==h&&(y+=o);for(var p=m;p<s;p+=o,b+=o)e._almostEqual(p,u)?(n.save(),n.strokeStyle="rgb(255, 128, 128, 0.5)",v(p*c,b),n.restore()):v(p*c,b);for(var x=h;x<l;x+=o,y+=o)e._almostEqual(x,d)?(n.save(),n.strokeStyle="rgb(255, 128, 128, 0.5)",f(x*c,y),n.restore()):f(x*c,y)}},{key:"drawCrosshair",value:function(t,n){var o=t.canvas.width/(t.bounds.max.x-t.bounds.min.x),a=t.options.gridSize;if(t.mouse){var r=t.mouse.position.x,i=t.mouse.position.y;t.options.crosshairSnap&&(r=Math.round(r/a)*a,i=Math.round(i/a)*a);var s=e._roundDrawCoord((r-t.bounds.min.x)*o),l=e._roundDrawCoord((i-t.bounds.min.y)*o);n.setLineDash([5,8]),n.lineWidth=1,n.strokeStyle="black",n.fillStyle="black",n.beginPath(),n.moveTo(s,0),n.lineTo(s,t.canvas.height),n.stroke(),n.beginPath(),n.moveTo(0,l),n.lineTo(t.canvas.width,l),n.stroke(),n.fillText("".concat(Object(f.round)(r,2),", ").concat(Object(f.round)(i,2)),s+10,l-10)}}},{key:"world",value:function(t){var n,o=t.engine,a=o.world,r=t.canvas,i=t.context,s=t.options,l=ae.a.allBodies(a),c=ae.a.allConstraints(a),u=s.wireframes?s.wireframeBackground:s.background,d=[],m=[],h={timestamp:o.timing.timestamp};if(ie.a.trigger(t,"beforeRender",h),t.currentBackground!==u&&e._applyBackground(t,u),i.globalCompositeOperation="source-in",i.fillStyle="transparent",i.fillRect(0,0,r.width,r.height),i.globalCompositeOperation="source-over",t.options.showGrid&&e.drawGrid(t,i),ie.a.trigger(t,"beforeObjects",h),s.hasBounds){for(n=0;n<l.length;n++){var v=l[n];ee.a.overlaps(v.bounds,t.bounds)&&d.push(v)}for(n=0;n<c.length;n++){var f=c[n],b=f.bodyA,y=f.bodyB,p=f.pointA,x=f.pointB;b&&(p=me.a.add(b.position,f.pointA)),y&&(x=me.a.add(y.position,f.pointB)),p&&x&&((ee.a.contains(t.bounds,p)||ee.a.contains(t.bounds,x))&&m.push(f))}e.startViewTransform(t),t.mouse&&(ue.a.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.options.width,y:(t.bounds.max.y-t.bounds.min.y)/t.options.height}),ue.a.setOffset(t.mouse,t.bounds.min))}else m=c,d=l,1!==t.options.pixelRatio&&t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0);!s.wireframes||o.enableSleeping&&s.showSleeping?e.bodies(t,d,i):(s.showConvexHulls&&e.bodyConvexHulls(t,d,i),e.bodyWireframes(t,d,i)),s.showBounds&&e.bodyBounds(t,d,i),(s.showAxes||s.showAngleIndicator)&&e.bodyAxes(t,d,i),s.showPositions&&e.bodyPositions(t,d,i),s.showVelocity&&e.bodyVelocity(t,d,i),s.showIds&&e.bodyIds(t,d,i),s.showSeparations&&e.separations(t,o.pairs.list,i),s.showCollisions&&e.collisions(t,o.pairs.list,i),s.showVertexNumbers&&e.vertexNumbers(t,d,i),s.showMousePosition&&e.mousePosition(t,t.mouse,i),e.constraints(m,i),s.showBroadphase&&o.broadphase.controller===le.a&&e.grid(t,o.broadphase,i),s.showDebug&&e.debug(t,i),s.hasBounds&&e.endViewTransform(t),ie.a.trigger(t,"afterRender",h),t.options.showCrosshair&&e.drawCrosshair(t,i)}},{key:"debug",value:function(e,t){var n=t,o=e.engine,a=o.world,r=o.metrics,i=e.options,s=ae.a.allBodies(a);if(o.timing.timestamp-(e.debugTimestamp||0)>=500){var l="";r.timing&&(l+="fps: "+Math.round(r.timing.fps)+"    "),r.extended&&(r.timing&&(l+="delta: "+r.timing.delta.toFixed(3)+"    ",l+="correction: "+r.timing.correction.toFixed(3)+"    "),l+="bodies: "+s.length+"    ",o.broadphase.controller===le.a&&(l+="buckets: "+r.buckets+"    "),l+="\n",l+="collisions: "+r.collisions+"    ",l+="pairs: "+o.pairs.list.length+"    ",l+="broad: "+r.broadEff+"    ",l+="mid: "+r.midEff+"    ",l+="narrow: "+r.narrowEff+"    "),e.debugString=l,e.debugTimestamp=o.timing.timestamp}if(e.debugString){n.font="12px Arial",i.wireframes?n.fillStyle="rgba(255,255,255,0.5)":n.fillStyle="rgba(0,0,0,0.5)";for(var c=e.debugString.split("\n"),u=0;u<c.length;u++)n.fillText(c[u],50,50+18*u)}}},{key:"constraints",value:function(e,t){for(var n=t,o=0;o<e.length;o++){var a=e[o];if(a.render.visible&&a.pointA&&a.pointB){var r,i,s=a.bodyA,l=a.bodyB;if(r=s?me.a.add(s.position,a.pointA):a.pointA,"pin"===a.render.type)n.beginPath(),n.arc(r.x,r.y,3,0,2*Math.PI),n.closePath();else{if(i=l?me.a.add(l.position,a.pointB):a.pointB,n.beginPath(),n.moveTo(r.x,r.y),"spring"===a.render.type)for(var c,u=me.a.sub(i,r),d=me.a.perp(me.a.normalise(u)),m=Math.ceil(ne.a.clamp(a.length/5,12,20)),h=1;h<m;h+=1)c=h%2===0?1:-1,n.lineTo(r.x+u.x*(h/m)+d.x*c*4,r.y+u.y*(h/m)+d.y*c*4);n.lineTo(i.x,i.y)}a.render.lineWidth&&(n.lineWidth=a.render.lineWidth,n.strokeStyle=a.render.strokeStyle,n.stroke()),a.render.anchors&&(n.fillStyle=a.render.strokeStyle,n.beginPath(),n.arc(r.x,r.y,3,0,2*Math.PI),n.arc(i.x,i.y,3,0,2*Math.PI),n.closePath(),n.fill())}}}},{key:"bodyShadows",value:function(e,t,n){for(var o=n,a=0;a<t.length;a++){var r=t[a];if(r.render.visible){if(r.circleRadius)o.beginPath(),o.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI),o.closePath();else{o.beginPath(),o.moveTo(r.vertices[0].x,r.vertices[0].y);for(var i=1;i<r.vertices.length;i++)o.lineTo(r.vertices[i].x,r.vertices[i].y);o.closePath()}var s=r.position.x-.5*e.options.width,l=r.position.y-.2*e.options.height,c=Math.abs(s)+Math.abs(l);o.shadowColor="rgba(0,0,0,0.15)",o.shadowOffsetX=.05*s,o.shadowOffsetY=.05*l,o.shadowBlur=1+12*Math.min(1,c/1e3),o.fill(),o.shadowColor=null,o.shadowOffsetX=null,o.shadowOffsetY=null,o.shadowBlur=null}}}},{key:"bodies",value:function(t,n,o){var a,r,i,s,l=o,c=t.options,u=c.showInternalEdges||!c.wireframes;for(i=0;i<n.length;i++)if((a=n[i]).render.visible)for(s=a.parts.length>1?1:0;s<a.parts.length;s++)if((r=a.parts[s]).render.visible){if(r.render.sprite&&r.render.sprite.texture&&!c.wireframes){var d=r.render.sprite,m=e._getTexture(t,d.texture);l.translate(r.position.x,r.position.y),l.rotate(r.angle),l.drawImage(m,m.width*-d.xOffset*d.xScale,m.height*-d.yOffset*d.yScale,m.width*d.xScale,m.height*d.yScale),l.rotate(-r.angle),l.translate(-r.position.x,-r.position.y)}else{if(r.circleRadius)l.beginPath(),l.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI);else{l.beginPath(),l.moveTo(r.vertices[0].x,r.vertices[0].y);for(var h=1;h<r.vertices.length;h++)!r.vertices[h-1].isInternal||u?l.lineTo(r.vertices[h].x,r.vertices[h].y):l.moveTo(r.vertices[h].x,r.vertices[h].y),r.vertices[h].isInternal&&!u&&l.moveTo(r.vertices[(h+1)%r.vertices.length].x,r.vertices[(h+1)%r.vertices.length].y);l.lineTo(r.vertices[0].x,r.vertices[0].y),l.closePath()}c.wireframes?(l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()):(c.showSleeping&&a.isSleeping?l.fillStyle=e._colorLuminance(r.render.fillStyle,-.2):l.fillStyle=r.render.fillStyle,r.render.lineWidth&&(l.lineWidth=r.render.lineWidth,l.strokeStyle=r.render.strokeStyle,l.stroke()),l.fill())}l.globalAlpha=1}}},{key:"bodyWireframes",value:function(e,t,n){var o,a,r,i,s,l=n,c=e.options.showInternalEdges;for(l.beginPath(),r=0;r<t.length;r++)if((o=t[r]).render.visible)for(s=o.parts.length>1?1:0;s<o.parts.length;s++){for(a=o.parts[s],l.moveTo(a.vertices[0].x,a.vertices[0].y),i=1;i<a.vertices.length;i++)!a.vertices[i-1].isInternal||c?l.lineTo(a.vertices[i].x,a.vertices[i].y):l.moveTo(a.vertices[i].x,a.vertices[i].y),a.vertices[i].isInternal&&!c&&l.moveTo(a.vertices[(i+1)%a.vertices.length].x,a.vertices[(i+1)%a.vertices.length].y);l.lineTo(a.vertices[0].x,a.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()}},{key:"bodyConvexHulls",value:function(e,t,n){var o,a,r,i=n;for(i.beginPath(),a=0;a<t.length;a++)if((o=t[a]).render.visible&&1!==o.parts.length){for(i.moveTo(o.vertices[0].x,o.vertices[0].y),r=1;r<o.vertices.length;r++)i.lineTo(o.vertices[r].x,o.vertices[r].y);i.lineTo(o.vertices[0].x,o.vertices[0].y)}i.lineWidth=1,i.strokeStyle="rgba(255,255,255,0.2)",i.stroke()}},{key:"vertexNumbers",value:function(e,t,n){var o,a,r,i=n;for(o=0;o<t.length;o++){var s=t[o].parts;for(r=s.length>1?1:0;r<s.length;r++){var l=s[r];for(a=0;a<l.vertices.length;a++)i.fillStyle="rgba(255,255,255,0.2)",i.fillText(o+"_"+a,l.position.x+.8*(l.vertices[a].x-l.position.x),l.position.y+.8*(l.vertices[a].y-l.position.y))}}}},{key:"mousePosition",value:function(e,t,n){var o=n;o.fillStyle="rgba(255,255,255,0.8)",o.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)}},{key:"bodyBounds",value:function(e,t,n){var o=n,a=e.options;o.beginPath();for(var r=0;r<t.length;r++){if(t[r].render.visible)for(var i=t[r].parts,s=i.length>1?1:0;s<i.length;s++){var l=i[s];o.rect(l.bounds.min.x,l.bounds.min.y,l.bounds.max.x-l.bounds.min.x,l.bounds.max.y-l.bounds.min.y)}}a.wireframes?o.strokeStyle="rgba(255,255,255,0.08)":o.strokeStyle="rgba(0,0,0,0.1)",o.lineWidth=1,o.stroke()}},{key:"bodyAxes",value:function(e,t,n){var o,a,r,i,s=n,l=e.options;for(s.beginPath(),a=0;a<t.length;a++){var c=t[a],u=c.parts;if(c.render.visible)if(l.showAxes)for(r=u.length>1?1:0;r<u.length;r++)for(o=u[r],i=0;i<o.axes.length;i++){var d=o.axes[i];s.moveTo(o.position.x,o.position.y),s.lineTo(o.position.x+20*d.x,o.position.y+20*d.y)}else for(r=u.length>1?1:0;r<u.length;r++)for(o=u[r],i=0;i<o.axes.length;i++)s.moveTo(o.position.x,o.position.y),s.lineTo((o.vertices[0].x+o.vertices[o.vertices.length-1].x)/2,(o.vertices[0].y+o.vertices[o.vertices.length-1].y)/2)}l.wireframes?(s.strokeStyle="indianred",s.lineWidth=1):(s.strokeStyle="rgba(255, 255, 255, 0.4)",s.globalCompositeOperation="overlay",s.lineWidth=2),s.stroke(),s.globalCompositeOperation="source-over"}},{key:"bodyPositions",value:function(e,t,n){var o,a,r,i,s=n,l=e.options;for(s.beginPath(),r=0;r<t.length;r++)if((o=t[r]).render.visible)for(i=0;i<o.parts.length;i++)a=o.parts[i],s.arc(a.position.x,a.position.y,3,0,2*Math.PI,!1),s.closePath();for(l.wireframes?s.fillStyle="indianred":s.fillStyle="rgba(0,0,0,0.5)",s.fill(),s.beginPath(),r=0;r<t.length;r++)(o=t[r]).render.visible&&(s.arc(o.positionPrev.x,o.positionPrev.y,2,0,2*Math.PI,!1),s.closePath());s.fillStyle="rgba(255,165,0,0.8)",s.fill()}},{key:"bodyVelocity",value:function(e,t,n){var o=n;o.beginPath();for(var a=0;a<t.length;a++){var r=t[a];r.render.visible&&(o.moveTo(r.position.x,r.position.y),o.lineTo(r.position.x+2*(r.position.x-r.positionPrev.x),r.position.y+2*(r.position.y-r.positionPrev.y)))}o.lineWidth=3,o.strokeStyle="cornflowerblue",o.stroke()}},{key:"bodyIds",value:function(e,t,n){var o,a,r=n;for(o=0;o<t.length;o++)if(t[o].render.visible){var i=t[o].parts;for(a=i.length>1?1:0;a<i.length;a++){var s=i[a];r.font="12px Arial",r.fillStyle="rgba(255,255,255,0.5)",r.fillText(s.id,s.position.x+10,s.position.y-10)}}}},{key:"collisions",value:function(e,t,n){var o,a,r,i,s=n,l=e.options;for(s.beginPath(),r=0;r<t.length;r++)if((o=t[r]).isActive)for(a=o.collision,i=0;i<o.activeContacts.length;i++){var c=o.activeContacts[i].vertex;s.rect(c.x-1.5,c.y-1.5,3.5,3.5)}for(l.wireframes?s.fillStyle="rgba(255,255,255,0.7)":s.fillStyle="orange",s.fill(),s.beginPath(),r=0;r<t.length;r++)if((o=t[r]).isActive&&(a=o.collision,o.activeContacts.length>0)){var u=o.activeContacts[0].vertex.x,d=o.activeContacts[0].vertex.y;2===o.activeContacts.length&&(u=(o.activeContacts[0].vertex.x+o.activeContacts[1].vertex.x)/2,d=(o.activeContacts[0].vertex.y+o.activeContacts[1].vertex.y)/2),a.bodyB===a.supports[0].body||!0===a.bodyA.isStatic?s.moveTo(u-8*a.normal.x,d-8*a.normal.y):s.moveTo(u+8*a.normal.x,d+8*a.normal.y),s.lineTo(u,d)}l.wireframes?s.strokeStyle="rgba(255,165,0,0.7)":s.strokeStyle="orange",s.lineWidth=1,s.stroke()}},{key:"separations",value:function(e,t,n){var o,a,r,i,s,l=n,c=e.options;for(l.beginPath(),s=0;s<t.length;s++)if((o=t[s]).isActive){r=(a=o.collision).bodyA;var u=1;(i=a.bodyB).isStatic||r.isStatic||(u=.5),i.isStatic&&(u=0),l.moveTo(i.position.x,i.position.y),l.lineTo(i.position.x-a.penetration.x*u,i.position.y-a.penetration.y*u),u=1,i.isStatic||r.isStatic||(u=.5),r.isStatic&&(u=0),l.moveTo(r.position.x,r.position.y),l.lineTo(r.position.x+a.penetration.x*u,r.position.y+a.penetration.y*u)}c.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()}},{key:"grid",value:function(e,t,n){var o=n;e.options.wireframes?o.strokeStyle="rgba(255,180,0,0.1)":o.strokeStyle="rgba(255,180,0,0.5)",o.beginPath();for(var a=ne.a.keys(t.buckets),r=0;r<a.length;r++){var i=a[r];if(!(t.buckets[i].length<2)){var s=i.split(/C|R/);o.rect(.5+parseInt(s[1],10)*t.bucketWidth,.5+parseInt(s[2],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}o.lineWidth=1,o.stroke()}},{key:"inspector",value:function(e,t){var n,o=e.selected,a=e.render,r=a.options;if(r.hasBounds){var i=a.bounds.max.x-a.bounds.min.x,s=a.bounds.max.y-a.bounds.min.y,l=i/a.options.width,c=s/a.options.height;t.scale(1/l,1/c),t.translate(-a.bounds.min.x,-a.bounds.min.y)}for(var u=0;u<o.length;u++){var d=o[u].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),d.type){case"body":n=d.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var m=d.pointA;d.bodyA&&(m=d.pointB),t.beginPath(),t.arc(m.x,m.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),r.hasBounds&&t.setTransform(1,0,0,1,0,0)}},{key:"_createCanvas",value:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n}},{key:"_getPixelRatio",value:function(e){var t=e.getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}},{key:"_getTexture",value:function(e,t){var n=e.textures[t];return n||((n=e.textures[t]=new Image).src=t,n)}},{key:"_applyBackground",value:function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}},{key:"_mod",value:function(e,t){return(e%t+t)%t}},{key:"_almostEqual",value:function(e,t){return Math.abs(e-t)<1e-5}},{key:"_roundDrawCoord",value:function(e){return Math.round(e)+.5}},{key:"_colorLuminance",value:function(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var n,o,a="#";for(o=0;o<3;o++)n=parseInt(e.substr(2*o,2),16),a+=("00"+(n=Math.round(Math.min(Math.max(0,n+n*t),255)).toString(16))).substr(n.length);return a}}]),e}();he._requestAnimationFrame=function(){if("undefined"!==typeof window)return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout((function(){e(ne.a.now())}),1e3/60)}}(),he._cancelAnimationFrame=function(){if("undefined"!==typeof window)return window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame}(),function(e){e[e.OBJECT=0]="OBJECT",e[e.BOUNDARY_EDIT=1]="BOUNDARY_EDIT",e[e.SNOOKER=2]="SNOOKER"}(o||(o={}));var ve;!function(e){e[e.NONE=0]="NONE",e[e.LEFT_EDGE=1]="LEFT_EDGE",e[e.RIGHT_EDGE=2]="RIGHT_EDGE",e[e.TOP_EDGE=3]="TOP_EDGE",e[e.BOTTOM_EDGE=4]="BOTTOM_EDGE",e[e.TOP_LEFT_CORNER=5]="TOP_LEFT_CORNER",e[e.TOP_RIGHT_CORNER=6]="TOP_RIGHT_CORNER",e[e.BOTTOM_RIGHT_CORNER=7]="BOTTOM_RIGHT_CORNER",e[e.BOTTOM_LEFT_CORNER=8]="BOTTOM_LEFT_CORNER",e[e.HORIZONTAL_SPLIT=9]="HORIZONTAL_SPLIT",e[e.VERTICAL_SPLIT=10]="VERTICAL_SPLIT",e[e.CROSS_SPLIT=11]="CROSS_SPLIT"}(ve||(ve={}));var fe=function(e){function t(e){var n;Object(u.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).matterEngine=void 0,n.matterMouse=void 0,n.matterMouseConstraint=void 0,n.matterRender=void 0,n.matterRunner=void 0,n.matterWorld=void 0,n.componentDidMount=function(){var e=n.state.canvasRef.current;if(e){var t=e.getContext("2d");if(t){t.font="12px Arial",e.style.width="100%",e.style.height="100%",e.width=e.offsetWidth,e.height=e.offsetHeight,e.oncontextmenu=function(){return!1},e.onselectstart=function(){return!1},n.matterWorld=g.a.World.create({gravity:{scale:1,x:0,y:0}}),n.matterEngine=g.a.Engine.create({enableSleeping:!0,world:n.matterWorld}),n.matterMouse=g.a.Mouse.create(e),n.matterMouseConstraint=g.a.MouseConstraint.create(n.matterEngine,{mouse:n.matterMouse,constraint:{stiffness:.2,render:{lineWidth:0,strokeStyle:"black",visible:!1}}}),n.matterRender=he.create({bounds:{min:{x:-e.width/2,y:-e.height/2},max:{x:e.width/2,y:e.height/2}},canvas:e,engine:n.matterEngine,mouse:n.matterMouse,options:{width:e.width,height:e.height,background:"rgb(0, 0, 0, 0)",wireframes:!1}}),g.a.World.add(n.matterWorld,n.matterMouseConstraint);for(var o=0;o<9;++o)for(var a=0;a<9;++a){var r=g.a.Bodies.circle(50*o-200,50*a-200,20,{restitution:.5});g.a.World.add(n.matterWorld,r)}var i=g.a.Bodies.circle(0,300,50,{restitution:.5});g.a.World.add(n.matterWorld,i),n.matterRunner=g.a.Runner.create({isFixed:!1}),g.a.Events.on(n.matterMouseConstraint,"startdrag",n.onBodyDragStart),g.a.Events.on(n.matterMouseConstraint,"enddrag",n.onBodyDragEnd),g.a.Events.on(n.matterEngine,"beforeUpdate",n.onBeforeUpdate),n.props.onEngineBeforeUpdate&&g.a.Events.on(n.matterEngine,"beforeUpdate",n.props.onEngineBeforeUpdate),n.props.onEngineAfterUpdate&&g.a.Events.on(n.matterEngine,"afterUpdate",n.props.onEngineAfterUpdate),g.a.Events.on(n.matterRender,"beforeRender",n.onBeforeRender),g.a.Events.on(n.matterRender,"beforeObjects",n.onBeforeObjects),g.a.Runner.run(n.matterRunner,n.matterEngine),he.run(n.matterRender)}else console.log("Couldn't get a 2D canvas context")}else console.log("Canvas ref is null")},n.onBeforeUpdate=function(e){n.matterMouseConstraint&&(n.props.mouseMode!==o.OBJECT?n.matterMouseConstraint.collisionFilter.mask=0:n.matterMouseConstraint.collisionFilter.mask=4294967295)},n.onBeforeRender=function(e){n.matterRender&&(n.matterRender.options.gridSize=n.props.gridSize,n.matterRender.options.showCrosshair=n.state.showCrosshair,n.matterRender.options.crosshairSnap=n.props.snapToGrid)},n.onBeforeObjects=function(e){var t=e.source.context,a=n.getMousePos(!0),r=n.getMousePos(!0,!0);switch(t.setLineDash([]),t.lineWidth=1,n.props.boundaries.forEach((function(e){var a=n.worldToCanvas(e.bounds.min),i=n.worldToCanvas(e.bounds.max),s=g.a.Vector.sub(i,a),l=U(r,{min:a,max:i},!1),c=n.state.clickedBoundary&&n.state.clickedBoundary===e;t.fillStyle=e.color,t.strokeStyle="black",n.props.mouseMode===o.BOUNDARY_EDIT&&n.state.resizeMode===ve.NONE&&(c||l)?t.globalAlpha=.6:t.globalAlpha=.4,t.beginPath(),t.fillRect(a.x,a.y,s.x,s.y),t.globalAlpha=1,t.rect(a.x,a.y,s.x,s.y),t.stroke()})),n.props.mouseMode){case o.BOUNDARY_EDIT:if(!n.state.mouseDownPos||n.state.clickedBoundary||n.state.resizeBoundaries)break;var i=n.worldToCanvas(n.state.mouseDownPos),s=a.x-i.x,l=a.y-i.y;t.strokeStyle="blue",t.fillStyle="rgb(128, 128, 255, 0.2)",t.beginPath(),t.fillRect(i.x,i.y,s,l),t.rect(i.x,i.y,s,l),t.stroke();break;case o.SNOOKER:if(!n.state.snookerBody)break;var c=n.worldToCanvas(n.state.snookerBody.position);t.strokeStyle="red",t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(a.x,a.y),t.stroke()}},n.onBodyDragStart=function(){n.setState({draggingBody:!0})},n.onBodyDragEnd=function(){n.setState({draggingBody:!1})},n.checkResizeMode=function(e,t){var o=ve.NONE;if(t&&t.length>1){if(4===t.length)o=ve.CROSS_SPLIT;else if(2===t.length){var a=t[0].bounds,r=t[1].bounds;o=a.max.y<=r.min.y||r.max.y<=a.min.y?ve.HORIZONTAL_SPLIT:ve.VERTICAL_SPLIT}}else if(e){var i=n.getMousePos(!0,!0),s={min:n.worldToCanvas(e.bounds.min),max:n.worldToCanvas(e.bounds.max)},l=Math.abs(s.min.x-i.x),c=Math.abs(s.max.x-i.x),u=Math.abs(s.min.y-i.y),d=Math.abs(s.max.y-i.y);l<=10&&u<=10?o=ve.TOP_LEFT_CORNER:c<=10&&u<=10?o=ve.TOP_RIGHT_CORNER:c<=10&&d<=10?o=ve.BOTTOM_RIGHT_CORNER:l<=10&&d<=10?o=ve.BOTTOM_LEFT_CORNER:l<=10?o=ve.LEFT_EDGE:c<=10?o=ve.RIGHT_EDGE:u<=10?o=ve.TOP_EDGE:d<=10&&(o=ve.BOTTOM_EDGE)}return o},n.updateCanvasCursorStyle=function(e,t){var o=n.state.canvasRef.current;if(o)switch(e){case ve.TOP_LEFT_CORNER:o.style.cursor="nw-resize";break;case ve.TOP_RIGHT_CORNER:o.style.cursor="ne-resize";break;case ve.BOTTOM_RIGHT_CORNER:o.style.cursor="se-resize";break;case ve.BOTTOM_LEFT_CORNER:o.style.cursor="sw-resize";break;case ve.LEFT_EDGE:o.style.cursor="w-resize";break;case ve.RIGHT_EDGE:o.style.cursor="e-resize";break;case ve.TOP_EDGE:o.style.cursor="n-resize";break;case ve.BOTTOM_EDGE:o.style.cursor="s-resize";break;case ve.CROSS_SPLIT:o.style.cursor="move";break;case ve.HORIZONTAL_SPLIT:o.style.cursor="ns-resize";break;case ve.VERTICAL_SPLIT:o.style.cursor="ew-resize";break;default:t&&n.state.clickedBoundary?o.style.cursor="grabbing":o.style.cursor=t?"grab":"crosshair"}},n.onMouseDown=function(e){var t=n.getMousePos(),a=n.getMousePos(!0);switch(n.setState({mouseButton:e.button,mouseDownPos:t,mouseDownPosCanvas:a}),n.props.mouseMode){case o.SNOOKER:0===e.button&&n.setState({snookerBody:n.bodyAtPosition(t)});break;case o.BOUNDARY_EDIT:var r=n.boundaryUnderMouse(),i=n.boundariesNearMouse();if(!r&&!i.length)break;var s=ve.NONE;0===e.button&&(s=n.checkResizeMode(r,i),n.updateCanvasCursorStyle(s,r)),i.length>1?n.setState({resizeBoundaries:i,resizeMode:s}):r&&n.setState({clickedBoundary:r,clickedOldBounds:{min:Object.assign({},r.bounds.min),max:Object.assign({},r.bounds.max)},resizeMode:s})}},n.onMouseUp=function(e){if(n.matterWorld){var t=n.getMousePos(),a=n.getMousePos(!0),r=n.state.mouseButton===e.button&&n.state.mouseDownPosCanvas&&n.state.mouseDownPosCanvas.x===a.x&&n.state.mouseDownPosCanvas.y===a.y;switch(n.props.mouseMode){case o.OBJECT:if(n.state.draggingBody)break;if(0===e.button){var i=g.a.Bodies.circle(t.x,t.y,20,{restitution:.5});g.a.World.add(n.matterWorld,i),n.props.onObjectAdded&&n.props.onObjectAdded(i)}else if(2===e.button){var s=n.bodyAtPosition(t);s&&(n.props.onObjectDeleted&&n.props.onObjectDeleted(s.id),g.a.Composite.remove(n.matterWorld,s))}break;case o.SNOOKER:if(!n.state.snookerBody||0!==e.button)break;var l=n.state.snookerBody,c=g.a.Vector.mult(g.a.Vector.sub(l.position,t),.001*l.mass);g.a.Body.applyForce(l,l.position,c),n.setState({snookerBody:void 0});break;case o.BOUNDARY_EDIT:if(n.state.resizeMode!==ve.NONE){n.setState({resizeMode:ve.NONE,resizeBoundaries:void 0});break}if(n.props.onBoundaryDeleted&&2===e.button&&r&&n.state.clickedBoundary){n.props.onBoundaryDeleted(n.state.clickedBoundary);break}n.props.onBoundaryAdded&&0===e.button&&n.state.mouseDownPos&&n.props.onBoundaryAdded(M(n.state.mouseDownPos,t))}n.setState({mouseButton:void 0,mouseDownPos:void 0,mouseDownPosCanvas:void 0,clickedBoundary:void 0,clickedOldBounds:void 0}),n.updateCanvasCursorStyle(void 0,n.boundaryUnderMouse())}},n.resizingMultiple=function(e){return void 0!==e.length},n.onMouseMove=function(e){if(n.matterRender&&n.matterMouseConstraint){var t=n.getMousePos();if(2===n.state.mouseButton){if(!n.state.mouseDownPos||n.state.draggingBody)return;var a=n.matterRender.bounds,r={x:t.x-n.state.mouseDownPos.x,y:t.y-n.state.mouseDownPos.y};return a.min=g.a.Vector.sub(a.min,r),a.max=g.a.Vector.sub(a.max,r),void g.a.Mouse.setOffset(n.matterMouseConstraint.mouse,a.min)}switch(n.props.mouseMode){case o.BOUNDARY_EDIT:if(n.state.resizeMode===ve.NONE&&!n.state.clickedBoundary){var i=n.boundaryUnderMouse(),s=n.boundariesNearMouse();n.updateCanvasCursorStyle(n.checkResizeMode(i,s));break}if(!n.props.onBoundariesUpdated)break;if(n.state.resizeBoundaries)switch(n.state.resizeMode){case ve.CROSS_SPLIT:var l=n.state.resizeBoundaries.map((function(e){var n=e.bounds,o={min:Object.assign({},n.min),max:Object.assign({},n.max)};switch([_(t,n.min),_(t,{x:n.max.x,y:n.min.y}),_(t,n.max),_(t,{x:n.min.x,y:n.max.y})].reduce((function(e,t,n,o){return t<o[e]?n:e}),0)){case 0:o.min.x=t.x,o.min.y=t.y;break;case 1:o.max.x=t.x,o.min.y=t.y;break;case 2:o.max.x=t.x,o.max.y=t.y;break;case 3:o.min.x=t.x,o.max.y=t.y}return{boundary:e,newBounds:M(o.min,o.max)}}));n.props.onBoundariesUpdated(l);break;case ve.HORIZONTAL_SPLIT:case ve.VERTICAL_SPLIT:var c,u,d=n.state.resizeBoundaries[0],m=n.state.resizeBoundaries[1];if(n.state.resizeMode===ve.HORIZONTAL_SPLIT){if(d.bounds.max.y>m.bounds.min.y){var h=[m,d];d=h[0],m=h[1]}c=M(d.bounds.min,{x:d.bounds.max.x,y:t.y}),u=M({x:m.bounds.min.x,y:t.y},m.bounds.max)}else{if(d.bounds.max.x>m.bounds.min.x){var v=[m,d];d=v[0],m=v[1]}c=M(d.bounds.min,{x:t.x,y:d.bounds.max.y}),u=M({x:t.x,y:m.bounds.min.y},m.bounds.max)}n.props.onBoundariesUpdated([{boundary:d,newBounds:c},{boundary:m,newBounds:u}])}else if(n.state.clickedBoundary&&n.state.clickedOldBounds){var f={min:Object.assign({},n.state.clickedOldBounds.min),max:Object.assign({},n.state.clickedOldBounds.max)};switch(n.state.resizeMode){case ve.TOP_LEFT_CORNER:f.min.x=t.x,f.min.y=t.y;break;case ve.TOP_RIGHT_CORNER:f.max.x=t.x,f.min.y=t.y;break;case ve.BOTTOM_LEFT_CORNER:f.min.x=t.x,f.max.y=t.y;break;case ve.BOTTOM_RIGHT_CORNER:f.max.x=t.x,f.max.y=t.y;break;case ve.LEFT_EDGE:f.min.x=t.x;break;case ve.RIGHT_EDGE:f.max.x=t.x;break;case ve.TOP_EDGE:f.min.y=t.y;break;case ve.BOTTOM_EDGE:f.max.y=t.y;break;default:if(!n.state.mouseDownPos)break;var b=g.a.Vector.sub(t,n.state.mouseDownPos);f.min=g.a.Vector.add(f.min,b),f.max=g.a.Vector.add(f.max,b)}f=M(f.min,f.max),n.updateCanvasCursorStyle(n.state.resizeMode,n.state.clickedBoundary),n.props.onBoundariesUpdated([{boundary:n.state.clickedBoundary,newBounds:f}]);break}}}},n.onMouseOver=function(e){n.setState({showCrosshair:!0})},n.onMouseOut=function(e){n.setState({showCrosshair:!1,mouseDownPos:void 0,clickedBoundary:void 0})},n.onWheel=function(e){if(n.matterMouse&&n.matterRender){var t=n.matterMouse,o=e.deltaY<0?.9:1/.9,a=n.matterRender.bounds;a.min=g.a.Vector.add(g.a.Vector.mult(g.a.Vector.sub(a.min,t.position),o),t.position),a.max=g.a.Vector.add(g.a.Vector.mult(g.a.Vector.sub(a.max,t.position),o),t.position)}},n.spawnRandomObjects=function(e){if(n.matterRender&&n.matterWorld){for(var t=[],o=0;o<e;++o){var a=Object(f.random)(n.matterRender.bounds.min.x,n.matterRender.bounds.max.x,!0),r=Object(f.random)(n.matterRender.bounds.min.y,n.matterRender.bounds.max.y,!0);t.push(g.a.Bodies.circle(a,r,10,{restitution:.5}))}g.a.World.add(n.matterWorld,t)}},n.clearAllObjects=function(){n.matterMouseConstraint&&n.matterWorld&&(g.a.World.clear(n.matterWorld,!1),g.a.World.add(n.matterWorld,n.matterMouseConstraint))},n.showAllObjects=function(){n.matterWorld&&n.matterWorld.bodies.length>0&&he.lookAt(n.matterRender,n.matterWorld.bodies,{x:50,y:50},!0)},n.resetView=function(){if(n.state.canvasRef.current&&n.matterRender){var e=n.state.canvasRef.current,t=n.matterRender,o={x:e.width/2,y:e.height/2};t.bounds.min=g.a.Vector.neg(o),t.bounds.max=o}},n.worldToCanvas=function(e){if(!n.matterRender)return{x:0,y:0};var t=n.matterRender,o=t.canvas.width/(t.bounds.max.x-t.bounds.min.x);return g.a.Vector.mult(g.a.Vector.sub(e,t.bounds.min),o)},n.boundaryUnderMouse=function(){if(n.matterMouse){var e=n.matterMouse;return n.props.boundaries.find((function(t){return U(e.position,t.bounds)}))}},n.boundariesNearMouse=function(){if(!n.matterMouse)return[];var e=n.matterMouse;return n.props.boundaries.filter((function(t){return function(e,t,n){var o=(n.max.x-n.min.x)/2,a=(n.max.y-n.min.y)/2,r=n.min.x+o,i=n.min.y+a,s=Math.abs(e.x-r),l=Math.abs(e.y-i);return!(s>o+t)&&(!(l>a+t)&&(s<=o||(l<=a||Math.pow(s-o,2)+Math.pow(l-a,2)<=Math.pow(t,2))))}(e.position,5,t.bounds)}))},n.bodyAtPosition=function(e){if(n.matterWorld){var t=g.a.Composite.allBodies(n.matterWorld);return g.a.Query.point(t,e)[0]}},n.getMousePos=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!n.matterMouse)return{x:0,y:0};var o=n.props.gridSize,a=Object.assign({},n.matterMouse.position);return!t&&n.props.snapToGrid&&(a.x=Math.round(a.x/o)*o,a.y=Math.round(a.y/o)*o),e?n.worldToCanvas(a):a};var r=a.createRef();return n.state={canvasRef:r,showCrosshair:!1,draggingBody:!1,mouseButton:void 0,mouseDownPos:void 0,mouseDownPosCanvas:void 0,dragStartPos:void 0,dragLastPos:void 0,snookerBody:void 0,clickedBoundary:void 0,clickedOldBounds:void 0,resizeBoundaries:void 0,resizeMode:ve.NONE},n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return a.createElement("div",{id:"canvasContainer"},a.createElement("canvas",{ref:this.state.canvasRef,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove,onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut,onWheel:this.onWheel}))}}]),t}(a.PureComponent);fe.whyDidYouRender=!0;var be=["#e6194b","#3cb44b","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#808080","#ffe119","#ffffff","#000000"],ye=function(e){function t(e){var n;Object(u.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).serverRef=void 0,n.lastFrameTime=void 0,n.frameTimeHistory=void 0,n.componentDidMount=function(){n.state.utilFunctions.forEach((function(e,t){return n.onUtilFunctionUpdated(t,e.expression)})),n.onServerUtilFunctionUpdated(n.state.utilServer.expression)},n.onEngineBeforeUpdate=function(e){n.lastFrameTime=window.performance.now()},n.onEngineAfterUpdate=function(e){var t=window.performance.now(),o=t-n.lastFrameTime;n.frameTimeHistory.push(o),n.frameTimeHistory.shift();var a=n.frameTimeHistory.reduce((function(e,t){return e+t}))/n.frameTimeHistory.length,r=n.state.boundaries.slice(),i=g.a.Composite.allBodies(e.source.world),s=i.length;r.forEach((function(e){for(var t=0,n=0,o=0,r=0;r<i.length;){var l=i[r];U(l.position,e.bounds,!0)?(++t,l.isSleeping||++o,F(l.position,l.circleRadius,e.bounds)&&++n,l.render.fillStyle=e.color,i.splice(r,1)):++r}e.vars.lambda=(t?Math.min(1,o/s):0)+.1*Math.random(),e.vars.delta=a,e.vars.alpha=t?o/t:0,e.vars.beta=t?n/t:0,e.vars.n=t})),i.forEach((function(e){return e.render.fillStyle="black"}));var l=(t-n.state.lastBoundaryMoveTime)/1e3,c={sigma:r.length,t:l,N:s};n.setState({boundaries:r,utilGlobalVars:c})},n.validateResize=function(e){var t=[];return n.state.boundaries.forEach((function(n){e.some((function(e){return e.boundary===n}))||t.push(n.bounds)})),e.every((function(n){var o=n.newBounds;if(o.min.x===o.max.x||o.min.y===o.max.y)return!1;var a=[].concat(t);return e.forEach((function(e){return e!==n&&a.push(e.newBounds)})),!a.some((function(e){return P(o,e)}))}))},n.validateBoundary=function(e,t){return e.min.x!==e.max.x&&e.min.y!==e.max.y&&n.state.boundaries.every((function(n){return n===t||!P(e,n.bounds)}))},n.onBoundaryAdded=function(e){if(n.validateBoundary(e)){var t=n.state.boundaries.slice();t.push({bounds:e,color:be[t.length%be.length],vars:{}}),n.setState({boundaries:t,lastBoundaryMoveTime:window.performance.now()})}},n.onBoundaryDeleted=function(e){var t=n.state.boundaries.findIndex((function(t){return t===e}));if(-1!==t){var o=n.state.boundaries.slice();o.splice(t,1),n.setState({boundaries:o,lastBoundaryMoveTime:window.performance.now()})}},n.onBoundariesUpdated=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t||n.validateResize(e)){var o=n.state.boundaries.slice();e.forEach((function(e){for(var t=0;t<o.length;++t)if(e.boundary===o[t]){var n=o[t].bounds;n.min.x=e.newBounds.min.x,n.min.y=e.newBounds.min.y,n.max.x=e.newBounds.max.x,n.max.y=e.newBounds.max.y;break}})),n.setState({boundaries:o,lastBoundaryMoveTime:window.performance.now()})}},n.onUtilFunctionUpdated=function(e,t){var o=n.state.utilFunctions.slice();o[e].expression=t;try{o[e].evalFunc=p()(t,{e:Math.E,pi:Math.PI})}catch(a){o[e].evalFunc=null}n.setState({utilFunctions:o})},n.onServerUtilFunctionUpdated=function(e){var t=Object(f.cloneDeep)(n.state.utilServer);t.expression=e;try{t.evalFunc=p()(e,{e:Math.E,pi:Math.PI})}catch(o){t.evalFunc=null}n.setState({utilServer:t})},n.onUtilConstantUpdated=function(e,t){var o=Object(f.cloneDeep)(n.state.utilConstants);o[e]=t,n.setState({utilConstants:o})},n.onUtilVarUpdated=function(e,t){var o=n.state.utilFunctions.slice();o[e].utilVar=t,n.setState({utilFunctions:o})},n.onUtilFunctionAdded=function(){var e=n.state.utilFunctions.slice();e.push({expression:"",utilVar:"x",color:be[e.length%be.length]}),n.setState({utilFunctions:e})},n.onUtilFunctionDeleted=function(e){var t=n.state.utilFunctions.slice();t.splice(e,1),n.setState({utilFunctions:t})},n.onChangeColorClicked=function(e){n.setState({showColorPicker:!n.state.showColorPicker,colorIndex:n.state.showColorPicker?void 0:e})},n.onColorUpdated=function(e){var t=n.state.utilFunctions.slice();t[n.state.colorIndex].color=e.hex,n.setState({utilFunctions:t})},n.onRandomClicked=function(){n.serverRef.current&&n.serverRef.current.spawnRandomObjects(100)},n.onClearClicked=function(){n.serverRef.current&&n.serverRef.current.clearAllObjects()},n.onHomeClicked=function(){n.serverRef.current&&n.serverRef.current.resetView()},n.onShowAllObjectsClicked=function(){n.serverRef.current&&n.serverRef.current.showAllObjects()};var r={};return Object.keys(V).forEach((function(e){return r[e]=V[e].defaultValue})),n.serverRef=a.createRef(),n.lastFrameTime=0,n.frameTimeHistory=new Array(10),n.state={showColorPicker:!1,colorIndex:0,lastBoundaryMoveTime:window.performance.now(),mouseMode:o.OBJECT,gridSize:50,snapToGrid:!1,boundaries:[{bounds:{min:{x:0,y:-1e5},max:{x:1e5,y:0}},color:be[0],vars:{}},{bounds:{min:{x:0,y:0},max:{x:1e5,y:1e5}},color:be[1],vars:{}},{bounds:{min:{x:-1e5,y:-0},max:{x:0,y:1e5}},color:be[2],vars:{}},{bounds:{min:{x:-1e5,y:-1e5},max:{x:0,y:0}},color:be[3],vars:{}}],utilFunctions:[{expression:"e^(-10alpha)",utilVar:"alpha",color:be[5]},{expression:"e^(-5beta)",utilVar:"beta",color:be[6]},{expression:"min(max(0, -log(delta, 1000/60)), 1)",utilVar:"delta",color:be[7]}],utilConstants:r,utilGlobalVars:{},utilServer:{expression:"U_alpha + U_beta + U_delta"}},n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",null,a.createElement(O.a,{bg:"dark",variant:"dark"},a.createElement(O.a.Brand,{href:"#home"},"Aura Projection - Utility Function Simulator")),a.createElement(T.a,{fluid:!0,className:"mt-2"},a.createElement(S.a,null,a.createElement(C.a,null,a.createElement(S.a,null,a.createElement(C.a,null,a.createElement(w.a,{className:"mb-2"},a.createElement(k.a,{className:"mr-2"},a.createElement(E.a,{size:"sm",variant:"secondary",title:"Object mode",active:this.state.mouseMode===o.OBJECT,onClick:function(){e.setState({mouseMode:o.OBJECT})}},a.createElement(b.a,{icon:"cube"})),a.createElement(E.a,{size:"sm",variant:"secondary",title:"Boundary mode",active:this.state.mouseMode===o.BOUNDARY_EDIT,onClick:function(){e.setState({mouseMode:o.BOUNDARY_EDIT})}},a.createElement(b.a,{icon:"vector-square"})),a.createElement(E.a,{size:"sm",variant:"secondary",title:"Snooker mode",active:this.state.mouseMode===o.SNOOKER,onClick:function(){e.setState({mouseMode:o.SNOOKER})}},a.createElement(b.a,{icon:"bowling-ball"}))),a.createElement(k.a,{className:"mr-2"},a.createElement(E.a,{size:"sm",variant:"secondary",title:"Reset view",onClick:this.onHomeClicked},a.createElement(b.a,{icon:"home"})),a.createElement(E.a,{size:"sm",variant:"secondary",title:"Show all objects",onClick:this.onShowAllObjectsClicked},a.createElement(b.a,{icon:"eye"}))),a.createElement(k.a,{className:"mr-2"},a.createElement(E.a,{size:"sm",variant:"secondary",title:"Toggle snap to grid",active:this.state.snapToGrid,onClick:function(){e.setState({snapToGrid:!e.state.snapToGrid})}},a.createElement(b.a,{icon:"magnet"})),a.createElement(E.a,{size:"sm",variant:"secondary",title:"Decrease grid size",onClick:function(){e.setState({gridSize:Math.max(25,e.state.gridSize/2)})}},a.createElement(b.a,{icon:"th"})),a.createElement(E.a,{size:"sm",variant:"secondary",title:"Increase grid size",onClick:function(){e.setState({gridSize:2*e.state.gridSize})}},a.createElement(b.a,{icon:"th-large"}))),a.createElement(k.a,{className:"mr-2"},a.createElement(E.a,{size:"sm",variant:"secondary",title:"Spawn random objects",onClick:this.onRandomClicked},a.createElement(b.a,{icon:"dice"})),a.createElement(E.a,{size:"sm",variant:"warning",title:"Remove all objects",onClick:this.onClearClicked},a.createElement(b.a,{icon:"radiation"})))))),a.createElement(S.a,null,a.createElement(C.a,null,a.createElement(fe,{ref:this.serverRef,boundaries:this.state.boundaries,gridSize:this.state.gridSize,mouseMode:this.state.mouseMode,snapToGrid:this.state.snapToGrid,onBoundaryAdded:this.onBoundaryAdded,onBoundariesUpdated:this.onBoundariesUpdated,onBoundaryDeleted:this.onBoundaryDeleted,onEngineBeforeUpdate:this.onEngineBeforeUpdate,onEngineAfterUpdate:this.onEngineAfterUpdate})))),a.createElement(C.a,null,a.createElement($,{boundaries:this.state.boundaries,utilFunctions:this.state.utilFunctions,utilConstants:this.state.utilConstants,utilGlobalVars:this.state.utilGlobalVars})),a.createElement(C.a,null,a.createElement(J,{boundaries:this.state.boundaries,utilFunctions:this.state.utilFunctions,utilConstants:this.state.utilConstants,utilGlobalVars:this.state.utilGlobalVars,utilServer:this.state.utilServer,onUtilFunctionUpdated:this.onUtilFunctionUpdated,onUtilFunctionAdded:this.onUtilFunctionAdded,onUtilFunctionDeleted:this.onUtilFunctionDeleted,onServerUtilFunctionUpdated:this.onServerUtilFunctionUpdated,onUtilConstantUpdated:this.onUtilConstantUpdated,onUtilVarUpdated:this.onUtilVarUpdated,onChangeColorClicked:this.onChangeColorClicked,onColorUpdated:this.onColorUpdated,showColorPicker:this.state.showColorPicker,colorIndex:this.state.colorIndex})))))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var pe=n(61),xe=n(13);pe.b.add(xe.a,xe.b,xe.c,xe.d,xe.e,xe.f,xe.g,xe.h,xe.j,xe.i,xe.k,xe.l,xe.m,xe.n,xe.o),s.a.render(r.a.createElement(c.a.Context,{input:"ascii",options:{asciimath2jax:{useMathMLspacing:!0,preview:"none"}}},r.a.createElement(ye,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[163,1,2]]]);
//# sourceMappingURL=main.037a6d81.chunk.js.map